(function(){BX.namespace("BX.CRM.Kanban");BX.CRM.Kanban.Column=function(t){BX.Kanban.Column.apply(this,arguments)};BX.CRM.Kanban.Column.prototype={__proto__:BX.Kanban.Column.prototype,constructor:BX.CRM.Kanban.Column,renderSubtitleTime:6,pathToAdd:null,currencyFormat:function(t,e,i){var n="",a;if(typeof BX.Currency==="undefined"){return t}i=!!i;a=BX.Currency.getCurrencyFormat(e);if(!!a&&typeof a==="object"){a.CURRENT_DECIMALS=a.DECIMALS;a.HIDE_ZERO="Y";if(a.HIDE_ZERO==="Y"&&t==parseInt(t,10)){a.CURRENT_DECIMALS=0}n=BX.util.number_format(t,a.CURRENT_DECIMALS,a.DEC_POINT,a.THOUSANDS_SEP);if(i){n=a.FORMAT_STRING.replace(/(^|[^&])#/,"$1"+n)}}return n},decPrice:function(t){var e=this.getData();e.sum=parseFloat(e.sum)-t;this.setData(e)},incPrice:function(t){var e=this.getData();e.sum=parseFloat(e.sum)+t;this.setData(e)},getAddColumnButton:function(){var t=this.getData();if(t.type==="WIN"){this.layout.info.style.marginRight="0";return BX.create("div")}else{return BX.Kanban.Column.prototype.getAddColumnButton.apply(this,arguments)}},getAddPath:function(){if(this.pathToAdd!==null){return this.pathToAdd}var t=this.getGridData();var e=t.entityType.toLowerCase();var i,n;if(e==="invoice"){i="crm_invoice_toolbar"}else{i="toolbar_"+e+"_list"}if(BX(i)){n=BX(i).querySelector("a");this.pathToAdd=n.getAttribute("href");this.pathToAdd+=this.pathToAdd.indexOf("?")===-1?"?":"&"}return this.pathToAdd},renderSubTitle:function(){var t=this.getData();var e=this.getGridData();if(e.entityType!=="LEAD"){this.layout.subTitlePriceText=BX.create("span",{attrs:{className:"crm-kanban-total-price-total"}});this.layout.subTitlePrice=BX.create("div",{attrs:{className:"crm-kanban-total-price"},children:[this.layout.subTitlePriceText]})}else{this.layout.subTitlePrice=null}if(this.layout.subTitlePriceText){t.sum=parseFloat(t.sum);t.sum_old=t.sum_old?t.sum_old:t.sum_init;t.sum_init=t.sum;this.renderSubTitleAnimation(t.sum_old,t.sum,Math.abs(t.sum_old-t.sum)/20,this.layout.subTitlePriceText,function(i,n){i.innerHTML=this.currencyFormat(Math.round(n),e.currency,true);t.sum_old=t.sum}.bind(this));this.setData(t)}return BX.create("div",{children:[this.layout.subTitlePrice,this.getAddPath()?BX.create("a",{attrs:{className:"crm-kanban-column-add-item-button",href:this.getAddPath()+(e.entityType==="DEAL"?"stage_id=":"status_id=")+this.getId()},text:"+"}):null]})},renderSubTitleAnimation:function(t,e,i,n,a){var r=+t;var o=parseFloat(e);var s=this.renderSubtitleTime;if(r<o){(function(){if(r<=o){setTimeout(arguments.callee,s);n.textContent=BX.util.number_format(r,0,","," ");r=r+i}else{if(typeof a==="function"){a(n,e)}}})()}else if(r>o){(function(){if(r>=o){setTimeout(arguments.callee,s);n.textContent=BX.util.number_format(r,0,","," ");r=r-i}else{if(typeof a==="function"){a(n,e)}}})()}else if(typeof a==="function"){a(n,e)}},handleAddColumnButtonClick:function(t){var e=this.getGridData();if(e.rights&&e.rights.canAddColumn){BX.Kanban.Column.prototype.handleAddColumnButtonClick.apply(this,arguments)}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}},switchToEditMode:function(){var t=this.getGridData();if(t.rights&&t.rights.canAddColumn){BX.Kanban.Column.prototype.switchToEditMode.apply(this,arguments)}else if(typeof BX.Intranet!=="undefined"){this.getGrid().accessNotify()}}}})();