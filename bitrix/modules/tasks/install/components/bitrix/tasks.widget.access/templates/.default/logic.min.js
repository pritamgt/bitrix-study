"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksWidgetRights!="undefined"){return}BX.Tasks.Component.TasksWidgetAccess=BX.Tasks.Component.extend({sys:{code:"rights"},methods:{construct:function(){this.callConstruct(BX.Tasks.Component);var t=null;BX.Tasks.each(this.option("levels"),function(e){t=e;return false});this.vars.firstLevel=t;this.getManager()},getManager:function(){return this.subInstance("items",function(){return new this.constructor.ItemManager({scope:this.scope(),preRendered:true,data:this.option("data"),parent:this})})}}});BX.Tasks.Component.TasksWidgetAccess.ItemManager=BX.Tasks.Util.ItemSet.extend({sys:{code:"rights-is"},options:{controlBind:"class",useSmartCodeNaming:true},methods:{bindItemActions:function(){this.callMethod(BX.Tasks.Util.ItemSet,"bindItemActions");this.bindOnItemEx("i-operation-title","click",this.onItemOperationClick.bind(this))},onItemOperationClick:function(t,e){var n=[];BX.Tasks.each(this.optionP("levels"),function(e){n.push({enabled:true,text:e.TITLE,onclick:this.passCtx(this.doMenuAction),itemRef:t,levelId:e.ID,levelTitle:e.TITLE})}.bind(this));BX.PopupMenu.show(this.id()+"-op-popup-"+t.value(),e,n,{angle:true,position:"right",offsetLeft:40,offsetTop:0})},doMenuAction:function(t,e,n){t.popupWindow.close();this.setItemOperation(n.itemRef,n.levelId,n.levelTitle)},setItemOperation:function(t,e,n){t.data().TASK_ID=e;t.control("operation-title").innerHTML=n;t.control("operation").value=e},extractItemValue:function(t){if("VALUE"in t){return t.VALUE}t.VALUE=this.getRandomHash();return t.VALUE},prepareData:function(t){var e=this.parent().vars.firstLevel;this.setField("ID",t,"");this.setField("TITLE",t,e.TITLE);this.setField("TASK_ID",t,e.ID);this.setField("MEMBER_ID",t,t.id);this.setField("DISPLAY",t,function(t){if("nameFormatted"in t){return BX.util.htmlspecialcharsback(t.nameFormatted)}var e=this.option("nameTemplate");if(e){var n=BX.formatName(t,e,"Y");if(n=="Noname"){n=t.LOGIN||t.login}return n}return t.LOGIN});t.ITEM_SET_INVISIBLE="";return t},openAddForm:function(){this.getSelector().open()},getSelector:function(){return this.subInstance("socnet",function(){var t=new BX.Tasks.Integration.Socialnetwork.NetworkSelector({scope:this.control("open-form"),id:this.id()+"socnet-sel",mode:"user",query:this.parent().getQuery(),useSearch:true,useAdd:false,controlBind:this.option("controlBind"),parent:this,popupOffsetTop:5,popupOffsetLeft:40,lastSelectedContext:"TASKS_RIGHTS"});t.bindEvent("item-selected",this.onSelectorItemSelected.bind(this));return t})},onSelectorItemSelected:function(t){t.MEMBER_ID=t.id;delete t.id;this.addItem(t);this.getSelector().close();this.getSelector().deselectItem(t.MEMBER_ID)}}})}).call(this);
//# sourceMappingURL=logic.map.js