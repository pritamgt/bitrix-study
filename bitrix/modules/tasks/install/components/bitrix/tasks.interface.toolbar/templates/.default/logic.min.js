"use strict";BX.namespace("Tasks.Component");(function(){if(typeof BX.Tasks.Component.TasksToolbar!="undefined"){return}BX.Tasks.Component.TasksToolbar=BX.Tasks.Component.extend({sys:{code:"toolbar"},methodsStatic:{instance:{},getInstance:function(){return BX.Tasks.Component.TasksToolbar.instance},addInstance:function(t){BX.Tasks.Component.TasksToolbar.instance=t}},methods:{construct:function(){var t=this;this.callConstruct(BX.Tasks.Component);BX.Tasks.Component.TasksToolbar.addInstance(this);if(!this.option("counters")){t.getToolbarData("",function(){t.render()})}else{t.render()}},bindEvents:function(){var t=this;BX.addCustomEvent("Tasks.TopMenu:onItem",function(e){t.getToolbarData(e,function(){t.render()})});BX.addCustomEvent("BX.Kanban.ChangeGroup",function(e,o){t.option("groupId",e);t.getToolbarData("",function(){t.render()})})},getToolbarData:function(t,e){t=t||"";e=e||{};var o=this.option("userId");var n=this.option("groupId")||0;var a=this;this.callRemote("ui.counters.get",{userId:o,type:t,groupId:n}).then(function(t){a.option("counters",t.getData());e.call(a)})},render:function(){var t=this.option("templates");var e=this.option("counters");var o=this.option("messages");var n=this.option("classes");var a=[];if(typeof e.total==="object"&&"counter"in e.total&&e.total.counter>0){a.push(t.total.replace("#COUNTER#",e.total.counter).replace("#TEXT#",o.total));for(var s in e){if(e[s].counter>0&&s!="total"){a.push(t.counter.replace("#COUNTER#",e[s].counter).replace("#COUNTER#",e[s].counter).replace("#COUNTER_ID#",s).replace("#COUNTER_CODE#",e[s].code).replace("#TEXT#",o[s+"_"+this.getPluralForm(e[s].counter)]).replace("#CLASS#",n[s]))}}}else{a.push(t.empty.replace("#TEXT#",o.empty))}this.scope().innerHTML=a.join("");var r=this.scope().getElementsByClassName("tasks-counter-container");if(r.length){for(var s=0;s<r.length;s++){BX.bind(r[s],"click",function(t){BX.PreventDefault(t);var e=this.dataset.counterCode;var o=window.location.href;BX.onCustomEvent("Tasks.Toolbar:onItem",[e,o])})}}},getPluralForm:function(t){var e,o;o=BX.message("LANGUAGE_ID");t=parseInt(t);if(t<0){t=-1*t}if(o){switch(o){case"de":case"en":e=t!==1?1:0;break;case"ru":case"ua":e=t%10===1&&t%100!==11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2;break;default:e=1;break}}else{e=1}return e}}})}).call(this);