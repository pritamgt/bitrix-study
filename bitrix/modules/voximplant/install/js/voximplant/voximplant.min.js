var VoxImplant=function(e){var t={};function n(r){if(t[r]){return t[r].exports}var i=t[r]={i:r,l:false,exports:{}};e[r].call(i.exports,i,i.exports,n);i.l=true;return i.exports}n.m=e;n.c=t;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:r})}};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="/build";return n(n.s=30)}([function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o;(function(e){e[e["NONE"]=0]="NONE";e[e["ERROR"]=1]="ERROR";e[e["WARNING"]=2]="WARNING";e[e["INFO"]=3]="INFO";e[e["TRACE"]=4]="TRACE"})(o=t.LogLevel||(t.LogLevel={}));var a;(function(e){e[e["SIGNALING"]=0]="SIGNALING";e[e["RTC"]=1]="RTC";e[e["USERMEDIA"]=2]="USERMEDIA";e[e["CALL"]=3]="CALL";e[e["CALLEXP2P"]=4]="CALLEXP2P";e[e["CALLEXSERVER"]=5]="CALLEXSERVER";e[e["CALLMANAGER"]=6]="CALLMANAGER";e[e["CLIENT"]=7]="CLIENT";e[e["AUTHENTICATOR"]=8]="AUTHENTICATOR";e[e["PCFACTORY"]=9]="PCFACTORY";e[e["UTILS"]=10]="UTILS";e[e["ORTC"]=11]="ORTC";e[e["MESSAGING"]=12]="MESSAGING";e[e["REINVITEQ"]=13]="REINVITEQ";e[e["HARDWARE"]=14]="HARDWARE"})(a=t.LogCategory||(t.LogCategory={}));var s;(function(e){e[e["DISCONNECTED"]="DISCONNECTED"]="DISCONNECTED";e[e["CONNECTING"]="CONNECTING"]="CONNECTING";e[e["CONNECTED"]="CONNECTED"]="CONNECTED";e[e["LOGGING_IN"]="LOGGING_IN"]="LOGGING_IN";e[e["LOGGED_IN"]="LOGGED_IN"]="LOGGED_IN"})(s=t.ClientState||(t.ClientState={}));var c=function(){function e(t,n,r){i(this,e);this.category=t;this.label=n;this.provider=r}r(e,[{key:"log",value:function e(t,n){this.provider.writeMessage(this.category,this.label,t,n)}},{key:"error",value:function e(t){this.log(o.ERROR,t)}},{key:"warning",value:function e(t){this.log(o.WARNING,t)}},{key:"info",value:function e(t){this.log(o.INFO,t)}},{key:"trace",value:function e(t){this.log(o.TRACE,t)}}]);return e}();t.Logger=c;var l=function(){function e(){i(this,e);this._shadowLogging=false;this.levels={}}r(e,[{key:"getSLog",value:function e(){return this._shadowLog}},{key:"setPrettyPrint",value:function e(t){this.prettyPrint=t}},{key:"setLogLevel",value:function e(t,n){this.levels[a[t]]=n}},{key:"writeMessage",value:function t(n,r,i,s){e.tick++;var c="VIWSLR "+e.tick+" "+(new Date).toString()+" "+o[i]+" "+r+": "+s;var l=o.NONE;if(typeof this.levels[a[n]]!="undefined")l=this.levels[a[n]];if(i<=l){if(typeof console.debug!="undefined"&&typeof console.info!="undefined"&&typeof console.error!="undefined"&&typeof console.warn!="undefined"){if(this.prettyPrint){if(typeof s!="string")s=JSON.stringify(s);var u="%c VIWSLR "+e.tick+" "+(new Date).toUTCString()+" ["+o[i]+"] %c"+r+": %c"+s.replace("\r\n","<br>");if(i===o.ERROR)console.error(c);else if(i===o.WARNING)console.warn(u,"color:#ccc","color:#2375a2","color:#000");else if(i===o.INFO)console.info(u,"color:#ccc","color:#2375a2","color:#000");else if(i===o.TRACE)console.log(u,"color:#ccc","color:#2375a2","color:#000");else console.log(u,"color:#ccc","color:#2375a2","color:#000")}else{if(i===o.ERROR)console.error(c);else if(i===o.WARNING)console.warn(c);else if(i===o.INFO)console.info(c);else if(i===o.TRACE)console.debug(c);else console.log(c)}}else console.log(c)}if(this.shadowLogging){this._shadowLog.push(c)}}},{key:"createLogger",value:function e(t,n){return new c(t,n,this)}},{key:"_traceName",value:function e(){return"Logger"}},{key:"shadowLogging",set:function e(t){if(!this._shadowLogging)this._shadowLog=[];this._shadowLogging=t},get:function e(){return this._shadowLogging}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e;this.inst.prettyPrint=false}return this.inst}},{key:"d_trace",value:function t(n){return function(t,r,i){return{value:function a(){var s="";for(var c=arguments.length,l=Array(c),u=0;u<c;u++){l[u]=arguments[u]}try{s=l.map(function(e){return JSON.stringify(e)}).join()}catch(e){s="circular structure"}var d="";if(t._traceName)d=t._traceName();e.get().writeMessage(n,d,o.TRACE,r+"("+s+")");var f=i.value.apply(this,l);return f}}}}}]);return e}();l.tick=0;t.LogManager=l},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(5);var l=n(8);var u=n(6);var d=n(2);var f=n(12);var g=n(25);var p=n(3);var v;(function(e){e[e["IDLE"]=0]="IDLE";e[e["CONNECTING"]=1]="CONNECTING";e[e["WSCONNECTED"]=2]="WSCONNECTED";e[e["CONNECTED"]=3]="CONNECTED";e[e["CLOSING"]=4]="CLOSING"})(v=t.VoxSignalingState||(t.VoxSignalingState={}));var h=function(){function e(){var t=this;o(this,e);this.ver="3";this.handlers=[];this.rpcHandlers={};this.pingTimer=null;this.pongTimer=null;this.manualDisconnect=false;this.platform="platform";this.referrer="platform";this.extra="";this.closing=false;this.writeLog=false;this._opLog=[];this.token="";this.log=s.LogManager.get().createLogger(s.LogCategory.SIGNALING,"VoxSignaling");this.currentState=v.IDLE;this.setRPCHandler(f.RemoteEvent.connectionSuccessful,function(e){t.onConnectionSuccessfulRPC(e)});this.setRPCHandler(f.RemoteEvent.connectionFailed,function(){t.onConnectionFailedRPC()});this.setRPCHandler(f.RemoteEvent.createConnection,function(e){t.onConnectionSuccessfulRPC(e)})}r(e,[{key:"addHandler",value:function e(t){this.handlers.push(t)}},{key:"close",value:function e(){this.closing=true;if(this.ws){this.ws.onclose=null;this.ws.close();this.onWSClosed(null)}else{this.log.warning("Try close unused WS in state "+v[this.currentState])}}},{key:"cleanup",value:function e(){l.PCFactory.get().closeAll();if(this.pingTimer)clearTimeout(this.pingTimer);if(this.pongTimer)clearTimeout(this.pongTimer)}},{key:"onConnectionSuccessfulRPC",value:function e(t){if(this.currentState!=v.WSCONNECTED){this.log.error("Can't handle __connectionSuccessful while in state "+v[this.currentState]);return}if(t)this.token=t;this.currentState=v.CONNECTED;if(this.handlers.length>0){for(var n=0;n<this.handlers.length;++n){try{this.handlers[n].onSignalingConnected()}catch(e){this.log.warning("Error in onSignalingConnected callback: "+e)}}}else{this.log.warning("No VoxSignaling handler specified")}}},{key:"onConnectionFailedRPC",value:function e(){if(this.currentState!=v.WSCONNECTED){this.log.error("Can't handle __connectionSuccessful while in state "+v[this.currentState]);return}this.ws.onerror=null;this.ws.close();this.ws=null;this.currentState=v.IDLE;if(this.handlers.length>0){for(var t=0;t<this.handlers.length;++t){try{this.handlers[t].onMediaConnectionFailed()}catch(e){this.log.warning("Error in onMediaConnectionFailed callback: "+e)}}}else{this.log.warning("No VoxSignaling handler specified")}}},{key:"connectTo",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var i=this;var o=arguments[3];var a=arguments[4];this.manualDisconnect=false;this.ver=a;if(this.currentState!=v.IDLE){this.log.error("Can't establish connection while in state "+v[this.currentState]);return}this.currentState=v.CONNECTING;var s=c.default.getWSVendor(o);this.ws=new WebSocket("ws"+(r?"s":"")+"://"+t+"/"+this.platform+"?version="+this.ver+"&client="+s+"&referrer=&extra="+this.extra+"&video="+(n?"true":"false")+"&client_version="+p.Client.getInstance().version);this.ws.onopen=function(e){return i.onWSConnected()};this.ws.onclose=function(e){return i.onWSClosed(e)};this.ws.onerror=function(e){return i.onWSError()};this.ws.onmessage=function(e){return i.onWSData(e.data)}}},{key:"setRPCHandler",value:function e(t,n){if(typeof this.rpcHandlers[t]!="undefined"){this.log.warning("Overwriting RPC handler for function "+t)}this.rpcHandlers[t]=n}},{key:"removeRPCHandler",value:function e(t){if(typeof this.rpcHandlers[t]=="undefined"&&!this.closing){this.log.warning("There is no RPC handler for function "+t)}delete this.rpcHandlers[t]}},{key:"callRemoteFunction",value:function e(t){for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++){r[i-1]=arguments[i]}if(this.currentState!=v.CONNECTED&&this.currentState!=v.WSCONNECTED){if(!this.closing)this.log.error("Can't make a RPC call in state "+v[this.currentState]);return false}if(typeof this.ws!="undefined"){if(this.writeLog)this._opLog.push("send:"+JSON.stringify({name:t,params:r}));var o=JSON.stringify({name:t,params:r});this.ws.send(o);s.LogManager.get().writeMessage(s.LogCategory.SIGNALING,"[wsdataout]",s.LogLevel.INFO,o);return true}}},{key:"onWSData",value:function e(t){s.LogManager.get().writeMessage(s.LogCategory.SIGNALING,"[wsdatain]",s.LogLevel.INFO,t);if(this.writeLog)this._opLog.push("recv:"+t);var n=void 0;try{n=JSON.parse(t)}catch(e){this.log.error("Can't parse JSON data: "+t);return}if(typeof n["service"]!="undefined")this.onWSMessData(n);else this.onWSVoipData(n)}},{key:"onWSMessData",value:function e(t){g.MsgSignaling.get().handleWsData(t)}},{key:"onWSVoipData",value:function e(t){var n=t["name"];var r=t["params"];if(typeof this.rpcHandlers[n]!="undefined"){try{this.rpcHandlers[n].apply(null,r)}catch(e){this.log.warning("Error in '"+n+"' handler : "+e)}}else{this.log.warning("No handler for "+n)}}},{key:"disconnect",value:function e(){this.closing=true;this.manualDisconnect=true;this.onWSClosed(null);this.cleanup()}},{key:"onWSClosed",value:function e(t){if(this.currentState!=v.CONNECTED&&this.currentState!=v.CONNECTING&&this.currentState!=v.CLOSING){if(!this.closing)this.log.warning("onWSClosed in state "+v[this.currentState]);else return}if(this.ws){this.ws.close();this.ws=undefined}var n=this.currentState;if(this.pingTimer){clearTimeout(this.pingTimer)}if(this.pongTimer){clearTimeout(this.pongTimer)}this.cleanup();this.currentState=v.IDLE;if(this.handlers.length>0){for(var r=0;r<this.handlers.length;++r){if((n==v.CONNECTING||n==v.WSCONNECTED||n==v.IDLE)&&!this.manualDisconnect){try{this.handlers[r].onSignalingConnectionFailed(t.reason)}catch(t){this.log.warning("Error in onSignalingConnectionFailed callback: "+t)}}else{try{this.handlers[r].onSignalingClosed()}catch(t){this.log.warning("Error in onSignalingClosed callback: "+t)}}}}else{this.log.warning("No VoxSignaling handler specified")}}},{key:"onWSConnected",value:function t(){var n=this;this.closing=false;if(this.currentState!=v.CONNECTING){this.log.warning("onWSConnected in state "+v[this.currentState])}this.currentState=v.WSCONNECTED;this.pingTimer=window.setTimeout(function(){return n.doPing()},e.PING_DELAY);this.setRPCHandler(f.RemoteEvent.pong,function(){return n.pongReceived()});this.setRPCHandler(f.RemoteEvent.increaseGain,function(){n.log.info("Deprecated increaseGain")})}},{key:"onWSError",value:function e(){if(this.currentState!=v.CONNECTING){this.log.warning("onWSError in state "+this.currentState)}this.ws.close();this.ws=undefined;if(this.pingTimer){clearTimeout(this.pingTimer)}if(this.pongTimer){clearTimeout(this.pongTimer)}this.cleanup();this.currentState=v.IDLE;if(typeof this.handlers!="undefined"){for(var t=0;t<this.handlers.length;++t){try{this.handlers[t].onSignalingConnectionFailed("Error connecting to VoxImplant server")}catch(e){this.log.warning("Error in onSignalingConnectionFailed callback: "+e)}}}else{this.log.warning("No VoxSignaling handler specified")}}},{key:"doPing",value:function t(){var n=this;this.pingTimer=null;this.callRemoteFunction(d.RemoteFunction.ping,[]);this.pongTimer=window.setTimeout(function(){if(u.CallManager.get().numCalls>0){n.pongReceived();return}n.pongTimer=null;for(var e=0;e<n.handlers.length;++e){if(n.currentState==v.CONNECTED){try{n.handlers[e].onSignalingClosed()}catch(e){n.log.warning("Error in onSignalingClosed callback: "+e)}}else{try{n.handlers[e].onSignalingConnectionFailed("Connection closed")}catch(e){n.log.warning("Error in onSignalingConnectionFailed callback: "+e)}}}n.currentState=v.IDLE},e.PING_DELAY)}},{key:"pongReceived",value:function t(){var n=this;if(this.pongTimer){clearTimeout(this.pongTimer);this.pongTimer=null;this.pingTimer=window.setTimeout(function(){return n.doPing()},e.PING_DELAY)}}},{key:"sendRaw",value:function e(t){if(this.writeLog)this._opLog.push("send:"+JSON.stringify(t));var n=JSON.stringify(t);this.ws.send(n);s.LogManager.get().writeMessage(s.LogCategory.SIGNALING,"[wsdataout]",s.LogLevel.INFO,n);return true}},{key:"getLog",value:function e(){return this._opLog}},{key:"lagacyConnectTo",value:function e(t,n,r,i){this.ver="2";this.platform=i;this.referrer=n;this.connectTo(t,false,true,true,"2")}},{key:"_traceName",value:function e(){return"VoxSignaling"}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst}}]);return e}();h.PING_DELAY=3e4;a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"addHandler",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"close",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"cleanup",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onConnectionSuccessfulRPC",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onConnectionFailedRPC",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"connectTo",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"setRPCHandler",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"removeRPCHandler",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"callRemoteFunction",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"disconnect",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onWSClosed",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onWSConnected",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"onWSError",null);a([s.LogManager.d_trace(s.LogCategory.SIGNALING)],h.prototype,"sendRaw",null);t.VoxSignaling=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["ping"]="__ping"]="ping";e[e["login"]="login"]="login";e[e["loginGenerateOneTimeKey"]="loginGenerateOneTimeKey"]="loginGenerateOneTimeKey";e[e["loginStage2"]="loginStage2"]="loginStage2";e[e["setOperatorACDStatus"]="setOperatorACDStatus"]="setOperatorACDStatus";e[e["setDesiredVideoBandwidth"]="setDesiredVideoBandwidth"]="setDesiredVideoBandwidth";e[e["rejectCall"]="rejectCall"]="rejectCall";e[e["disconnectCall"]="disconnectCall"]="disconnectCall";e[e["sendDTMF"]="sendDTMF"]="sendDTMF";e[e["sendSIPInfo"]="sendSIPInfo"]="sendSIPInfo";e[e["hold"]="hold"]="hold";e[e["unhold"]="unhold"]="unhold";e[e["acceptCall"]="acceptCall"]="acceptCall";e[e["createCall"]="createCall"]="createCall";e[e["transferCall"]="transferCall"]="transferCall";e[e["muteLocal"]="__muteLocal"]="muteLocal";e[e["reInvite"]="ReInvite"]="reInvite";e[e["acceptReInvite"]="AcceptReInvite"]="acceptReInvite";e[e["rejectReInvite"]="RejectReInvite"]="rejectReInvite";e[e["confirmPC"]="__confirmPC"]="confirmPC";e[e["addCandidate"]="__addCandidate"]="addCandidate";e[e["loginUsingOneTimeKey"]="loginUsingOneTimeKey"]="loginUsingOneTimeKey";e[e["refreshOauthToken"]="refreshOauthToken"]="refreshOauthToken";e[e["zPromptFinished"]="promptFinished"]="zPromptFinished";e[e["zStartPreFlightCheck"]="__startPreFlightCheck"]="zStartPreFlightCheck";e[e["registerPushToken"]="registerPushToken"]="registerPushToken";e[e["unregisterPushToken"]="unregisterPushToken"]="unregisterPushToken";e[e["pushFeedback"]="pushFeedback"]="pushFeedback"})(r=t.RemoteFunction||(t.RemoteFunction={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":o(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a}return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var u=n(18);var d=n(21);var f=n(1);var g=n(4);var p=n(10);var v=n(5);var h=n(0);var y=n(8);var m=n(6);var C=n(20);var _=n(15);var S=n(2);var L=n(12);var E=n(16);var M=n(22);var R=n(44);var T=n(45);var b=n(27);var k=n(13);var P=function(e){c(t,e);function t(){a(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._connected=false;e.progressToneScript={US:"440@-19,480@-19;*(2/4/1+2)",RU:"425@-19;*(1/3/1)"};e.playingNow=false;e.serversList=[];e._vol=100;e.micRequired=false;e.videoConstraints=null;e.progressToneCountry="US";e.progressTone=true;e.showDebugInfo=false;e.showWarnings=false;e.RTCsupported=false;e._deviceEnumAPI=false;e._h264first=false;e._VP8first=false;e.applyMixins(t,[_.EventDispatcher]);if(t.instance){throw new Error("Error - use VoxImplant.getInstance()")}t.instance=e;e._promises={};v.default.init();var n=y.PCFactory.get();n.requireMedia=false;e.voxSignaling=f.VoxSignaling.get();e.voxMediaManager=g.UserMediaManager.get();e.voxCallManager=m.CallManager.get();e.mediacache=M.MediaCache.get();e.renderer=C.Renderer.get();e.setLogLevelAll(h.LogLevel.NONE);h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"SDK ver.",h.LogLevel.TRACE,e.version);f.VoxSignaling.get().setRPCHandler(L.RemoteEvent.onPCStats,function(t,n){if(y.PCFactory.get().getPeerConnect(t))e.dispatchEvent({name:"NetStatsReceived",stats:n})});e._defaultSinkId=null;e.loginState=0;return e}r(t,[{key:"applyMixins",value:function e(t,n){n.forEach(function(e){Object.getOwnPropertyNames(e.prototype).forEach(function(n){t.prototype[n]=e.prototype[n]})})}},{key:"deviceEnumAPI",value:function e(){var t=this;this.voxMediaManager.getDevices().then(function(){t._deviceEnumAPI=true;t.dispatchEvent({name:u.Events.SourcesInfoUpdated})}).catch(function(e){this._deviceEnumAPI=false})}},{key:"playProgressTone",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!t||t&&this.progressTone){if(this.progressToneScript[this.progressToneCountry]!==null){if(!this.playingNow)this.playToneScript(this.progressToneScript[this.progressToneCountry]);this.playingNow=true}}}},{key:"stopProgressTone",value:function e(){if(this.playingNow){this.stopPlayback();this.playingNow=false}}},{key:"onIncomingCall",value:function e(t,n,r,i,o){this.dispatchEvent({name:u.Events.IncomingCall,call:m.CallManager.get().calls[t],headers:i,video:o})}},{key:"checkConnection",value:function e(){if(!this._connected)throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}},{key:"init",value:function e(t){var n=this;return new Promise(function(e,r){n._config=typeof t!=="undefined"?t:{};if(n._config.progressToneCountry!==undefined)n.progressToneCountry=n._config.progressToneCountry;if(n._config.progressTone!==true)n.progressTone=false;if(n._config.serverIp!==undefined)n.serverIp=n._config.serverIp;if(n._config.showDebugInfo!==undefined)n.showDebugInfo=n._config.showDebugInfo;if(n._config.showWarnings!==false)n.showWarnings=true;if(typeof n._config.videoContainerId==="string")n.remoteVideoContainerId=n._config.videoContainerId;if(typeof n._config.remoteVideoContainerId==="string")n.remoteVideoContainerId=n._config.remoteVideoContainerId;if(typeof n._config.localVideoContainerId==="string")n.localVideoContainerId=n._config.localVideoContainerId;if(n._config.micRequired!==false)n.micRequired=true;if(typeof n._config.videoSupport!="undefined")n.videoSupport=n._config.videoSupport;else n.videoSupport=false;if(typeof n._config.H264first!="undefined"){n._h264first=n._config.H264first;m.CallManager.get()._h264first=n._h264first}if(typeof n._config.VP8first!="undefined")n._VP8first=n._config.VP8first;if(typeof n._config.rtcStatsCollectionInterval!="undefined")m.CallManager.get().rtcStatsCollectionInterval=n._config.rtcStatsCollectionInterval;else m.CallManager.get().rtcStatsCollectionInterval=1e4;if(n._config.protocolVersion&&(n._config.protocolVersion==="2"||n._config.protocolVersion==="3")){n._callProtocolVersion=n._config.protocolVersion;m.CallManager.get().setProtocolVersion(n._callProtocolVersion)}else n._callProtocolVersion="3";if(n._config.callstatsIoParams)E.CallstatsIo.get(n._config.callstatsIoParams);if(n._config.prettyPrint)h.LogManager.get().setPrettyPrint(n._config.prettyPrint);if(n.showWarnings)n.setLogLevelAll(h.LogLevel.WARNING);if(n.showDebugInfo)n.setLogLevelAll(h.LogLevel.TRACE);if(n._config.videoConstraints!==undefined){n.videoConstraints=n._config.videoConstraints;if(n._config.experiments&&n._config.experiments.hardware){var i=k.default.CameraManager.legacyParamConverter(n._config.videoConstraints);k.default.CameraManager.get().setDefaultCamera(i)}else{g.UserMediaManager.get().setConstraints(n.videoConstraints,false)}}g.UserMediaManager.get().enableAudio(n.micRequired);g.UserMediaManager.get().enableVideo(n.videoSupport);if(window.location.hostname!="127.0.0.1"&&window.location.hostname!="localhost"&&window.location.protocol!="https:"){if(typeof console.error!="undefined"&&n.showWarnings)h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"WARNING:",h.LogLevel.WARNING,"getUserMedia() is deprecated on insecure origins, and support will be removed in the future. You should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details.")}if(n._config.experiments&&n._config.experiments.ignorewebrtc){n.RTCsupported=true}else{if(typeof webkitRTCPeerConnection!="undefined"||typeof mozRTCPeerConnection!="undefined"||typeof RTCPeerConnection!="undefined"||typeof RTCIceGatherer!="undefined"){if(typeof mozRTCPeerConnection!="undefined"){try{new mozRTCPeerConnection({iceServers:[]});n.RTCsupported=true}catch(e){}}else n.RTCsupported=true}}if(n.RTCsupported){var o;if(window.location.href.match(/^file\:\/{3}.*$/g)!=null){if(typeof console.error!="undefined"&&n.showWarnings)console.error("WebRTC requires application to be loaded from a web server")}n.voxAuth=p.Authenticator.get();n.voxAuth.setHandler({onLoginSuccessful:function e(t,r){n.loginState=2;var i={name:u.Events.AuthResult,displayName:t,result:true,tokens:r};n._resolvePromise("login",i);n.dispatchEvent(i)},onLoginFailed:function e(t){n.loginState=0;var r={name:u.Events.AuthResult,code:t,result:false};n._rejectPromise("login",r);n.dispatchEvent(r)},onSecondStageInitiated:function e(){var t={name:u.Events.AuthResult,code:301,result:false};n._rejectPromise("login",t);n.dispatchEvent(t)},onOneTimeKeyGenerated:function e(t){var r={name:u.Events.AuthResult,key:t,code:302,result:false};n._resolvePromise("loginkey",r);n.dispatchEvent(r)},onRefreshTokenFailed:function e(t){var r={name:u.Events.RefreshTokenResult,code:t,result:false};n._resolvePromise("token_refresh",r);n.dispatchEvent(r)},onRefreshTokenSuccess:function e(t){var r={name:u.Events.RefreshTokenResult,tokens:t,result:true};n._rejectPromise("token_refresh",r);n.dispatchEvent(r)}});n.voxSignaling.addHandler(n);o=setInterval(function(){if(typeof document!="undefined"){clearInterval(o);n.deviceEnumAPI();n.dispatchEvent({name:u.Events.SDKReady,version:n.version});e({name:u.Events.SDKReady,version:n.version})}},100)}else{r(new Error("NO_WEBRTC_SUPPORT"));throw new Error("NO_WEBRTC_SUPPORT")}})}},{key:"_resolvePromise",value:function e(t,n){var r=this._promises[t];if(r){r.resolve(n);this._promises[t]=undefined}}},{key:"_rejectPromise",value:function e(t,n){var r=this._promises[t];if(r){r.reject(n);this._promises[t]=undefined}}},{key:"call",value:function e(t,n,r,i){d.Utils.checkCA();var a={H264first:this._h264first,VP8first:this._VP8first};if(typeof t==="string"||typeof t==="number"){a={number:t,video:n,customData:r,extraHeaders:i}}else{a=t}switch(o(a.video)){case"boolean":a.video={sendVideo:a.video,receiveVideo:a.video};break;case"undefined":a.video={sendVideo:false,receiveVideo:true};break}var s=this.voxCallManager.call(a);return s}},{key:"config",value:function e(){return this._config}},{key:"connect",value:function e(t){var n=this;return new Promise(function(e,r){n._promises["connect"]={resolve:e,reject:r};if(n.serverIp!==undefined){var i=void 0;if(o(n.serverIp)==="object"){n.serversList=n.serverIp;i=n.serversList[0]}else i=n.serverIp;n.connectTo(i,null,t)}else{var a=function e(n){var r=String(n).indexOf(";"),i=void 0;if(r==-1){i=n}else{this.serversList=n.split(";");i=this.serversList[0]}this.connectTo(i,null,t)};d.Utils.getServers(a.bind(n),false,n)}})}},{key:"connectTo",value:function e(t,n,r){var i=this;if(this._connected){throw new Error("ALREADY_CONNECTED_TO_VOXIMPLANT")}this.host=t;if(!this.micRequired||n===true)this.voxSignaling.connectTo(t,true,true,r,this._callProtocolVersion);else{this.voxMediaManager.queryMedia().then(function(e){i.deviceEnumAPI();if(i.micRequired)i.voxSignaling.connectTo(i.host,true,true,r,i._callProtocolVersion);i.dispatchEvent({name:u.Events.MicAccessResult,result:true,stream:e})}).catch(function(e){i.dispatchEvent({name:u.Events.MicAccessResult,result:false,reason:e})})}}},{key:"disconnect",value:function e(){this.checkConnection();this.voxSignaling.disconnect();this.voxMediaManager.stopLocalStream();this.voxSignaling.removeRPCHandler(L.RemoteEvent.onCallRemoteFunctionError);this.voxSignaling.removeRPCHandler(L.RemoteEvent.handleError)}},{key:"setOperatorACDStatus",value:function e(t){var n=this;return new Promise(function(e,r){d.Utils.checkCA();n.voxSignaling.callRemoteFunction(S.RemoteFunction.setOperatorACDStatus,t);e()})}},{key:"login",value:function e(t,n,r){var i=this;this.loginState=1;return new Promise(function(e,o){i._promises["login"]={resolve:e,reject:o};r=typeof r!=="undefined"?r:{};r=d.Utils.extend({},r);if(!i._connected){o(new Error("NOT_CONNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}if(i._config.experiments&&i._config.experiments.mediaServer){r.mediaServer=i._config.experiments.mediaServer}i.voxAuth.basicLogin(t,n,r)})}},{key:"loginWithCode",value:function e(t,n,r){var i=this;this.loginState=1;return new Promise(function(e,o){i._promises["login"]={resolve:e,reject:o};r=typeof r!=="undefined"?r:{};r=d.Utils.extend({serverPresenceControl:false},r);if(!i._connected){o(new Error("NOT_CONNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}i.voxAuth.loginStage2(t,n,r)})}},{key:"loginWithToken",value:function e(t,n,r){var i=this;this.loginState=1;return new Promise(function(e,o){i._promises["login"]={resolve:e,reject:o};r=typeof r!=="undefined"?r:{};r=d.Utils.extend({serverPresenceControl:false},r);r.accessToken=n;if(!i._connected){o(new Error("NOT_CONNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}i.voxAuth.tokenLogin(t,r)})}},{key:"tokenRefresh",value:function e(t,n,r){var i=this;return new Promise(function(e,o){i._promises["token_refresh"]={resolve:e,reject:o};i.voxAuth.tokenRefresh(t,n,r)})}},{key:"requestOneTimeLoginKey",value:function e(t){var n=this;return new Promise(function(e,r){n._promises["loginkey"]={resolve:e,reject:r};if(!n._connected){r(new Error("NOT_CONNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}n.voxAuth.generateOneTimeKey(t)})}},{key:"loginWithOneTimeKey",value:function e(t,n,r){var i=this;this.loginState=1;return new Promise(function(e,o){i._promises["login"]={resolve:e,reject:o};r=typeof r!=="undefined"?r:{};r=d.Utils.extend({serverPresenceControl:false},r);if(!i._connected){o(new Error("NOT_COFNNECTED_TO_VOXIMPLANT"));throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}i.voxAuth.loginUsingOneTimeKey(t,n,r)})}},{key:"connected",value:function e(){return this._connected}},{key:"showLocalVideo",value:function e(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(this._config.experiments&&this._config.experiments.hardware){var o=document.getElementById(t.getInstance().localVideoContainerId)||document.body;var a=document.getElementById("voximplantlocalvideo");if(n){if(a===null){a=document.createElement("video");a.id="voximplantlocalvideo";a.autoplay=true;a.setAttribute("playsinline",null);a.setAttribute("muted",null);if(o.firstChild)o.insertBefore(a,o.firstChild);else o.appendChild(a)}else{a.style.display="block"}k.default.StreamManager.get().getMirrorStream().then(function(e){v.default.attachMedia(e,a)})}else{if(typeof a!=="undefined"&&a!==null){a.style.display="none"}if(i)k.default.StreamManager.get().remMirrorStream()}if(r&&a)a.style.cssText+="transform: rotateY(180deg);"+"-webkit-transform:rotateY(180deg);"+"-moz-transform:rotateY(180deg);"}else{this.voxMediaManager.showLocalVideo(n,r,i)}}},{key:"setLocalVideoPosition",value:function e(t,n){throw new Error("Deprecated: please use CSS to position '#voximplantlocalvideo' element")}},{key:"setLocalVideoSize",value:function e(t,n){throw new Error("Deprecated: please use CSS to set size of '#voximplantlocalvideo' element")}},{key:"setVideoSettings",value:function e(t,n,r){var i=this;g.UserMediaManager.get().setConstraints(t,true).then(function(e){if(document.getElementById("voximplantlocalvideo")!==null)v.default.attachMedia(i.voxMediaManager.currentStream,document.getElementById("voximplantlocalvideo"));if(typeof n=="function")n(e)}).catch(function(e){if(typeof r=="function")r(e)})}},{key:"setVideoBandwidth",value:function e(t){this.checkConnection();y.PCFactory.get().setBandwidthParams(t);this.voxSignaling.callRemoteFunction(S.RemoteFunction.setDesiredVideoBandwidth,t)}},{key:"playToneScript",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;d.Utils.playToneScript(t,n)}},{key:"stopPlayback",value:function e(){if(d.Utils.stopPlayback())this.dispatchEvent({name:u.Events.PlaybackFinished})}},{key:"volume",value:function e(t){if(t===undefined){return this._vol}else{if(t>100)t=100;if(t<0)t=0;C.Renderer.get().setPlaybackVolume(t/100);this._vol=t}}},{key:"audioSources",value:function e(){return this.voxMediaManager.audioSourcesList}},{key:"videoSources",value:function e(){return this.voxMediaManager.videoSourcesList}},{key:"audioOutputs",value:function e(){return this.voxMediaManager.audioOutputsList}},{key:"useAudioSource",value:function e(t,n,r){var i=this;return new Promise(function(e,o){i.voxMediaManager.useAudioInputDevice(t);i.voxMediaManager.enableAudio(true);i.voxMediaManager.queryMedia().then(function(t){if(typeof n=="function")n(t);e(t);g.UserMediaManager.get().updateLocalVideo(t)}).catch(function(e){if(typeof r=="function")r(e);o(e)})})}},{key:"useVideoSource",value:function e(t,n,r){var i=this;return new Promise(function(e,o){i.voxMediaManager.useVideoDevice(t);if(g.UserMediaManager.get().isVideoEnabled()){i.voxMediaManager.queryMedia().then(function(t){if(typeof n=="function")n(t);g.UserMediaManager.get().updateLocalVideo(t);e(t)}).catch(function(e){if(typeof r=="function")r(e);o(e)})}else{g.UserMediaManager.get().updateLocalVideo()}})}},{key:"useAudioOutput",value:function e(t){var n=this;return new Promise(function(e,r){if(v.default.getWSVendor(true)!=="chrome")r(new Error("Unsupported browser. Only Google Chrome 49 and above."));n._defaultSinkId=t;e()})}},{key:"attachRecordingDevice",value:function e(t,n){var r=this;this.voxMediaManager.enableAudio(true);if(this._config.videoSupport)this.voxMediaManager.enableVideo(true);return new Promise(function(e,i){return r.voxMediaManager.queryMedia().then(function(e){if(typeof t=="function")t(e);r.dispatchEvent({name:u.Events.MicAccessResult,result:true,stream:e})}).catch(function(e){if(typeof n=="function")n(e);r.dispatchEvent({name:u.Events.MicAccessResult,result:false,reason:e})})})}},{key:"detachRecordingDevice",value:function e(){g.UserMediaManager.get().stopLocalStream()}},{key:"setCallActive",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return new Promise(function(e,r){d.Utils.checkCA();if(t)return t.setActive(n);else r("trying to hold unknown call "+t)})}},{key:"sendVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.voxMediaManager.sendVideo(t)}},{key:"isRTCsupported",value:function e(){if(typeof webkitRTCPeerConnection!="undefined"||typeof mozRTCPeerConnection!="undefined"||typeof RTCPeerConnection!="undefined"||typeof RTCIceGatherer!="undefined"){if(typeof mozRTCPeerConnection!="undefined"){try{new mozRTCPeerConnection({iceServers:[]});return true}catch(e){return false}}else{return true}}}},{key:"transferCall",value:function e(t,n){d.Utils.checkCA();this.voxCallManager.transferCall(t,n)}},{key:"setLogLevel",value:function e(t,n){h.LogManager.get().setLogLevel(t,n)}},{key:"setLogLevelAll",value:function e(t){this.setLogLevel(h.LogCategory.SIGNALING,t);this.setLogLevel(h.LogCategory.RTC,t);this.setLogLevel(h.LogCategory.ORTC,t);this.setLogLevel(h.LogCategory.USERMEDIA,t);this.setLogLevel(h.LogCategory.CALL,t);this.setLogLevel(h.LogCategory.CALLEXP2P,t);this.setLogLevel(h.LogCategory.CALLEXSERVER,t);this.setLogLevel(h.LogCategory.CALLMANAGER,t);this.setLogLevel(h.LogCategory.CLIENT,t);this.setLogLevel(h.LogCategory.AUTHENTICATOR,t);this.setLogLevel(h.LogCategory.PCFACTORY,t);this.setLogLevel(h.LogCategory.UTILS,t);this.setLogLevel(h.LogCategory.MESSAGING,t);this.setLogLevel(h.LogCategory.REINVITEQ,t);this.setLogLevel(h.LogCategory.HARDWARE,t)}},{key:"onSignalingConnected",value:function e(){this._connected=true;var t={name:u.Events.ConnectionEstablished};this._resolvePromise("connect",t);this.dispatchEvent(t)}},{key:"onSignalingClosed",value:function e(){this._connected=false;this.dispatchEvent({name:u.Events.ConnectionClosed});if(this.progressTone)this.stopProgressTone()}},{key:"onSignalingConnectionFailed",value:function e(t){this._connected=false;if(this.serversList.length>1&&(typeof this.serverIp==="undefined"||o(this.serverIp)==="object")){this.serversList.splice(0,1);this.connectTo(this.serversList[0],true)}else{var n={name:u.Events.ConnectionFailed,message:t};this._rejectPromise("connect",n);this.dispatchEvent(n)}}},{key:"onMediaConnectionFailed",value:function e(){}},{key:"getCall",value:function e(t){return m.CallManager.get().calls[t]}},{key:"removeCall",value:function e(t){m.CallManager.get().removeCall(t)}},{key:"screenSharingSupported",value:function e(){return v.default.screenSharingSupported()}},{key:"addEventListener",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,n,r)}},{key:"removeEventListener",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeEventListener",this).call(this,n,r)}},{key:"on",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,n,r)}},{key:"off",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,n,r)}},{key:"sslset",value:function e(t){this.voxSignaling.writeLog=t}},{key:"sslget",value:function e(){return this.voxSignaling.getLog()}},{key:"getZingayaAPI",value:function e(){return new R.ZingayaAPI(this)}},{key:"getMediaCache",value:function e(){return M.MediaCache.get()}},{key:"registerForPushNotificatuons",value:function e(t){return T.PushService.register(t)}},{key:"unregisterForPushNotificatuons",value:function e(t){return T.PushService.unregister(t)}},{key:"handlePushNotification",value:function e(t){return T.PushService.incomingPush(t)}},{key:"getGUID",value:function e(){return(new b.GUID).toString()}},{key:"setSilentLogging",value:function e(t){h.LogManager.get().shadowLogging=t}},{key:"getSilentLog",value:function e(){return h.LogManager.get().getSLog()}},{key:"getClientState",value:function e(){var t=this.voxSignaling.currentState;if(t==f.VoxSignalingState.CONNECTING||t==f.VoxSignalingState.WSCONNECTED){return h.ClientState.CONNECTING}else if(t==f.VoxSignalingState.CLOSING||t==f.VoxSignalingState.IDLE)return h.ClientState.DISCONNECTED;else if(t==f.VoxSignalingState.CONNECTED){if(this.loginState==1){return h.ClientState.LOGGING_IN}else if(this.loginState==2){return h.ClientState.LOGGED_IN}return h.ClientState.CONNECTED}}},{key:"setSwfColor",value:function e(){h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"NOT SUPPORTED",h.LogLevel.ERROR,"setSwfColor deprecated, and not supported!")}},{key:"_traceName",value:function e(){return"Client"}},{key:"version",get:function e(){return"4.2.11022-1513253698"}}],[{key:"getInstance",value:function e(){if(typeof t.instance=="undefined")t.instance=new t;return t.instance}}]);return t}(_.EventDispatcher);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"deviceEnumAPI",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"playProgressTone",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"stopProgressTone",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onIncomingCall",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"checkConnection",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"init",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"call",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"config",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"connect",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"connectTo",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"disconnect",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setOperatorACDStatus",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"login",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"loginWithCode",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"loginWithToken",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"tokenRefresh",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"requestOneTimeLoginKey",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"loginWithOneTimeKey",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"connected",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"showLocalVideo",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLocalVideoPosition",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLocalVideoSize",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setVideoSettings",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setVideoBandwidth",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"playToneScript",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"stopPlayback",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"volume",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"audioSources",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"videoSources",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"audioOutputs",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"useAudioSource",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"useVideoSource",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"useAudioOutput",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"attachRecordingDevice",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"detachRecordingDevice",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setCallActive",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"sendVideo",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"isRTCsupported",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"transferCall",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLogLevel",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLogLevelAll",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onSignalingConnected",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onSignalingClosed",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onSignalingConnectionFailed",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onMediaConnectionFailed",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"getCall",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"removeCall",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"addEventListener",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"removeEventListener",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"on",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"off",null);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P,"getInstance",null);t.Client=P},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(33);var l=n(5);var u=n(8);var d=n(3);var f;(function(e){e[e["LOCAL"]=-1]="LOCAL";e[e["ANY"]=0]="ANY";e[e["REMOTE"]=1]="REMOTE"})(f=t.MediaDirection||(t.MediaDirection={}));var g=function(){function e(){o(this,e);this.audioSourcesList=[];this.videoSourcesList=[];this.audioOutputsList=[];this.videoContainerId="voximplantlocalvideo";this.log=s.LogManager.get().createLogger(s.LogCategory.USERMEDIA,"");this.config=new c.MediaCaptureConfig;this.clearConstraints();this.enableAudio(true);this.enableVideo(true);this.handlers=new Array;this.mediaAccessGranted=false;this._localVideos=new Array;if(typeof window.AudioContext!="undefined"||typeof window.webkitAudioContext!="undefined"){window.AudioContext=window.AudioContext||window.webkitAudioContext;try{this.audioContext=new AudioContext}catch(e){this.audioContext=null}}}r(e,[{key:"clearConstraints",value:function e(){}},{key:"addHandler",value:function e(t){this.handlers.push(t)}},{key:"enableAudio",value:function e(t){this.config.audioEnabled=t}},{key:"enableVideo",value:function e(t){this.config.videoEnabled=t}},{key:"setLocalStream",value:function e(t){if(t.getAudioTracks().length>0){this.currentAudioTrack=t.getAudioTracks()[0]}if(t.getVideoTracks().length>0){this.currentVideoTrack=t.getVideoTracks()[0]}if(!this._currentStream){this._currentStream=t}else{while(this._currentStream.getTracks().length>0){this._currentStream.removeTrack(this._currentStream.getTracks()[0])}if(this.currentAudioTrack)this._currentStream.addTrack(this.currentAudioTrack);if(this.currentVideoTrack)this._currentStream.addTrack(this.currentVideoTrack)}for(var n in u.PCFactory.get().peerConnections){this.attachTo(u.PCFactory.get().peerConnections[n])}}},{key:"queryMedia",value:function e(){var t=l.default.composeConstraints(this.config);return this.getQueryMedia(t)}},{key:"queryMediaSilent",value:function e(){var t=l.default.composeConstraints(this.config);this.muteAllLocal();return this.getQueryMediaSilent(t)}},{key:"getConstrainWithSendFlag",value:function e(t,n){var r=JSON.parse(JSON.stringify(this.config));if(t!=null)r.audioEnabled=t;if(n!=null)r.videoEnabled=n;return l.default.composeConstraints(r)}},{key:"getQueryMedia",value:function e(t){var n=this;return new Promise(function(e,r){n.getQueryMediaSilent(t).then(function(t){n.processGrantedMedia(t);e(t)}).catch(function(e){return r})})}},{key:"getQueryMediaSilent",value:function e(t){var n=this;return new Promise(function(e,r){l.default.getUserMedia(t).then(function(r){n.validConstraints=t;n.log.info("Media access granted");e(r)}).catch(function(t){n.log.info("Media access rejected: "+t.name);if(n.validConstraints){l.default.getUserMedia(n.validConstraints).then(function(t){n.log.info("Regained media access using previous settings");e(t)}).catch(function(e){r(e);n.log.error("Failed to regain media access with previously valid constraints")})}r(t)})})}},{key:"processGrantedMedia",value:function e(t){var n=this;this.stopLocalStream();this.setLocalStream(t);this.handlers.forEach(function(e){try{e.onMediaAccessGranted(t)}catch(e){n.log.error("Error in callback "+e)}})}},{key:"muteAllLocal",value:function e(){if(this.currentAudioTrack){this.currentAudioTrack.stop();this.currentAudioTrack=null}if(this.currentVideoTrack){this.currentVideoTrack.stop();this.currentVideoTrack=null}}},{key:"getDevices",value:function t(){if(e.get().audioSourcesList.length!==0)this.audioSourcesList=[];if(e.get().videoSourcesList.length!==0)this.videoSourcesList=[];if(e.get().audioOutputsList.length!==0)this.audioOutputsList=[];var n=new Promise(function(t,n){navigator.mediaDevices.enumerateDevices().then(function(n){for(var r=0;r!=n.length;++r){var i=[0,0,0];var o=n[r];if(o.kind==="audio"||o.kind==="audioinput")e.get().audioSourcesList.push({id:o.id||o.deviceId,name:o.label||"Audio recording device "+i[0]++});else if(o.kind==="video"||o.kind==="videoinput")e.get().videoSourcesList.push({id:o.id||o.deviceId,name:o.label||"Video recording device "+i[1]++});else if(o.kind==="audiooutput")e.get().audioOutputsList.push({id:o.id||o.deviceId,name:o.label||"Audio playback device "+i[2]++})}t()}).catch(function(e){n(e)})});return n}},{key:"useVideoDevice",value:function e(t){this.config.videoInputId=t}},{key:"useAudioInputDevice",value:function e(t){this.config.audioInputId=t}},{key:"attachTo",value:function e(t){this._legacySoundControll=true;t.bindLocalMedia(this._currentStream)}},{key:"attachToSound",value:function e(t){this._legacySoundControll=true;if(this._currentStream&&this._currentStream.getAudioTracks().length)t.bindLocalMedia(new MediaStream(this._currentStream.getAudioTracks()))}},{key:"sendVideo",value:function e(t){if(this.currentVideoTrack)this.currentVideoTrack.enabled=t}},{key:"isVideoEnabled",value:function e(){return this.config.videoEnabled}},{key:"stopLocalStream",value:function e(){if(this._currentStream){this.stopStream(this._currentStream);this._currentStream=null;for(var t in u.PCFactory.get().peerConnections){if(u.PCFactory.get().peerConnections.hasOwnProperty(t)){u.PCFactory.get().peerConnections[t].bindLocalMedia(null)}}}}},{key:"stopStream",value:function e(t){t.getTracks().forEach(function(e){e.stop()})}},{key:"setConstraints",value:function e(t,n){var r=this;this.config.videoEnabled=true;return new Promise(function(e,i){r.config.setVideoSettings(t);if(n===true)r.queryMedia().then(function(t){e(t)}).catch(function(e){i(e)})})}},{key:"showLocalVideo",value:function t(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var r=this;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this.currentLocalVideoSets={flag:n,mirror:i,detachCamera:o};if(typeof this.currentStream!="undefined"){var a=document.getElementById(d.Client.getInstance().localVideoContainerId)||document.body;var s=document.getElementById(this.videoContainerId);if(n){if(s===null){s=document.createElement("video");s.id=this.videoContainerId;s.autoplay=true;s.setAttribute("playsinline",null);s.setAttribute("muted",null);if(a.firstChild)a.insertBefore(s,a.firstChild);else a.appendChild(s)}else{s.style.display="block"}l.default.getUserMedia(e.get().getConstrainWithSendFlag(false,true)).then(function(e){r._localVideos.push(e);l.default.attachMedia(e,s)})}else{if(typeof s!=="undefined"&&s!==null){s.style.display="none"}if(o)for(var c=0;c<this._localVideos.length;c++){this.stopStream(this._localVideos[c])}}if(i&&s)s.style.cssText+="transform: rotateY(180deg);"+"-webkit-transform:rotateY(180deg);"+"-moz-transform:rotateY(180deg);"}}},{key:"resetLocalVideo",value:function e(){this._localVideos=[];this.showLocalVideo(this.currentLocalVideoSets.flag,this.currentLocalVideoSets.mirror,this.currentLocalVideoSets.detachCamera)}},{key:"updateLocalVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var n=document.getElementById(this.videoContainerId);if(t===null&&n!==null&&n.style.display!="none")this.showLocalVideo(true);else{if(n===null||t.getVideoTracks().length==0){return false}else l.default.attachMedia(t,n)}}},{key:"testLocalStream",value:function e(t,n){var r=false;var i=false;var o=true;var a=false;var s=undefined;try{for(var c=this._currentStream.getTracks()[Symbol.iterator](),l;!(o=(l=c.next()).done);o=true){var u=l.value;if(u.kind==="audio")r=true;if(u.kind==="video")i=true}}catch(e){a=true;s=e}finally{try{if(!o&&c.return){c.return()}}finally{if(a){throw s}}}return t===r&&n===i}},{key:"_traceName",value:function e(){return"UserMediaManager"}},{key:"currentStream",get:function e(){return this._currentStream}},{key:"legacySoundControll",get:function e(){return this._legacySoundControll}}],[{key:"get",value:function t(){if(!this.inst)this.inst=new e;return this.inst}},{key:"updateMuteState",value:function t(n,r,i){var o=u.PCFactory.get().peerConnections;for(var a in o){if(o.hasOwnProperty(a)){switch(r){case f.ANY:this.updateMuteState(n,f.LOCAL,i);this.updateMuteState(n,f.REMOTE,i);break;case f.LOCAL:e.getAudioTracks(o[a].localStream).map(function(e){e.enabled=i});break;case f.REMOTE:o[a].remoteStreams.map(function(t){e.getAudioTracks(t).map(function(e){e.enabled=i})});return;default:return false}}}}},{key:"getAudioTracks",value:function e(t){if(t){if(t.audioTracks)return t.audioTracks;if(t.getAudioTracks)return t.getAudioTracks()}return null}},{key:"getVideoTracks",value:function e(t){if(t){if(t.videoTracks)return t.videoTracks;if(t.getVideoTracks)return t.getVideoTracks()}return null}}]);return e}();a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"clearConstraints",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"addHandler",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"enableAudio",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"enableVideo",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"setLocalStream",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"queryMedia",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"queryMediaSilent",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"processGrantedMedia",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"muteAllLocal",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"getDevices",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"useVideoDevice",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"useAudioInputDevice",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"attachTo",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"attachToSound",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"sendVideo",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"stopLocalStream",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"stopStream",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"setConstraints",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"showLocalVideo",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"updateLocalVideo",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g.prototype,"testLocalStream",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g,"updateMuteState",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g,"getAudioTracks",null);a([s.LogManager.d_trace(s.LogCategory.USERMEDIA)],g,"getVideoTracks",null);t.UserMediaManager=g},function(e,t,n){"use strict";var r=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:true});var i=n(0);var o=n(31);var a=n(39);var s=n(40);var c=n(42);var l=n(17);var u=n(43);var d;(function(e){var t=void 0;(function(e){e[e["Firefox"]=1]="Firefox";e[e["Webkit"]=2]="Webkit";e[e["Edge"]=3]="Edge";e[e["Safari"]=4]="Safari"})(t||(t={}));var n=void 0;function d(e,t,n){var i=e;if((typeof i==="undefined"?"undefined":r(i))!="object"){i={}}i[t]={ideal:n};return i}function f(e,r,o){switch(n){case t.Firefox:return new s.WebRTCPC(e,r,o);case t.Webkit:return new s.WebRTCPC(e,r,o);case t.Safari:return new s.WebRTCPC(e,r,o);case t.Edge:return new s.WebRTCPC(e,r,o);default:i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Unsupported browser "+navigator.userAgent);return null}}e.peerConnectionFactory=f;function g(){return n===t.Firefox||n===t.Webkit}e.isScreenSharingSupported=g;function p(e){return navigator.mediaDevices.getUserMedia(e)}function v(e,t){return new l.SignalingDTMFSender(t)}function h(){return new Promise(function(e){e(false)})}function y(e){var t=false;var n=false;if(e.audioEnabled){t=true;if(e.audioInputId)t=d(t,"deviceId",e.audioInputId)}if(e.videoEnabled){n=true;if(e.videoSettings){n=e.videoSettings}if(e.videoInputId)n=d(n,"deviceId",e.videoInputId)}return{peerIdentity:null,audio:t,video:n}}function m(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(e===false){return"voxmobile"}if(!n){C()}switch(n){case t.Firefox:return"firefox";case t.Webkit:return"chrome";case t.Safari:return"safari";case t.Edge:return"voxmobile";default:return""}}e.getWSVendor=m;function C(){if(navigator["mozGetUserMedia"]){n=t.Firefox}else if(navigator["webkitGetUserMedia"]){n=t.Webkit}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){n=t.Edge}else if(navigator["getUserMedia"]){n=t.Safari}}function _(){}function S(){if(!n){C()}if(n){i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Detected browser "+t[n])}e.getUserMedia=p;e.getDTMFSender=v;e.screenSharingSupported=h;switch(n){case t.Firefox:e.attachMedia=o.FF.attachStream;e.detachMedia=o.FF.detachStream;e.getScreenMedia=o.FF.getScreenMedia;e.getRTCStats=o.FF.getRTCStats;e.getUserMedia=o.FF.getUserMedia;e.screenSharingSupported=o.FF.screenSharingSupported;e.getDTMFSender=o.FF.getDTMFSender;break;case t.Webkit:e.attachMedia=a.Webkit.attachStream;e.detachMedia=a.Webkit.detachStream;e.getScreenMedia=a.Webkit.getScreenMedia;e.getRTCStats=a.Webkit.getRTCStats;e.getUserMedia=a.Webkit.getUserMedia;e.screenSharingSupported=a.Webkit.screenSharingSupported;e.getDTMFSender=a.Webkit.getDTMFSender;break;case t.Safari:e.attachMedia=u.Safari.attachStream;e.detachMedia=u.Safari.detachStream;e.getScreenMedia=u.Safari.getScreenMedia;e.getRTCStats=u.Safari.getRTCStats;e.getUserMedia=o.FF.getUserMedia;e.getDTMFSender=u.Safari.getDTMFSender;break;case t.Edge:e.attachMedia=c.Edge.attachStream;e.detachMedia=c.Edge.detachStream;e.getScreenMedia=c.Edge.getScreenMedia;e.getRTCStats=c.Edge.getRTCStats;break;default:i.LogManager.get().writeMessage(i.LogCategory.RTC,"Core",i.LogLevel.INFO,"Unsupported browser "+navigator.userAgent)}e.composeConstraints=y}e.init=S})(d||(d={}));t.default=d},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(14);var c=n(9);var l=n(1);var u=n(21);var d=n(10);var f=n(11);var g=n(0);var p=n(8);var v=n(3);var h=n(19);var y=n(35);var m=n(36);var C=n(2);var _=n(12);var S=n(37);var L=n(16);var E=n(38);var M=function(){function e(){var t=this;o(this,e);this.protocolVersion="3";this._h264first=false;this._calls={};this.voxSignaling=l.VoxSignaling.get();this.log=g.LogManager.get().createLogger(g.LogCategory.SIGNALING,"CallManager");this.voxSignaling.addHandler(this);this.voxSignaling.setRPCHandler(_.RemoteEvent.handleIncomingConnection,function(e,n,r,i,o){t.handleIncomingConnection(e,n,r,i,o)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleConnectionConnected,function(e,n,r){t.handleConnectionConnected(e,n,r)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleConnectionDisconnected,function(e,n,r){t.handleConnectionDisconnected(e,n,r)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleRingOut,function(e){t.handleRingOut(e)});this.voxSignaling.setRPCHandler(_.RemoteEvent.stopRinging,function(e){t.stopRinging(e)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleConnectionFailed,function(e,n,r,i){t.handleConnectionFailed(e,n,r,i)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleSIPInfo,function(e,n,r,i,o){t.handleSIPInfo(e,n,r,i,o)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleSipEvent,function(e){t.handleSipEvent(e)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleTransferStarted,function(e){t.handleTransferStarted(e)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleTransferComplete,function(e){t.handleTransferComplete(e)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleTransferFailed,function(e){t.handleTransferFailed(e)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleReInvite,function(e,n,r){t.handleInReinvite(e,n,r)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleAcceptReinvite,function(e,n,r){t.handleReinvite(e,n,r)});this.voxSignaling.setRPCHandler(_.RemoteEvent.handleRejectReinvite,function(e,n,r){t.handleRejectReinvite(e,n,r)});this.voxSignaling.setRPCHandler(_.RemoteEvent.startEarlyMedia,function(e,n,r){t.startEarlyMedia(e,n,r)})}r(e,[{key:"call",value:function t(n){var r=this;var i={number:null,video:{sendVideo:false,receiveVideo:false},customData:null,extraHeaders:{},wiredLocal:true,wiredRemote:true,H264first:this._h264first,VP8first:false,forceActive:false,extraParams:{}};var o=u.Utils.mixObjectToLeft(i,n);o=e.addCustomDataToHeaders(o);var a=u.Utils.generateUUID();if(this._calls[a]){this.log.error("Call "+a+" already exists");throw new Error("Internal error")}var t=this.getCallInstance(a,d.Authenticator.get().displayName,false,o);if(L.CallstatsIo.isModuleEnabled()){o.extraHeaders[f.Constants.CALLSTATSIOID_HEADER]=a}if(o.VP8first)t.rearangeCodecs=E.CodecSorterHelpers.VP8Sorter;if(o.H264first)t.rearangeCodecs=E.CodecSorterHelpers.H264Sorter;var s=false;t.settings.active=true;if(Object.keys(this._calls).length>1&&!o.forceActive){t.setActiveForce(false);s=true}if(typeof o.extraHeaders[f.Constants.DIRECT_CALL_HEADER]==="undefined"&&this.protocolVersion=="2"){this.voxSignaling.callRemoteFunction(C.RemoteFunction.createCall,-1,o.number,o.video,a,null,null,o.extraHeaders,o.extraParams)}else{p.PCFactory.get().setupDirectPC(a,h.PeerConnectionMode.P2P,n.video,s).then(function(e){t.peerConnection=p.PCFactory.get().peerConnections[a];var n={tracks:t.peerConnection.getTrackKind()};r.voxSignaling.callRemoteFunction(C.RemoteFunction.createCall,-1,o.number,true,a,null,null,o.extraHeaders,"",e.sdp,n)})}t.sendVideo(o.video.sendVideo);return t}},{key:"handleIncomingConnection",value:function e(t,n,r,i,o){var a=this;if(this._calls[t]){this.log.error("Call "+t+" already exists");throw new Error("Internal error")}var s=v.Client.getInstance().videoSupport;var c={number:n,extraHeaders:i,video:s,wiredLocal:true,wiredRemote:true,forceActive:false};var l=this.getCallInstance(t,r,true,c);if(this._h264first)l.rearangeCodecs=E.CodecSorterHelpers.H264Sorter;var u=false;l.settings.active=true;if(Object.keys(this._calls).length>1){l.setActiveForce(false);u=true}if(typeof c.extraHeaders[f.Constants.DIRECT_CALL_HEADER]==="undefined"&&this.protocolVersion=="2"){l.peerConnection=p.PCFactory.get().getPeerConnect(t);v.Client.getInstance().onIncomingCall(t,n,r,i,this.isSDPHasVideo(o))}else{p.PCFactory.get().incomeDirectPC(t,{receiveVideo:true,sendVideo:true},o,u).then(function(e){l.peerConnection=e;v.Client.getInstance().onIncomingCall(t,n,r,i,a.isSDPHasVideo(o))})}}},{key:"getCallInstance",value:function e(t,n,r,i){var o=void 0;if(this.protocolVersion=="3"){o=new S.CallExMedia(t,n,r,i)}else if(typeof i.extraHeaders[f.Constants.DIRECT_CALL_HEADER]!="undefined")o=new m.CallExP2P(t,n,r,i);else o=new y.CallExServer(t,n,r,i);this._calls[t]=o;return o}},{key:"isSDPHasVideo",value:function e(t){var n=t.indexOf("m=video");if(n===-1)return false;var r=t.indexOf("a=sendrecv",n);var i=t.indexOf("a=sendonly",n);var o=t.indexOf("m=",n);if(r!==-1&&(r<o||o===-1)||i!==-1&&(i<o||o===-1))return true;return false}},{key:"findCall",value:function e(t,n){var r=this._calls[t];if(t==="")r=this._calls[Object.keys(this._calls)[0]];if(typeof r=="undefined"){this.log.warning("Received "+n+" for unknown call "+t);return null}return r}},{key:"handleRingOut",value:function e(t){var n=this.findCall(t,"handleRingOut");if(typeof n=="undefined")return;v.Client.getInstance().playProgressTone(true);n.onRingOut();n.canStartSendingCandidates()}},{key:"handleConnectionConnected",value:function e(t,n,r){var i=this.findCall(t,"handleConnectionConnected");i.signalingConnected=true;i.canStartSendingCandidates();if(typeof i=="undefined"){return}i.onConnected(n,r);if(typeof r!="undefined"&&r.length>0){var o=r.indexOf("m=video");if(o!==-1){var a=r.indexOf("a=sendrecv",o);var s=r.indexOf("a=sendonly",o);var c=r.indexOf("a=recvonly",o);var l=r.indexOf("a=inactive",o);if(a===-1&&s===-1&&c===-1&&l===-1)r+="a=inactive\r\n"}i.peerConnection.processRemoteAnswer(n,r)}}},{key:"startEarlyMedia",value:function e(t,n,r){var i=this.findCall(t,"startEarlyMedia");i.settings.hasEarlyMedia=true;if(typeof r!="undefined"){i.peerConnection.processRemoteAnswer(n,r)}v.Client.getInstance().stopProgressTone()}},{key:"handleConnectionDisconnected",value:function e(t,n,r){var i=this.findCall(t,"handleConnectionDisconnected");if(!i)return;v.Client.getInstance().stopProgressTone();i.onDisconnected(n,r);delete this._calls[t]}},{key:"handleSIPInfo",value:function e(t,n,r,i,o){var a=this.findCall(t,"handleSIPInfo");if(typeof a=="undefined")return;a.onInfo(a,n,r,i,o)}},{key:"stopRinging",value:function e(t){var n=this.findCall(t,"stopRinging");n.canStartSendingCandidates();if(typeof n=="undefined")return;v.Client.getInstance().stopProgressTone();n.onStopRinging()}},{key:"handleSipEvent",value:function e(t){}},{key:"handleTransferStarted",value:function e(t){}},{key:"handleTransferComplete",value:function e(t){var n=this.findCall(t,"handleTransferComplete");if(typeof n=="undefined")return;n.onTransferComplete()}},{key:"handleTransferFailed",value:function e(t){var n=this.findCall(t,"handleTransferFailed");if(typeof n=="undefined")return;n.onTransferFailed()}},{key:"handleReinvite",value:function e(t,n,r){var i=this.findCall(t,"handleReinvite");if(typeof i=="undefined")return;var o=this.isSDPHasVideo(r);i.peerConnection.handleReinvite(n,r,o)}},{key:"handleRejectReinvite",value:function e(t,n,r){var i=this.findCall(t,"handleReinvite");if(typeof i=="undefined")return;i.dispatchEvent({code:20,call:i})}},{key:"handleInReinvite",value:function e(t,n,r){var i=this.findCall(t,"handleReinvite");if(typeof i=="undefined")return;i.runIncomingReInvite(n,r);i.dispatchEvent({name:c.CallEvents.PendingUpdate,result:true,call:i})}},{key:"handleConnectionFailed",value:function e(t,n,r,i){var o=this.findCall(t,"handleConnectionFailed");if(typeof o=="undefined")return;delete this._calls[t];v.Client.getInstance().stopProgressTone();o.onFailed(n,r,i)}},{key:"onSignalingConnected",value:function e(){}},{key:"onSignalingClosed",value:function e(){for(var t in this._calls){if(this._calls.hasOwnProperty(t)){this._calls[t].hangup()}}}},{key:"onSignalingConnectionFailed",value:function e(t){}},{key:"onMediaConnectionFailed",value:function e(){}},{key:"recalculateNumCalls",value:function e(){this._numCalls=0;for(var t in this._calls){if(this._calls.hasOwnProperty(t)){this._numCalls++}}}},{key:"transferCall",value:function e(t,n){var r=[t,n];for(var i=0;i<r.length;i++){var o=this._calls[r[i].id()];if(o){if(o.stateValue!=s.CallState.CONNECTED){this.log.error("trying to transfer call "+o.id()+" in state "+o.state());return}}else{this.log.error("trying to transfer unknown call "+o.id());return}}this.voxSignaling.callRemoteFunction(C.RemoteFunction.transferCall,t.id(),n.id())}},{key:"removeCall",value:function e(t){delete this._calls[t]}},{key:"setProtocolVersion",value:function e(t){this.protocolVersion=t}},{key:"_traceName",value:function e(){return"CallManager"}},{key:"numCalls",get:function e(){return this._numCalls}},{key:"calls",get:function e(){return this._calls}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst}},{key:"addCustomDataToHeaders",value:function e(t){if(typeof t.customData!="undefined"){if(typeof t.extraHeaders=="undefined")t.extraHeaders={};t.extraHeaders["VI-CallData"]=t.customData}return t}},{key:"cleanHeaders",value:function e(t){var n={};for(var r in t){if(r.substring(0,2)=="X-"||r==f.Constants.CALL_DATA_HEADER){n[r]=t[r]}}return n}}]);return e}();a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"call",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleIncomingConnection",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"findCall",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleRingOut",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleConnectionConnected",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleConnectionDisconnected",null);a([g.LogManager.d_trace(g.LogCategory.CALLEXSERVER)],M.prototype,"handleSIPInfo",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"stopRinging",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleSipEvent",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleTransferStarted",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleTransferComplete",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleTransferFailed",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleReinvite",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleRejectReinvite",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleInReinvite",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"handleConnectionFailed",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"onSignalingConnected",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"onSignalingClosed",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"onSignalingConnectionFailed",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M.prototype,"removeCall",null);a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],M,"addCustomDataToHeaders",null);t.CallManager=M},function(e,t,n){"use strict";var r=true;var i=true;var o={disableLog:function(e){if(typeof e!=="boolean"){return new Error("Argument type: "+typeof e+". Please use a boolean.")}r=e;return e?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(e){if(typeof e!=="boolean"){return new Error("Argument type: "+typeof e+". Please use a boolean.")}i=!e;return"adapter.js deprecation warnings "+(e?"disabled":"enabled")},log:function(){if(typeof window==="object"){if(r){return}if(typeof console!=="undefined"&&typeof console.log==="function"){console.log.apply(console,arguments)}}},deprecated:function(e,t){if(!i){return}console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(e){var t=e&&e.navigator;var n={};n.browser=null;n.version=null;if(typeof e==="undefined"||!e.navigator){n.browser="Not a browser.";return n}if(t.mozGetUserMedia){n.browser="firefox";n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1)}else if(t.webkitGetUserMedia){if(e.webkitRTCPeerConnection){n.browser="chrome";n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2)}else{if(t.userAgent.match(/Version\/(\d+).(\d+)/)){n.browser="safari";n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else{n.browser="Unsupported webkit-based browser "+"with GUM support but no WebRTC support.";return n}}}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/)){n.browser="edge";n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2)}else if(t.mediaDevices&&t.userAgent.match(/AppleWebKit\/(\d+)\./)){n.browser="safari";n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else{n.browser="Not a supported browser.";return n}return n}};e.exports={log:o.log,deprecated:o.deprecated,disableLog:o.disableLog,disableWarnings:o.disableWarnings,extractVersion:o.extractVersion,shimCreateObjectURL:o.shimCreateObjectURL,detectBrowser:o.detectBrowser.bind(o)}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(19);var c=n(1);var l=n(4);var u=n(0);var d=n(6);var f=n(14);var g=n(5);var p=n(2);var v=n(12);var h=n(3);var y=n(13);var m=n(24);var C=function(){function e(){var t=this;o(this,e);this.iceConfig=null;this._peerConnections={};this.waitingPeerConnections={};this.log=u.LogManager.get().createLogger(u.LogCategory.RTC,"PCFactory");this._requireMedia=true;c.VoxSignaling.get().setRPCHandler(v.RemoteEvent.createPC,function(e,n){t.rpcHandlerCreatePC(e,n)});c.VoxSignaling.get().setRPCHandler(v.RemoteEvent.destroyPC,function(e){t.rpcHandlerDestroyPC(e)});c.VoxSignaling.get().addHandler(this)}r(e,[{key:"rpcHandlerCreatePC",value:function t(n,r){r=m.SDPMuggle.addSetupAttribute(r);if(l.UserMediaManager.get().currentStream||!this._requireMedia){c.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.muteLocal,n,false);return this.createPC(n,r,s.PeerConnectionMode.CLIENT_SERVER_V1,e.sdpOffersVideo(r))}else{this.waitingPeerConnections[n]=r}}},{key:"rpcHandlerDestroyPC",value:function e(t){if(this._peerConnections[t]){this._peerConnections[t].close();delete this._peerConnections[t]}delete this.waitingPeerConnections[t]}},{key:"createPC",value:function e(t,n,r,i){var o=this;var a=g.default.peerConnectionFactory(t,r,i);l.UserMediaManager.get().attachTo(a);this._peerConnections[t]=a;var s=d.CallManager.get().calls[t];if(n){a.processRemoteOffer(n).then(function(e){if(typeof s==="undefined"||s.checkCallMode(f.CallMode.SERVER))c.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.confirmPC,t,e);else c.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,[t,d.CallManager.cleanHeaders(s.headers()),e]);if(t!=="__default"&&typeof d.CallManager.get().calls[t]!=="undefined"){d.CallManager.get().calls[t].peerConnection=a}}).catch(function(e){o.log.error("Error during PC creation: "+e)})}return a}},{key:"setupDirectPC",value:function e(t,n,r,i){var o=this;var a=g.default.peerConnectionFactory(t,n,r);a.setHoldKey(i);var s=h.Client.getInstance().config();if(s.experiments&&s.experiments.hardware){var c=y.default.StreamManager.get();var u=d.CallManager.get().calls[t];return c.getCallStream(u).then(function(e){a.bindLocalMedia(e);o._peerConnections[t]=a;return a.getLocalOffer()})}else{if(!r.sendVideo){l.UserMediaManager.get().attachToSound(a);this._peerConnections[t]=a;return a.getLocalOffer()}else{var f=l.UserMediaManager.get().getConstrainWithSendFlag(true,r.sendVideo);a.setVideoEnabled(r);return l.UserMediaManager.get().getQueryMediaSilent(f).then(function(e){a.bindLocalMedia(e);o._peerConnections[t]=a;return a.getLocalOffer()})}}}},{key:"incomeDirectPC",value:function e(t,n,r,i){var o=this;var a=g.default.peerConnectionFactory(t,s.PeerConnectionMode.P2P,n);a.setHoldKey(i);return a._setRemoteDescription(r).then(function(){o._peerConnections[t]=a;return a})}},{key:"getPeerConnect",value:function e(t){return this._peerConnections[t]}},{key:"onMediaAccessRejected",value:function e(){}},{key:"onMediaAccessGranted",value:function t(n){for(var r in this.waitingPeerConnections){this.createPC(r,this.waitingPeerConnections[r],s.PeerConnectionMode.CLIENT_SERVER_V1,e.sdpOffersVideo(this.waitingPeerConnections[r]))}this.waitingPeerConnections={}}},{key:"onSignalingConnected",value:function e(){}},{key:"onSignalingClosed",value:function e(){this.log.info("Closing all peer connections because signaling connection has closed");this.waitingPeerConnections={};for(var t in this._peerConnections){this._peerConnections[t].close()}this._peerConnections={}}},{key:"onSignalingConnectionFailed",value:function e(t){}},{key:"onMediaConnectionFailed",value:function e(){}},{key:"closeAll",value:function e(){for(var t in this._peerConnections){this._peerConnections[t].close()}this._peerConnections={}}},{key:"setBandwidthParams",value:function e(t){this._bandwidthParams=t}},{key:"addBandwidthParams",value:function e(t){if(this._bandwidthParams)t.sdp=t.sdp.replace(/(a=mid:video.*\r\n)/g,"$1b=AS:"+this._bandwidthParams+"\r\n");return t}},{key:"_traceName",value:function e(){return"PCFactory"}},{key:"requireMedia",get:function e(){return this._requireMedia},set:function e(t){this._requireMedia=t}},{key:"peerConnections",get:function e(){return this._peerConnections}}],[{key:"get",value:function t(){if(this.inst===null){this.inst=new e}return this.inst}},{key:"sdpOffersVideo",value:function e(t){return{receiveVideo:t.indexOf("m=video")!==-1,sendVideo:true}}}]);return e}();C.inst=null;a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"rpcHandlerCreatePC",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"rpcHandlerDestroyPC",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"createPC",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"setupDirectPC",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"incomeDirectPC",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"getPeerConnect",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onMediaAccessRejected",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onMediaAccessGranted",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onSignalingConnected",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onSignalingClosed",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onSignalingConnectionFailed",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"onMediaConnectionFailed",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"closeAll",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"setBandwidthParams",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C.prototype,"addBandwidthParams",null);a([u.LogManager.d_trace(u.LogCategory.PCFACTORY)],C,"sdpOffersVideo",null);t.PCFactory=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["Connected"]="Connected"]="Connected";e[e["Disconnected"]="Disconnected"]="Disconnected";e[e["Failed"]="Failed"]="Failed";e[e["ProgressToneStart"]="ProgressToneStart"]="ProgressToneStart";e[e["ProgressToneStop"]="ProgressToneStop"]="ProgressToneStop";e[e["MessageReceived"]="onSendMessage"]="MessageReceived";e[e["InfoReceived"]="InfoReceived"]="InfoReceived";e[e["TransferComplete"]="TransferComplete"]="TransferComplete";e[e["TransferFailed"]="TransferFailed"]="TransferFailed";e[e["ICETimeout"]="ICETimeout"]="ICETimeout";e[e["RTCStatsReceived"]="RTCStatsReceived"]="RTCStatsReceived";e[e["MediaElementCreated"]="MediaElementCreated"]="MediaElementCreated";e[e["MediaElementRemoved"]="MediaElementRemoved"]="MediaElementRemoved";e[e["ICECompleted"]="ICECompleted"]="ICECompleted";e[e["Updated"]="Updated"]="Updated";e[e["PendingUpdate"]="PendingUpdate"]="PendingUpdate";e[e["UpdateFailed"]="UpdateFailed"]="UpdateFailed";e[e["LocalVideoStreamAdded"]="LocalVideoStreamAdded"]="LocalVideoStreamAdded";e[e["EndPointCreated"]="EndPointCreated"]="EndPointCreated";e[e["EndPointRemoved"]="EndPointRemoved"]="EndPointRemoved"})(r=t.CallEvents||(t.CallEvents={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(1);var c=n(0);var l=n(8);var u=n(2);var d=n(12);var f=n(16);var g;(function(e){e[e["IDLE"]=0]="IDLE";e[e["IN_PROGRESS"]=1]="IN_PROGRESS"})(g=t.AuthenticatorState||(t.AuthenticatorState={}));var p=function(){function e(){var t=this;o(this,e);this.FAIL_CODE_SECOND_STAGE=301;this.FAIL_CODE_ONE_TIME_KEY=302;this._displayName=null;this._username=null;this._authorized=false;this.signaling=s.VoxSignaling.get();this.currentState=g.IDLE;this.log=c.LogManager.get().createLogger(c.LogCategory.SIGNALING,"Authenticator");this.signaling.setRPCHandler(d.RemoteEvent.loginFailed,function(e,n){t.onLoginFailed(e,n)});this.signaling.setRPCHandler(d.RemoteEvent.loginSuccessful,function(e,n){t.onLoginSuccesful(e,n)});this.signaling.setRPCHandler(d.RemoteEvent.refreshOauthTokenFailed,function(e){t.handler.onRefreshTokenFailed(e)});this.signaling.setRPCHandler(d.RemoteEvent.refreshOauthTokenSuccessful,function(e){t.handler.onRefreshTokenSuccess(e.OAuth)});this.signaling.addHandler(this)}r(e,[{key:"setHandler",value:function e(t){this.handler=t}},{key:"onLoginFailed",value:function e(t,n){this.currentState=g.IDLE;switch(t){case this.FAIL_CODE_ONE_TIME_KEY:this.handler.onOneTimeKeyGenerated(n);break;case this.FAIL_CODE_SECOND_STAGE:this.handler.onSecondStageInitiated();break;default:this.handler.onLoginFailed(t);break}}},{key:"onLoginSuccesful",value:function e(t,n){this.currentState=g.IDLE;this._authorized=true;if(n)l.PCFactory.get().iceConfig=n.iceConfig;this._displayName=t;f.CallstatsIo.get().init({userName:this._username,aliasName:this._displayName});this.handler.onLoginSuccessful(t,n.OAuth)}},{key:"basicLogin",value:function e(t,n,r){if(this.currentState!=g.IDLE){this.log.error("Login operation already in progress");return}this._username=t;this.currentState=g.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.login,t,n,r)}},{key:"tokenLogin",value:function e(t,n){if(this.currentState!=g.IDLE){this.log.error("Login operation already in progress");return}this._username=t;this.currentState=g.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.login,t,"",n)}},{key:"tokenRefresh",value:function e(t,n,r){if(r)this.signaling.callRemoteFunction(u.RemoteFunction.refreshOauthToken,t,{refreshToken:n,deviceToken:r});else this.signaling.callRemoteFunction(u.RemoteFunction.refreshOauthToken,t,n)}},{key:"loginUsingOneTimeKey",value:function e(t,n,r){if(this.currentState!=g.IDLE){this.log.error("Login operation already in progress");return}this._username=t;this.currentState=g.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.loginUsingOneTimeKey,t,n,r)}},{key:"loginStage2",value:function e(t,n,r){if(this.currentState!=g.IDLE){this.log.error("Login operation already in progress");return}this._username=t;this.currentState=g.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.loginStage2,t,n,r)}},{key:"generateOneTimeKey",value:function e(t){if(this.currentState!=g.IDLE){this.log.error("Login operation already in progress");return}this.currentState=g.IN_PROGRESS;this.signaling.callRemoteFunction(u.RemoteFunction.loginGenerateOneTimeKey,t)}},{key:"username",value:function e(){return this._username}},{key:"authorized",value:function e(){return this._authorized}},{key:"onSignalingConnected",value:function e(){}},{key:"onSignalingConnectionFailed",value:function e(t){}},{key:"onSignalingClosed",value:function e(){this._authorized=false;this._displayName=null;this._username=null}},{key:"onMediaConnectionFailed",value:function e(){}},{key:"ziAuthorized",value:function e(t){this._authorized=t}},{key:"_traceName",value:function e(){return"Authenticator"}},{key:"displayName",get:function e(){return this._displayName}}],[{key:"get",value:function t(){if(typeof this.inst=="undefined"){this.inst=new e}return this.inst}}]);return e}();a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"setHandler",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"onLoginFailed",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"onLoginSuccesful",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"basicLogin",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"tokenLogin",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"tokenRefresh",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"loginUsingOneTimeKey",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"loginStage2",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"generateOneTimeKey",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"username",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"authorized",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"onSignalingConnected",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"onSignalingConnectionFailed",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"onSignalingClosed",null);a([c.LogManager.d_trace(c.LogCategory.AUTHENTICATOR)],p.prototype,"onMediaConnectionFailed",null);t.Authenticator=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var i=function e(){r(this,e)};i.DIRECT_CALL_HEADER="X-DirectCall";i.VIAMEDIA_CALL_HEADER="X-ViaMedia";i.CALLSTATSIOID_HEADER="X-CallstatsIOID";i.CALL_DATA_HEADER="VI-CallData";i.ZINGAYA_IM_MIME_TYPE="application/zingaya-im";i.P2P_SPD_FRAG_MIME_TYPE="voximplant/sdpfrag";i.VI_HOLD_EMUL="vi/holdemul";i.VI_SPD_OFFER_MIME_TYPE="vi/sdpoffer";i.VI_SPD_ANSWER_MIME_TYPE="vi/sdpanswer";i.VI_CONF_PARTICIPANT_INFO_ADDED="vi/conf-info-added";i.VI_CONF_PARTICIPANT_INFO_REMOVED="vi/conf-info-removed";i.VI_CONF_PARTICIPANT_INFO_UPDATED="vi/conf-info-updated";t.Constants=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["loginFailed"]="loginFailed"]="loginFailed";e[e["loginSuccessful"]="loginSuccessful"]="loginSuccessful";e[e["handleError"]="handleError"]="handleError";e[e["onPCStats"]="__onPCStats"]="onPCStats";e[e["handleIncomingConnection"]="handleIncomingConnection"]="handleIncomingConnection";e[e["handleConnectionConnected"]="handleConnectionConnected"]="handleConnectionConnected";e[e["handleConnectionDisconnected"]="handleConnectionDisconnected"]="handleConnectionDisconnected";e[e["handleRingOut"]="handleRingOut"]="handleRingOut";e[e["startEarlyMedia"]="startEarlyMedia"]="startEarlyMedia";e[e["stopRinging"]="stopRinging"]="stopRinging";e[e["handleConnectionFailed"]="handleConnectionFailed"]="handleConnectionFailed";e[e["handleSIPInfo"]="handleSIPInfo"]="handleSIPInfo";e[e["handleSipEvent"]="handleSipEvent"]="handleSipEvent";e[e["handleTransferStarted"]="handleTransferStarted"]="handleTransferStarted";e[e["handleTransferComplete"]="handleTransferComplete"]="handleTransferComplete";e[e["handleTransferFailed"]="handleTransferFailed"]="handleTransferFailed";e[e["handleReInvite"]="handleReInvite"]="handleReInvite";e[e["handleAcceptReinvite"]="handleAcceptReinvite"]="handleAcceptReinvite";e[e["handleRejectReinvite"]="handleRejectReinvite"]="handleRejectReinvite";e[e["createPC"]="__createPC"]="createPC";e[e["destroyPC"]="__destroyPC"]="destroyPC";e[e["connectionSuccessful"]="__connectionSuccessful"]="connectionSuccessful";e[e["connectionFailed"]="__connectionFailed"]="connectionFailed";e[e["createConnection"]="__createConnection"]="createConnection";e[e["pong"]="__pong"]="pong";e[e["increaseGain"]="increaseGain"]="increaseGain";e[e["handlePreFlightCheckResult"]="handlePreFlightCheckResult"]="handlePreFlightCheckResult";e[e["handleVoicemail"]="handleVoicemail"]="handleVoicemail";e[e["onCallRemoteFunctionError"]="onCallRemoteFunctionError"]="onCallRemoteFunctionError";e[e["refreshOauthTokenFailed"]="refreshOauthTokenFailed"]="refreshOauthTokenFailed";e[e["refreshOauthTokenSuccessful"]="refreshOauthTokenSuccessful"]="refreshOauthTokenSuccessful"})(r=t.RemoteEvent||(t.RemoteEvent={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var l=n(0);var u=n(15);var d;(function(e){var t=void 0;(function(e){e[e["MirrorUpdated"]="MirrorUpdated"]="MirrorUpdated"})(t=e.StreamEvents||(e.StreamEvents={}));var n=void 0;(function(e){e[e["VIDEO_QUALITY_HIGH"]="video_quality_high"]="VIDEO_QUALITY_HIGH";e[e["VIDEO_QUALITY_LOW"]="video_quality_low"]="VIDEO_QUALITY_LOW";e[e["VIDEO_QUALITY_MEDIUM"]="video_quality_medium"]="VIDEO_QUALITY_MEDIUM";e[e["VIDEO_QUALITY_QQVGA"]="video_quality_qqvga"]="VIDEO_QUALITY_QQVGA";e[e["VIDEO_QUALITY_QCIF"]="video_quality_qcif"]="VIDEO_QUALITY_QCIF";e[e["VIDEO_QUALITY_QVGA"]="video_quality_qvga"]="VIDEO_QUALITY_QVGA";e[e["VIDEO_QUALITY_CIF"]="video_quality_cif"]="VIDEO_QUALITY_CIF";e[e["VIDEO_QUALITY_nHD"]="video_quality_nhd"]="VIDEO_QUALITY_nHD";e[e["VIDEO_QUALITY_VGA"]="video_quality_vga"]="VIDEO_QUALITY_VGA";e[e["VIDEO_QUALITY_SVGA"]="video_quality_svga"]="VIDEO_QUALITY_SVGA";e[e["VIDEO_QUALITY_HD"]="video_quality_hd"]="VIDEO_QUALITY_HD";e[e["VIDEO_QUALITY_UXGA"]="video_quality_uxga"]="VIDEO_QUALITY_UXGA";e[e["VIDEO_QUALITY_FHD"]="video_quality_fhd"]="VIDEO_QUALITY_FHD";e[e["VIDEO_QUALITY_UHD"]="video_quality_uhd"]="VIDEO_QUALITY_UHD"})(n=e.VideoQuality||(e.VideoQuality={}));var i=function(e){s(n,e);function n(){o(this,n);var e=a(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));if(typeof n.instance!=="undefined")throw new Error("Error - use StreamManager.get()");e._callStreams={};return e}r(n,[{key:"onMirrorEnded",value:function e(){var n=this;this.remMirrorStream();this.getMirrorStream().then(function(e){n.dispatchEvent({name:t.MirrorUpdated,stream:e})})}},{key:"getMirrorStream",value:function e(){var t=this;return new Promise(function(e,n){if(typeof t._mirrorStream!=="undefined")e(t._mirrorStream);else{return navigator.mediaDevices.getUserMedia({video:f.get().getCallConstraints("__local__")}).then(function(n){t._mirrorStream=n;t._mirrorStream.getTracks().forEach(function(e){e.onended=t.onMirrorEnded;e.onmute=t.onMirrorEnded});e(n)},n)}})}},{key:"remMirrorStream",value:function e(){if(typeof this._mirrorStream==="undefined")return;this._mirrorStream.getTracks().forEach(function(e){e.onended=undefined;e.onmute=undefined;e.stop()});this._mirrorStream=undefined}},{key:"onEchoEnded",value:function e(){var n=this;this.getEchoStream();this.getEchoStream().then(function(e){n.dispatchEvent({name:t.MirrorUpdated,stream:e})})}},{key:"getEchoStream",value:function e(){var t=this;return new Promise(function(e,n){if(typeof t._echoStream!=="undefined")e(t._echoStream);else{return navigator.mediaDevices.getUserMedia({audio:d.get().getCallConstraints("__local__")}).then(function(n){t._echoStream=n;t._echoStream.getTracks().forEach(function(e){e.onended=t.onEchoEnded;e.onmute=t.onEchoEnded});e(n)},n)}})}},{key:"remEchoStream",value:function e(){if(typeof this._echoStream==="undefined")return;this._echoStream.getTracks().forEach(function(e){e.onended=undefined;e.onmute=undefined;e.stop()});this._echoStream=undefined}},{key:"getCallStream",value:function e(t){var n=this;return new Promise(function(e,r){if(n._callStreams[t.id()])return n._callStreams[t.id()];else return navigator.mediaDevices.getUserMedia(n._composeConstraints(t)).then(function(r){n._callStreams[t.id()]=r;r.getTracks().forEach(function(e){e.onended=n.omCallEnded;e.onmute=n.omCallEnded});e(r)},r)})}},{key:"omCallEnded",value:function e(){}},{key:"_updateCallStream",value:function e(t){this.remCallStream(t);return this.getCallStream(t)}},{key:"remCallStream",value:function e(t){if(this._callStreams[t.id()]){this._callStreams[t.id()].getTracks().forEach(function(e){e.onended=undefined;e.onmute=undefined;e.stop()});this._callStreams[t.id()]=undefined}}},{key:"clear",value:function e(){this._mirrorStream.getTracks().forEach(function(e){e.onended=undefined;e.onmute=undefined;e.stop()});this._mirrorStream=undefined;for(var t in this._callStreams){if(this._callStreams.hasOwnProperty(t)){var n=this._callStreams[t];n.getTracks().forEach(function(e){e.onended=undefined;e.onmute=undefined;e.stop()})}}this._callStreams={}}},{key:"_composeConstraints",value:function e(t){var n={};if(t.settings.videoDirections.sendVideo){n.video=f.get().getCallConstraints(t.id())}else{n.video=false}if(t.settings.audioDirections.sendAudio){n.audio=d.get().getCallConstraints(t.id())}else{n.audio=false}return n}},{key:"_traceName",value:function e(){return"StreamManager"}}],[{key:"get",value:function e(){if(typeof n.instance==="undefined")n.instance=new n;return n.instance}}]);return n}(u.EventDispatcher);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"onMirrorEnded",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"getMirrorStream",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"remMirrorStream",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"onEchoEnded",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"getEchoStream",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"remEchoStream",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"getCallStream",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"omCallEnded",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"_updateCallStream",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"remCallStream",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"clear",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],i.prototype,"_composeConstraints",null);e.StreamManager=i;var d=function(){function e(){o(this,e);if(typeof e.instance!=="undefined")throw new Error("Error - use StreamManager.get()");this._supportedConstraints=navigator.mediaDevices.getSupportedConstraints();this._defaultParams={};this._lastAudioInputDevices=[];this._lastAudioOutputDevices=[];this._callParams={}}r(e,[{key:"getInputDevices",value:function e(){var t=this;return navigator.mediaDevices.enumerateDevices().then(function(e){t._lastAudioInputDevices=e.map(function(e){if(e.kind==="audio"||e.kind==="audioinput"){return{id:e.deviceId,name:e.label,group:e.groupId}}});return t._lastAudioInputDevices})}},{key:"getCameraDevices",value:function e(){var t=this;return navigator.mediaDevices.enumerateDevices().then(function(e){t._lastAudioOutputDevices=e.map(function(e){if(e.kind==="audiooutput"){return{id:e.deviceId,name:e.label,group:e.groupId}}});return t._lastAudioOutputDevices})}},{key:"setDefaultAudio",value:function e(t){this._defaultParams=t}},{key:"setAudio",value:function e(t,n){this._callParams[t.id()]=n}},{key:"getCallConstraints",value:function e(t){if(this._callParams[t])return this._getAudioConstraints(this._callParams[t]);else{this._callParams[t]=this._defaultParams;return this._getAudioConstraints(this._defaultParams)}}},{key:"_getAudioConstraints",value:function e(t){var n="ideal";if(t.strict)n="exact";var r={};if(t.inputId){if(this._lastAudioInputDevices.some(function(e){return e.id===t.inputId})){r["deviceId"]={};r["deviceId"][n]=t.inputId}else l.LogManager.get().writeMessage(l.LogCategory.USERMEDIA,"Warning:",l.LogLevel.WARNING,"There is no audio input device with id "+t.inputId)}if(t.echoCancellation&&this._supportedConstraints["echoCancellation"]){r["echoCancellation"]=t.echoCancellation}if(t.noiseSuppression&&this._supportedConstraints["noiseSuppression"]){r["noiseSuppression"]=t.echoCancellation}return r}},{key:"_traceName",value:function e(){return"AudioDeviceManager"}}],[{key:"get",value:function t(){if(typeof e.instance==="undefined")e.instance=new e;return e.instance}}]);return e}();c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],d.prototype,"getInputDevices",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],d.prototype,"getCameraDevices",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],d.prototype,"setDefaultAudio",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],d.prototype,"setAudio",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],d.prototype,"getCallConstraints",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],d.prototype,"_getAudioConstraints",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],d,"get",null);e.AudioDeviceManager=d;var f=function(){function e(){o(this,e);if(typeof e.instance!=="undefined")throw new Error("Error - use StreamManager.get()");this._supportedConstraints=navigator.mediaDevices.getSupportedConstraints();this._callParams={};this._lastCameraDevices=[];this._defaultParams={}}r(e,[{key:"setDefaultCamera",value:function e(t){var n=this._validateCameraParams(t);this._defaultParams=n}},{key:"setCamera",value:function e(t,n){var r=this._validateCameraParams(n);this._callParams[t.id()]=r}},{key:"getCallConstraints",value:function e(t){if(this._callParams[t])return this._getVideoConstraints(this._callParams[t]);else{this._callParams[t]=this._defaultParams;return this._getVideoConstraints(this._defaultParams)}}},{key:"getOutputDevices",value:function e(){var t=this;return navigator.mediaDevices.enumerateDevices().then(function(e){t._lastCameraDevices=e.map(function(e){if(e.kind==="video"||e.kind==="videoinput"){return{id:e.deviceId,name:e.label,group:e.groupId}}});return t._lastCameraDevices})}},{key:"_getVideoConstraints",value:function e(t){var n="ideal";var r={};if(t.cameraId){if(this._lastCameraDevices.some(function(e){return e.id===t.cameraId})){r["deviceId"]={};r["deviceId"][n]=t.cameraId}else l.LogManager.get().writeMessage(l.LogCategory.USERMEDIA,"Warning:",l.LogLevel.WARNING,"There is no video device with id "+t.cameraId)}else if(typeof t.facingMode!=="undefined"){if(t.facingMode===false){r["facingMode"]="environment"}else{r["facingMode"]="user"}}if(t.frameHeight){r["height"]={};if(t.strict){r["height"]["min"]=t.frameHeight;r["height"]["max"]=t.frameHeight}else r["height"][n]=t.frameHeight}if(t.frameWidth){r["width"]={};if(t.strict){r["width"]["min"]=t.frameWidth;r["width"]["max"]=t.frameWidth}else r["width"][n]=t.frameWidth}if(t.frameRate&&t.frameRate>0&&this._supportedConstraints["frameRate"]){r["frameRate"]=t.frameRate+""}return r}},{key:"_validateCameraParams",value:function e(t){if(t.videoQuality){if(t.frameHeight||t.frameWidth)l.LogManager.get().writeMessage(l.LogCategory.USERMEDIA,"Warning:",l.LogLevel.WARNING,'"videoQuality" parameter detected. The "frameHeight" '+'and the "frameWidth" params will be ignored');switch(t.videoQuality){case n.VIDEO_QUALITY_HIGH:t.frameWidth=1280;t.frameHeight=720;break;case n.VIDEO_QUALITY_MEDIUM:t.frameWidth=640;t.frameHeight=480;break;case n.VIDEO_QUALITY_LOW:t.frameWidth=320;t.frameHeight=240;break;case n.VIDEO_QUALITY_QQVGA:t.frameWidth=160;t.frameHeight=120;break;case n.VIDEO_QUALITY_QCIF:t.frameWidth=176;t.frameHeight=144;break;case n.VIDEO_QUALITY_QVGA:t.frameWidth=320;t.frameHeight=240;break;case n.VIDEO_QUALITY_CIF:t.frameWidth=352;t.frameHeight=288;break;case n.VIDEO_QUALITY_nHD:t.frameWidth=640;t.frameHeight=360;break;case n.VIDEO_QUALITY_VGA:t.frameWidth=640;t.frameHeight=480;break;case n.VIDEO_QUALITY_SVGA:t.frameWidth=800;t.frameHeight=600;break;case n.VIDEO_QUALITY_HD:t.frameWidth=1280;t.frameHeight=720;break;case n.VIDEO_QUALITY_UXGA:t.frameWidth=1600;t.frameHeight=1200;break;case n.VIDEO_QUALITY_FHD:t.frameWidth=1920;t.frameHeight=1080;break;case n.VIDEO_QUALITY_UHD:t.frameWidth=3840;t.frameHeight=2160;break;default:t.frameWidth=320;t.frameHeight=240;break}}return t}},{key:"_traceName",value:function e(){return"CameraManager"}}],[{key:"get",value:function t(){if(typeof e.instance==="undefined")e.instance=new e;return e.instance}},{key:"legacyParamConverter",value:function e(t){var r={videoQuality:n.VIDEO_QUALITY_MEDIUM};if(t.width){if(typeof t.width==="string"||typeof t.width==="number"){delete r.videoQuality;r.frameWidth=t.width}else if(typeof t.width.exact==="string"||typeof t.width.exact==="number"){delete r.videoQuality;r.frameWidth=t.width.exact;r.strict=true}else if(typeof t.width.min==="string"||typeof t.width.min==="number"){delete r.videoQuality;r.frameWidth=t.width.min}else if(typeof t.width.max==="string"||typeof t.width.max==="number"){delete r.videoQuality;r.frameWidth=t.width.max}else if(typeof t.width.ideal==="string"||typeof t.width.ideal==="number"){delete r.videoQuality;r.frameWidth=t.width.ideal}}if(t.height){if(typeof t.height==="string"||typeof t.height==="number"){delete r.videoQuality;r.frameHeight=t.height}else if(typeof t.height.exact==="string"||typeof t.height.exact==="number"){delete r.videoQuality;r.frameHeight=t.height.exact;r.strict=true}else if(typeof t.height.min==="string"||typeof t.height.min==="number"){delete r.videoQuality;r.frameHeight=t.height.min}else if(typeof t.height.max==="string"||typeof t.height.max==="number"){delete r.videoQuality;r.frameHeight=t.height.max}else if(typeof t.height.ideal==="string"||typeof t.height.ideal==="number"){delete r.videoQuality;r.frameHeight=t.height.ideal}}return r}}]);return e}();c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],f.prototype,"setDefaultCamera",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],f.prototype,"setCamera",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],f.prototype,"getCallConstraints",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],f.prototype,"getOutputDevices",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],f.prototype,"_getVideoConstraints",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],f.prototype,"_validateCameraParams",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],f,"get",null);c([l.LogManager.d_trace(l.LogCategory.HARDWARE)],f,"legacyParamConverter",null);e.CameraManager=f})(d=t.Hardware||(t.Hardware={}));t.default=d},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":o(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a}return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var u=n(9);var d=n(1);var f=n(11);var g=n(0);var p=n(4);var v=n(8);var h=n(6);var y=n(5);var m=n(2);var C=n(34);var _=n(3);var S=n(15);var L;(function(e){e[e["ALERTING"]="ALERTING"]="ALERTING";e[e["PROGRESSING"]="PROGRESSING"]="PROGRESSING";e[e["CONNECTED"]="CONNECTED"]="CONNECTED";e[e["UPDATING"]="UPDATING"]="UPDATING";e[e["ENDED"]="ENDED"]="ENDED"})(L=t.CallState||(t.CallState={}));var E;(function(e){e[e["P2P"]=0]="P2P";e[e["SERVER"]=1]="SERVER"})(E=t.CallMode||(t.CallMode={}));var M=function(e){c(t,e);function t(e,n,r,i){a(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));o.remoteMuteState=true;o.signalingConnected=false;o.settings=i;o.settings.id=e;o.settings.displayName=n;o.settings.mode=E.P2P;o.settings.active=true;o.settings.usedSinkId=null;o.settings.incoming=r;o.settings.state=r?L.ALERTING:L.PROGRESSING;var c=_.Client.getInstance().config();if(c.experiments&&c.experiments.hardware){o.settings.audioDirections={sendAudio:true}}else{o.settings.audioDirections={sendAudio:false}}o.settings.videoDirections=typeof i.video==="boolean"?{sendVideo:i.video,receiveVideo:true}:i.video;o.settings.hasEarlyMedia=false;o.log=g.LogManager.get().createLogger(g.LogCategory.CALL,"Call "+e);o._callManager=h.CallManager.get();o.on(u.CallEvents.Connected,function(){o.startTime=Date.now()});return o}r(t,[{key:"id",value:function e(){return this.settings.id}},{key:"number",value:function e(){return this.settings.number}},{key:"displayName",value:function e(){return this.settings.displayName}},{key:"headers",value:function e(){return this.settings.extraHeaders}},{key:"active",value:function e(){return this.settings.active}},{key:"state",value:function e(){return L[this.settings.state]}},{key:"answer",value:function e(t,n,r){if(typeof t!="undefined"){if(typeof n=="undefined"||(typeof n==="undefined"?"undefined":o(n))!=="object")n={};n[f.Constants.CALL_DATA_HEADER]=t}if(typeof r!=="undefined")r={sendVideo:_.Client.getInstance().config().videoSupport,receiveVideo:_.Client.getInstance().config().videoSupport};if(this.settings.state!=L.ALERTING)throw new Error("WRONG_CALL_STATE");if(typeof r!="undefined"){this._peerConnection.setVideoFlags(r)}}},{key:"decline",value:function e(t){if(this.settings.state!=L.ALERTING)throw new Error("WRONG_CALL_STATE");d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.rejectCall,this.settings.id,false,h.CallManager.cleanHeaders(t))}},{key:"reject",value:function e(t){if(this.settings.state!=L.ALERTING)throw new Error("WRONG_CALL_STATE");d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.rejectCall,this.settings.id,true,h.CallManager.cleanHeaders(t))}},{key:"hangup",value:function e(t){if(this.settings.state==L.CONNECTED||this.settings.state==L.UPDATING||this.settings.state==L.PROGRESSING)d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.disconnectCall,this.settings.id,h.CallManager.cleanHeaders(t));else if(this.settings.state==L.ALERTING)d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.rejectCall,this.settings.id,true,h.CallManager.cleanHeaders(t));else throw new Error("WRONG_CALL_STATE")}},{key:"sendTone",value:function e(t){if(this.settings.active)this._peerConnection.sendDTMF(t)}},{key:"mutePlayback",value:function e(){this.remoteMuteState=false;p.UserMediaManager.updateMuteState(this.settings.id,p.MediaDirection.REMOTE,false)}},{key:"unmutePlayback",value:function e(){this.remoteMuteState=true;p.UserMediaManager.updateMuteState(this.settings.id,p.MediaDirection.REMOTE,true)}},{key:"restoreRMute",value:function e(){if(this.settings.active)p.UserMediaManager.updateMuteState(this.settings.id,p.MediaDirection.REMOTE,this.remoteMuteState)}},{key:"muteMicrophone",value:function e(){this.peerConnection.muteMicrophone(true)}},{key:"unmuteMicrophone",value:function e(){this.peerConnection.muteMicrophone(false)}},{key:"showRemoteVideo",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(typeof t=="undefined")t=true;if(this.peerConnection.videoRenderer)this.peerConnection.videoRenderer.style.display=t?"block":"none"}},{key:"setRemoteVideoPosition",value:function e(t,n){throw new Error("Deprecated: please use CSS to position '#voximplantcontainer' element")}},{key:"setRemoteVideoSize",value:function e(t,n){throw new Error("Deprecated: please use CSS to set size of '#voximplantcontainer' element")}},{key:"sendInfo",value:function e(t,n,r){var i,o,a=t.indexOf("/");if(a==-1){i="application";o=t}else{i=t.substring(0,a);o=t.substring(a+1)}d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.sendSIPInfo,this.settings.id,i,o,n,h.CallManager.cleanHeaders(r))}},{key:"sendMessage",value:function e(t){this.sendInfo(f.Constants.ZINGAYA_IM_MIME_TYPE,t,{})}},{key:"setVideoSettings",value:function e(t,n,r){p.UserMediaManager.get().setConstraints(t,true).then(function(e){if(typeof n=="function")n(e)}).catch(function(e){if(typeof r=="function")r(e)})}},{key:"getVideoElementId",value:function e(){if(this.peerConnection&&this.settings.wiredRemote){var t=this.peerConnection.videoRenderer;return t!=null?t.id:null}else{return null}}},{key:"addEventListener",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,n,r)}},{key:"on",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,n,r)}},{key:"removeEventListener",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeEventListener",this).call(this,n,r)}},{key:"off",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,n,r)}},{key:"dispatchEvent",value:function e(n){if(n.name===u.CallEvents.Updated||n.name===u.CallEvents.UpdateFailed){this.settings.state=L.CONNECTED}i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispatchEvent",this).call(this,n)}},{key:"checkState",value:function e(t,n){if(t){if(typeof t!="string"){var r=false;var i=t;for(var o=0;o<i.length;o++){if(i[o]==this.settings.state){r=true}}if(!r){this.log.warning("Received "+n+" in invalid state "+this.settings.state);return false}}else if(this.settings.state!=t){this.log.warning("Received "+n+" in invalid state "+this.settings.state);return false}}return true}},{key:"onConnected",value:function e(t,n){if(this.signalingConnected){if(!this.checkState([L.PROGRESSING,L.ALERTING],"onConnected"))return false;this.settings.state=L.CONNECTED;this.dispatchEvent({name:"Connected",call:this,headers:t});return true}}},{key:"onDisconnected",value:function e(t,n){if(!this.checkState([L.CONNECTED,L.ALERTING,L.PROGRESSING,L.UPDATING],"onDisconnected"))return false;this.settings.state=L.ENDED;this.dispatchEvent({name:"Disconnected",call:this,headers:t,params:n});C.ReusableRenderer.get().freeRendersByCallId(this.settings.id);return true}},{key:"onFailed",value:function e(t,n,r){this.dispatchEvent({name:"Failed",call:this,headers:r,code:t,reason:n});this.settings.state=L.ENDED;C.ReusableRenderer.get().freeRendersByCallId(this.settings.id);return true}},{key:"onStopRinging",value:function e(){if(!this.checkState([L.PROGRESSING,L.CONNECTED],"onStopRinging"))return false;this.dispatchEvent({name:"ProgressToneStop",call:this});return true}},{key:"onRingOut",value:function e(){if(!this.checkState(L.PROGRESSING,"onRingOut"))return false;this.dispatchEvent({name:"ProgressToneStart",call:this});return true}},{key:"onTransferComplete",value:function e(){if(!this.checkState(L.CONNECTED,"onTransferComplete"))return false;this.dispatchEvent({name:"TransferComplete",call:this});return true}},{key:"onTransferFailed",value:function e(){if(!this.checkState(L.CONNECTED,"onTransferFailed"))return false;this.dispatchEvent({name:"TransferFailed",call:this});return true}},{key:"onInfo",value:function e(t,n,r,i,o){if(t.stateValue==L.CONNECTED||t.stateValue==L.PROGRESSING||t.stateValue==L.ALERTING||t.stateValue==L.UPDATING){var a=n+"/"+r;if(a==f.Constants.ZINGAYA_IM_MIME_TYPE){this.dispatchEvent({name:"onSendMessage",call:this,text:i})}else if(a==f.Constants.P2P_SPD_FRAG_MIME_TYPE){var s=JSON.parse(i);for(var c in s){t.peerConnection.addRemoteCandidate(s[c][1],s[c][0])}}else if(a==f.Constants.VI_SPD_OFFER_MIME_TYPE){t.peerConnection.processRemoteOffer(i)}else if(a==f.Constants.VI_SPD_ANSWER_MIME_TYPE){t.peerConnection.processRemoteAnswer({},i)}else{this.dispatchEvent({name:"InfoReceived",call:this,body:i,headers:o,mimeType:a})}return true}else{this.log.warning("received handleSIPInfo for call: "+t.id()+" in invalid state: "+t.state())}}},{key:"setActive",value:function e(t){var n=this;return new Promise(function(e,r){if(t===n.settings.active){e({name:u.CallEvents["Updated"],result:false,call:n});return}if(y.default.getWSVendor()==="firefox"){n.sendInfo(f.Constants.VI_HOLD_EMUL,JSON.stringify({hold:!t}));e({name:u.CallEvents["Updated"],call:n,result:true});return}if(n.settings.state==L.CONNECTED){n.settings.state=L.UPDATING;n.settings.active=t;if(!t)d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.hold,n.settings.id);else d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.unhold,n.settings.id);e({name:u.CallEvents["Updated"],result:true,call:n})}else{r({name:u.CallEvents.UpdateFailed,code:11,call:n})}})}},{key:"checkCallMode",value:function e(t){return this.settings.mode==t}},{key:"canStartSendingCandidates",value:function e(){if(typeof this._peerConnection=="undefined")this._peerConnection=v.PCFactory.get().peerConnections[this.settings.id];this._peerConnection.canStartSendingCandidates()}},{key:"notifyICETimeout",value:function e(){this.dispatchEvent({name:"ICETimeout",call:this})}},{key:"sendVideo",value:function e(t){var n=this;var r=_.Client.getInstance().config();if(r.experiments&&r.experiments.reinvite){if(!this.peerConnection){return new Promise(function(e,t){e({call:n,name:u.CallEvents[u.CallEvents.Updated],result:true})})}var i=this.settings.videoDirections.sendVideo;this.settings.videoDirections.sendVideo=t;if(this.peerConnection.hasLocalVideo()){if(!t&&!i){return this.sendMedia(null,t)}else{this.peerConnection.enableVideo(t);return new Promise(function(e,t){e({call:n,name:u.CallEvents[u.CallEvents.Updated],result:true})})}}else if(t){return this.sendMedia(null,t)}}else{if(this.settings.videoDirections.sendVideo===t)return new Promise(function(e,t){e()});return this.sendMedia(null,t)}}},{key:"receiveVideo",value:function e(){var t=this;this.settings.state=L.UPDATING;return new Promise(function(e,n){if(t.settings.videoDirections.receiveVideo===true){n();return}t.settings.videoDirections.receiveVideo=true;t._peerConnection.hdnFRS().then(e,n)})}},{key:"sendMedia",value:function e(t,n){var r=this;this.settings.state=L.UPDATING;if(typeof t==="undefined"||t===null)t=this.settings.audioDirections.sendAudio;if(typeof n==="undefined"||n===null)n=this.settings.videoDirections.sendVideo;return this.peerConnection.sendMedia(t,n).then(function(e){if(typeof n!=="undefined"&&n!==null){r.settings.videoDirections.sendVideo=n}if(typeof t!=="undefined"&&t!==null){r.settings.audioDirections.sendAudio=t}return e})}},{key:"sendAudio",value:function e(t){var n=this;var r=_.Client.getInstance().config();if(r.experiments&&r.experiments.reinvite){this.settings.audioDirections.sendAudio=t;if(this.peerConnection.hasLocalAudio()){this.peerConnection.muteMicrophone(!t);return new Promise(function(e,t){e({call:n,name:u.CallEvents[u.CallEvents.Updated],result:true})})}else if(t){return this.sendMedia(null,t)}}else{this.settings.state=L.UPDATING;return this.sendMedia(t,null)}}},{key:"getLocalStream",value:function e(){var t=this;if(this.settings.wiredLocal)return new Promise(function(e,n){if(t.peerConnection)e(t.peerConnection.localStream);else n(new Error("We have no PC for this call yet"))});else return p.UserMediaManager.get().queryMedia()}},{key:"setLocalStream",value:function e(t){return new Promise(function(e,t){t(new Error("Not implemented"))})}},{key:"shareScreen",value:function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.settings.state=L.UPDATING;return this.peerConnection.shareScreen(t)}},{key:"stopSharingScreen",value:function e(){this.settings.state=L.UPDATING;return this.peerConnection.stopSharingScreen()}},{key:"addLocalStream",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.settings.state=L.UPDATING;return this.peerConnection.addMediaStream(t,n)}},{key:"wireRemoteStream",value:function e(){var t=this;return new Promise(function(e,n){if(t.peerConnection){if(typeof t.peerConnection.remoteStreams[0]!="undefined"){t.peerConnection.wireRemoteStream(true).then(function(){t.settings.wiredRemote=true;e()}).catch(n)}else n(new Error("We have no remote MediaStream for this call yet"))}else n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteAudioStreams",value:function e(){var t=this;return new Promise(function(e,n){if(t.peerConnection){t.peerConnection.remoteStreams.forEach(function(t){if(t.getAudioTracks().length){e(new MediaStream(t.getAudioTracks()));return}});n(new Error("We have no remote MediaStream for this call yet"))}else n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteVideoStreams",value:function e(){var t=this;return new Promise(function(e,n){if(t.peerConnection){if(typeof t.peerConnection.remoteStreams[0]!="undefined"&&t.peerConnection.remoteStreams[0].getVideoTracks().length!=0)e(new MediaStream(t.peerConnection.remoteStreams[0].getVideoTracks()));else n(new Error("We have no remote MediaStream for this call yet"))}else n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteWiredState",value:function e(){return this.settings.wiredRemote}},{key:"getLocalWiredState",value:function e(){return this.settings.wiredLocal}},{key:"useAudioOutput",value:function e(t){return this.peerConnection.updateRenderersSink(t)}},{key:"getAudioElementId",value:function e(){if(this._peerConnection.remoteStreams.length=0)return null;if(this._peerConnection.remoteStreams[0].getAudioTracks().length=0)return null;return this._peerConnection.remoteStreams[0].getAudioTracks()[0].id}},{key:"getDirections",value:function e(){if(typeof this.peerConnection!=="undefined")return this.peerConnection.getDirections()}},{key:"getStreamActivity",value:function e(){return{}}},{key:"hdnFRS",value:function e(){this.peerConnection._hdnFRS()}},{key:"hdnFRSPrep",value:function e(){var t=this;if(typeof this.peerConnection!=="undefined")this.peerConnection._hdnFRSPrep();else setTimeout(function(){t.hdnFRSPrep()},1e3)}},{key:"runIncomingReInvite",value:function e(t,n){var r=this;if(this.settings.state===L.UPDATING){d.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.rejectReInvite,this.settings.id,{})}else{this.settings.state=L.UPDATING;var i=h.CallManager.get().isSDPHasVideo(n);this.peerConnection.handleReinvite(t,n,i).then(function(){r.peerConnection.restoreMute()})}}},{key:"setActiveForce",value:function e(t){this.settings.active=t}},{key:"_traceName",value:function e(){return"Call"}},{key:"getCallDuration",value:function e(){return Date.now()-this.startTime}},{key:"stateValue",get:function e(){return this.settings.state}},{key:"promise",get:function e(){return this._promise}},{key:"peerConnection",set:function e(t){this._peerConnection=t},get:function e(){return this._peerConnection}}]);return t}(S.EventDispatcher);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"id",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"number",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"displayName",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"headers",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"active",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"state",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"answer",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"decline",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"reject",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"hangup",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendTone",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"mutePlayback",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"unmutePlayback",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"restoreRMute",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"muteMicrophone",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"unmuteMicrophone",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"showRemoteVideo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setRemoteVideoPosition",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setRemoteVideoSize",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendInfo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendMessage",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setVideoSettings",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getVideoElementId",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"addEventListener",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"on",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"removeEventListener",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"off",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"dispatchEvent",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"checkState",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onConnected",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onDisconnected",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onFailed",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onStopRinging",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onRingOut",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onTransferComplete",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onTransferFailed",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"onInfo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setActive",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"checkCallMode",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"canStartSendingCandidates",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"notifyICETimeout",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendVideo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"receiveVideo",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"sendAudio",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getLocalStream",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"setLocalStream",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"addLocalStream",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"wireRemoteStream",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getRemoteAudioStreams",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getRemoteVideoStreams",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getRemoteWiredState",null);l([g.LogManager.d_trace(g.LogCategory.CALL)],M.prototype,"getLocalWiredState",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"useAudioOutput",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"getAudioElementId",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"getStreamActivity",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"hdnFRS",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"hdnFRSPrep",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"runIncomingReInvite",null);l([g.LogManager.d_trace(g.LogCategory.CLIENT)],M.prototype,"setActiveForce",null);t.Call=M},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=function(){function e(){i(this,e);this.eventListeners={}}r(e,[{key:"addEventListener",value:function e(t,n){if(typeof this.eventListeners[t]=="undefined")this.eventListeners[t]=[];this.eventListeners[t].push(n)}},{key:"dispatchEvent",value:function e(t){var n=t.name;if(typeof this.eventListeners[n]!="undefined"){for(var r=0;r<this.eventListeners[n].length;r++){if(typeof this.eventListeners[n][r]=="function"){this.eventListeners[n][r](t)}}}}},{key:"removeEventListener",value:function e(t,n){if(typeof this.eventListeners[t]=="undefined")return;if(typeof n==="function"){for(var r=0;r<this.eventListeners[t].length;r++){if(this.eventListeners[t][r]==n){this.eventListeners[t].splice(r,1);break}}}else{this.eventListeners[t]=[]}}},{key:"on",value:function e(t,n){this.addEventListener(t,n)}},{key:"off",value:function e(t,n){this.removeEventListener(t,n)}}]);return e}();t.EventDispatcher=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=n(0);var a;(function(e){e[e["multiplex"]="multiplex"]="multiplex";e[e["audio"]="audio"]="audio";e[e["video"]="video"]="video";e[e["screen"]="screen"]="screen";e[e["data"]="data"]="data";e[e["unbundled"]="unbundled"]="unbundled"})(a=t.CallstatsIoFabricUsage||(t.CallstatsIoFabricUsage={}));var s;(function(e){e[e["fabricHold"]="fabricHold"]="fabricHold";e[e["fabricResume"]="fabricResume"]="fabricResume";e[e["audioMute"]="audioMute"]="audioMute";e[e["audioUnmute"]="audioUnmute"]="audioUnmute";e[e["videoPause"]="videoPause"]="videoPause";e[e["videoResume"]="videoResume"]="videoResume";e[e["fabricTerminated"]="fabricTerminated"]="fabricTerminated";e[e["screenShareStart"]="screenShareStart"]="screenShareStart";e[e["screenShareStop"]="screenShareStop"]="screenShareStop";e[e["dominantSpeaker"]="dominantSpeaker"]="dominantSpeaker";e[e["activeDeviceList"]="activeDeviceList"]="activeDeviceList"})(s=t.CallstatsIoFabricEvent||(t.CallstatsIoFabricEvent={}));var c;(function(e){e[e["getUserMedia"]="getUserMedia"]="getUserMedia";e[e["createOffer"]="createOffer"]="createOffer";e[e["createAnswer"]="createAnswer"]="createAnswer";e[e["setLocalDescription"]="setLocalDescription"]="setLocalDescription";e[e["setRemoteDescription"]="setRemoteDescription"]="setRemoteDescription";e[e["addIceCandidate"]="addIceCandidate"]="addIceCandidate";e[e["iceConnectionFailure"]="iceConnectionFailure"]="iceConnectionFailure";e[e["signalingError"]="signalingError"]="signalingError";e[e["applicationLog"]="applicationLog"]="applicationLog"})(c=t.CallstatsioWrtcFuncNames||(t.CallstatsioWrtcFuncNames={}));var l=function(){function e(t){i(this,e);this._params=t;this.inited=false;this.pendingFabric=[];var n=window;if(typeof n.callstats!="undefined")this.callstats=new n.callstats(null,n.io)}r(e,[{key:"init",value:function t(n){var r=this;if(!e.moduleEnabled)return false;o.LogManager.get().writeMessage(o.LogCategory.UTILS,"[CallstatsIo]",o.LogLevel.INFO," Callstats.io SDK initialization start");this.callstats.initialize(this._params.AppID,this._params.AppSecret,n,function(){o.LogManager.get().writeMessage(o.LogCategory.UTILS,"[CallstatsIo]",o.LogLevel.INFO," Callstats.io SDK initialization successful");r.inited=true;r.pendingFabric.map(function(e){r.callstats.addNewFabric(e.pc,e.remoteUser,e.fabricUsage,e.callID)})},function(){},this.packParams());return true}},{key:"packParams",value:function e(){var t={};if(this._params.disableBeforeUnloadHandler)t["disableBeforeUnloadHandler"]=this._params.disableBeforeUnloadHandler;if(this._params.applicationVersion)t["applicationVersion"]=this._params.applicationVersion;return t}},{key:"addNewFabric",value:function t(n,r,i,a){if(!e.moduleEnabled)return false;if(this.inited){o.LogManager.get().writeMessage(o.LogCategory.UTILS,"[CallstatsIo]",o.LogLevel.INFO," Callstats.io addNewFabric");this.callstats.addNewFabric(n,r,i,a)}else{this.pendingFabric.push({pc:n,remoteUser:r,fabricUsage:i,callID:a})}}},{key:"sendFabricEvent",value:function t(n,r,i){if(!e.moduleEnabled)return false;this.callstats.sendFabricEvent(n,r,i)}},{key:"reportError",value:function t(n,r,i,o,a,s){if(!e.moduleEnabled)return false;this.callstats.reportError(n,r,i,o,a,s)}},{key:"_traceName",value:function e(){return"CallstatsIo"}}],[{key:"isModuleEnabled",value:function t(){return e.moduleEnabled}},{key:"get",value:function t(n){var r=window;if(typeof r.callstats!="undefined")e.moduleEnabled=true;if(typeof e.instance=="undefined"){e.instance=new e(n)}if(typeof n!="undefined"){e.instance._params=n}return e.instance}}]);return e}();l.moduleEnabled=false;t.CallstatsIo=l},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=n(1);var a=n(2);var s=function(){function e(t){i(this,e);this._id=t}r(e,[{key:"insertDTMF",value:function e(t,n,r){var i=this;t.split("").forEach(function(e){return i.sendKey(e)})}},{key:"sendKey",value:function e(t){var n=void 0;if(t=="*")n=10;else if(t=="#")n=11;else{n=parseInt(t)}if(n>=0||n<=11)o.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.sendDTMF,this._id,n)}},{key:"_traceName",value:function e(){return"SignalingDTMFSender"}}]);return e}();t.SignalingDTMFSender=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["SDKReady"]="SDKReady"]="SDKReady";e[e["ConnectionEstablished"]="ConnectionEstablished"]="ConnectionEstablished";e[e["ConnectionFailed"]="ConnectionFailed"]="ConnectionFailed";e[e["ConnectionClosed"]="ConnectionClosed"]="ConnectionClosed";e[e["AuthResult"]="AuthResult"]="AuthResult";e[e["RefreshTokenResult"]="RefreshTokenResult"]="RefreshTokenResult";e[e["PlaybackFinished"]="PlaybackFinished"]="PlaybackFinished";e[e["MicAccessResult"]="MicAccessResult"]="MicAccessResult";e[e["IncomingCall"]="IncomingCall"]="IncomingCall";e[e["SourcesInfoUpdated"]="SourcesInfoUpdated"]="SourcesInfoUpdated";e[e["NetStatsReceived"]="NetStatsReceived"]="NetStatsReceived"})(r=t.Events||(t.Events={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(1);var l=n(20);var u=n(6);var d=n(11);var f=n(2);var g=n(23);var p=n(5);var v=n(4);var h=n(3);var y=n(13);var m;(function(e){e[e["IDLE"]=0]="IDLE";e[e["REMOTEOFFER"]=1]="REMOTEOFFER";e[e["LOCALOFFER"]=2]="LOCALOFFER";e[e["ESTABLISHING"]=3]="ESTABLISHING";e[e["ESTABLISHED"]=4]="ESTABLISHED";e[e["CLOSED"]=5]="CLOSED"})(m=t.PeerConnectionState||(t.PeerConnectionState={}));var C;(function(e){e[e["CLIENT_SERVER_V1"]=0]="CLIENT_SERVER_V1";e[e["P2P"]=1]="P2P"})(C=t.PeerConnectionMode||(t.PeerConnectionMode={}));var _=function(){function e(t,n,r){o(this,e);this.id=t;this.mode=n;this.videoEnabled=r;this.SEND_CANDIDATE_DELAY=1e3;this.mediaRepository=[];this.candidateList=[];this.localCandidateTimer=-1;this.onHold=false;this.muteMicState=false;this.log=s.LogManager.get().createLogger(s.LogCategory.RTC,"PeerConnection "+t);this.state=m.IDLE;this.log.info("Created PC");this.renderers=[];this.pendingCandidates=[];if(t!=="_default"&&u.CallManager.get().calls[t])this.reInviteQ=new g.ReInviteQ(u.CallManager.get().calls[t],this._canReInvite)}r(e,[{key:"getId",value:function e(){return this.id}},{key:"setState",value:function e(t){this.log.info("Transmitting from "+m[this.state]+" to "+m[t]);this.state=t}},{key:"getState",value:function e(){return this.state}},{key:"processRemoteAnswer",value:function e(t,n){this.log.info("Called processRemoteAnswer");this.state=m.ESTABLISHING;return this._processRemoteAnswer(t,n)}},{key:"getLocalOffer",value:function e(){if(this.state===m.IDLE||this.state===m.ESTABLISHED||m.LOCALOFFER){this.log.info("Called getLocalOffer");this.state=m.LOCALOFFER;return this._getLocalOffer()}else{this.log.error("Called getLocalOffer in state "+m[this.state]);return new Promise(function(e,t){t("Invalid state")})}}},{key:"getLocalAnswer",value:function e(){return this._getLocalAnswer()}},{key:"processRemoteOffer",value:function e(t){if(this.state===m.IDLE||this.state===m.ESTABLISHED){this.log.info("Called processRemoteOffer");this.state=m.ESTABLISHING;return this._processRemoteOffer(t)}else{this.log.error("Called processRemoteOffer in state "+m[this.state]);return new Promise(function(e,t){t("Invalid state")})}}},{key:"close",value:function e(){this.log.info("Called close");this._stopSharing();this._close();this.renderers.forEach(function(e){return l.Renderer.get().releaseElement(e)});this.mediaRepository.forEach(function(e){e.stop()});this.mediaRepository=[]}},{key:"addRemoteCandidate",value:function e(t,n){this.log.info("Called addRemoteCandidate");return this._addRemoteCandidate(t,n)}},{key:"sendLocalCandidateToPeer",value:function e(t,n){var r=this;this._call=u.CallManager.get().calls[this.id];switch(this.mode){case C.P2P:this.candidateList.push([n,t]);if(this.localCandidateTimer<=0){this.localCandidateTimer=window.setTimeout(function(){window.clearTimeout(r.localCandidateTimer);r.localCandidateTimer=-1;if(u.CallManager.get().calls[r.id])u.CallManager.get().calls[r.id].sendInfo(d.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(r.candidateList),{});r.candidateList=[]},200)}break;case C.CLIENT_SERVER_V1:c.VoxSignaling.get().callRemoteFunction(f.RemoteFunction.addCandidate,this.id,t,n);break}}},{key:"bindLocalMedia",value:function e(t){var n=this;if(typeof this._localStream!=="undefined")this._unbindLocalMegia();if(typeof t!=="undefined"&&t!==null){var r=new MediaStream(t.getTracks().map(function(e){var t=e;if(typeof e.clone!=="undefined")t=e.clone();n.mediaRepository.push(t);return t}));this._localStream=r;if(this._call){if(r.getAudioTracks().length>0)this._call.settings.audioDirections.sendAudio=true}this._bindLocalMedia()}}},{key:"handleReinvite",value:function e(t,n,r){return this._handleReinvite(t,n,r)}},{key:"addCandidateToSend",value:function e(t,n){this.pendingCandidates.push([n,t]);if(this.canSendCandidates)this.startCandidateSendTimer()}},{key:"startCandidateSendTimer",value:function e(){var t=this;if(this.candidateSendTimer===null||typeof this.candidateSendTimer==="undefined"){this.candidateSendTimer=setTimeout(function(){t.candidateSendTimer=null;if(t.pendingCandidates.length>0){if(u.CallManager.get().calls[t.id])u.CallManager.get().calls[t.id].sendInfo(d.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(t.pendingCandidates),{})}t.pendingCandidates=[]},this.SEND_CANDIDATE_DELAY)}}},{key:"canStartSendingCandidates",value:function e(){this.canSendCandidates=true;this.startCandidateSendTimer()}},{key:"sendDTMF",value:function e(t){var n=500;var r=50;this._sendDTMF(t,n,r)}},{key:"setVideoEnabled",value:function e(t){var n=this.videoEnabled.receiveVideo;this.videoEnabled=t;if(n!=t.receiveVideo){this._hold(this.onHold)}}},{key:"setVideoFlags",value:function e(t){this.videoEnabled=t}},{key:"updateRenderersSink",value:function e(t){var n=this;return new Promise(function(e,r){if(p.default.getWSVendor(true)!=="chrome"){r(new Error("Unsupported browser. Only Google Chrome 49 and above."));return}n.sinkId=t;var i=[];var o=true;var a=false;var s=undefined;try{for(var c=n.renderers[Symbol.iterator](),l;!(o=(l=c.next()).done);o=true){var u=l.value;i.push(u.setSinkId(t))}}catch(e){a=true;s=e}finally{try{if(!o&&c.return){c.return()}}finally{if(a){throw s}}}Promise.all(i).then(function(){e()},r)})}},{key:"getDirections",value:function e(){return this._getDirections()}},{key:"setHoldKey",value:function e(t){this.onHold=t}},{key:"getTrackKind",value:function e(){return this._getTrackKind()}},{key:"shareScreen",value:function e(t){var n=this;if(p.default.isScreenSharingSupported){return new Promise(function(e,r){if(n.onHold){r({result:false,call:n._call});return}if(n.onHold)r();n.reInviteQ.add({fx:function e(){p.default.getScreenMedia().then(function(e){n._addMediaStream(e,t);e.getTracks().forEach(function(e){return n.mediaRepository.push(e)})}).catch(r)},reject:r,resolve:function t(r){n.restoreMute();e(r)}})})}else{return new Promise(function(e,t){if(n.onHold){t({result:false,call:n._call});return}s.LogManager.get().writeMessage(s.LogCategory.CALL,"SCREEN SHARING",s.LogLevel.WARNING,"Sorry, this browser does not support screen sharing.");t(new Error("Sorry, this browser does not support screen sharing."))})}}},{key:"sendMedia",value:function e(t,n){var r=this;return new Promise(function(e,i){if(r.onHold){i({result:false,call:r._call});return}r.reInviteQ.add({fx:function e(){var i=h.Client.getInstance().config();if(i.experiments&&i.experiments.hardware){y.default.StreamManager.get()._updateCallStream(r._call).then(function(e){r.bindLocalMedia(e)})}else{var o=v.UserMediaManager.get().getConstrainWithSendFlag(t,n);r.setVideoEnabled({receiveVideo:r.videoEnabled.receiveVideo,sendVideo:n});v.UserMediaManager.get().getQueryMediaSilent(o).then(function(e){r.bindLocalMedia(e)})}},reject:i,resolve:function t(n){r.restoreMute();e(n)}})})}},{key:"stopSharingScreen",value:function e(){var t=this;if(p.default.isScreenSharingSupported){return new Promise(function(e,n){if(t.onHold){n({result:false,call:t._call});return}if(t.onHold)n();t.reInviteQ.add({fx:function e(){t._stopSharing()},reject:n,resolve:function n(r){t.restoreMute();e(r)}})})}else return new Promise(function(e,n){if(t.onHold){n({result:false,call:t._call});return}s.LogManager.get().writeMessage(s.LogCategory.CALL,"SCREEN SHARING",s.LogLevel.WARNING,"Sorry, this browser does not support screen sharing.");n(new Error("Sorry, this browser does not support screen sharing."))})}},{key:"hold",value:function e(t){var n=this;return new Promise(function(e,r){n.reInviteQ.add({fx:function e(){n._hold(t)},reject:r,resolve:function t(r){n.restoreMute();e(r)}})})}},{key:"hdnFRS",value:function e(){var t=this;return new Promise(function(e,n){if(t.onHold){n({result:false,call:t._call});return}t.reInviteQ.add({fx:function e(){t._hdnFRS()},reject:n,resolve:function n(r){t.restoreMute();e(r)}})})}},{key:"addMediaStream",value:function e(t,n){var r=this;return new Promise(function(e,i){if(r.onHold){i({result:false,call:r._call});return}r.reInviteQ.add({fx:function e(){r._addMediaStream(t,n)},reject:i,resolve:function t(n){r.restoreMute();e(n)}})})}},{key:"muteMicrophone",value:function e(t){var n=this;if(this.muteMicState===t)return;this.muteMicState=t;this.localStream.getAudioTracks().forEach(function(e){e.enabled=!n.muteMicState})}},{key:"restoreMute",value:function e(){var t=this;if(this._call.settings.active){var n=this;setTimeout(function(){t._call.restoreRMute();if(t.localStream)t.localStream.getAudioTracks().forEach(function(e){e.enabled=!n.muteMicState})},300)}}},{key:"_traceName",value:function e(){return"PeerConnection"}},{key:"localStream",get:function e(){return this._localStream}},{key:"remoteStreams",get:function e(){return this._remoteStreams}},{key:"videoRenderer",get:function e(){var t=null;this.renderers.forEach(function(e){if(e.tagName.toLowerCase()==="video")t=e});return t}},{key:"audioRenderer",get:function e(){this.renderers.forEach(function(e){if(e.tagName.toLowerCase()==="audio")return e});return null}}]);return e}();a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"setState",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"getState",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"processRemoteAnswer",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"getLocalOffer",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"getLocalAnswer",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"processRemoteOffer",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"close",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"addRemoteCandidate",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"sendLocalCandidateToPeer",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"bindLocalMedia",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"handleReinvite",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"addCandidateToSend",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"startCandidateSendTimer",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"canStartSendingCandidates",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"sendDTMF",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"setVideoEnabled",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"setVideoFlags",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"updateRenderersSink",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"setHoldKey",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"getTrackKind",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"shareScreen",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"sendMedia",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"stopSharingScreen",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"hold",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"hdnFRS",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"addMediaStream",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"muteMicrophone",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],_.prototype,"restoreMute",null);t.PeerConnection=_},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(5);var c=n(0);var l=function(){function e(){o(this,e);this.videoElements=new Array;this.audioElements=new Array;this.log=c.LogManager.get().createLogger(c.LogCategory.RTC,"Renderer")}r(e,[{key:"getElement",value:function e(t,n,r){var i=r||this._defaultContainer||document.body;if(document.getElementById(t)){var o=document.getElementById(t);if(i)o.parentElement.removeChild(o)}var a=void 0;a=document.createElement(n?"video":"audio");a.autoplay=true;a.setAttribute("playsinline",null);if(n){this.videoElements.push(a);a.width=400;a.height=300}else{this.audioElements.push(a)}a.id=t;if(i){i.appendChild(a)}return a}},{key:"getElementId",value:function e(t,n){}},{key:"renderStream",value:function e(t,n){var r=this.getElement(t.id,t.getVideoTracks().length>0,n);s.default.attachMedia(t,r);return r}},{key:"setPlaybackVolume",value:function e(t){for(var n in this.audioElements){if(this.audioElements.hasOwnProperty(n)){this.audioElements[n].volume=t}}for(var r in this.videoElements){if(this.videoElements.hasOwnProperty(r)){this.videoElements[r].volume=t}}}},{key:"releaseElement",value:function e(t){if(t){t.id="";if(typeof t.parentElement!="undefined"&&t.parentElement!==null){if(t.parentElement)t.parentElement.removeChild(t)}else if(t.parentNode){if(t.parentNode)t.parentNode.removeChild(t)}s.default.detachMedia(t)}}},{key:"_traceName",value:function e(){return"Renderer"}},{key:"defaultContainer",get:function e(){return this._defaultContainer},set:function e(t){this._defaultContainer=t}}],[{key:"get",value:function t(){if(!this.inst)this.inst=new e;return this.inst}}]);return e}();a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"getElement",null);a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"getElementId",null);a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"renderStream",null);a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"setPlaybackVolume",null);a([c.LogManager.d_trace(c.LogCategory.USERMEDIA)],l.prototype,"releaseElement",null);t.Renderer=l},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=n(3);var l=n(10);var u=n(4);var d=function(){function e(){o(this,e)}r(e,[{key:"_traceName",value:function e(){return"Logger"}}],[{key:"extend",value:function e(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++){n[r]=arguments[r]}var i={};var o=function e(t){for(var n in t){if(Object.prototype.hasOwnProperty.call(t,n)){i[n]=t[n]}}};o(arguments[0]);for(var a=1;a<arguments.length;a++){var s=arguments[a];o(s)}return i}},{key:"stringifyExtraHeaders",value:function e(t){if(Object.prototype.toString.call(t)=="[object Object]")t=JSON.stringify(t);else t=null;return t}},{key:"cadScript",value:function e(t){var n=t.split(";");return n.map(function(e){if(e.length===0){return}var t=e.match(/\([0-9\/\.,\*\+]*\)$/),n=e.substring(0,t.index),r=t.pop();if(t.length){throw new Error("cadence script should be of the form `%f(%f/%f[,%f/%f])`")}n=n==="*"?Infinity:parseFloat(n);if(isNaN(n)){throw new Error("cadence length should be of the form `%f`")}r=r.slice(1,r.length-1).split(",").map(function(e){try{var t=e.split("/");if(t.length>3){throw new Error}t=t.map(function(e,t){if(t===2){var n=e.split("+").map(function(e){var t=parseInt(e,10);if(isNaN(t)){throw new Error}return t-1});return n}var r;if(e=="*"){r=Infinity}r=r?r:parseFloat(e);if(isNaN(r)){throw new Error}return r});return{on:t[0],off:t[1],frequencies:t[2]}}catch(e){throw new Error("cadence segments should be of the form `%f/%f[%d[+%d]]`")}});return{duration:n,sections:r}})}},{key:"freqScript",value:function e(t){var n=t.split(",");return n.map(function(e){try{var t=e.split("@"),n=parseInt(t.shift()),r=parseFloat(t.shift());if(t.length){throw Error()}return{frequency:n,decibels:r}}catch(e){throw new Error("freqScript pairs are expected to be of the form `%d@%f[,%d@%f]`")}})}},{key:"toneScript",value:function e(t){var n=t.split(";"),r=this.freqScript(n.shift()),i=this.cadScript(n.join(";"));return{frequencies:r,cadences:i}}},{key:"playToneScript",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(typeof window.AudioContext!="undefined"||typeof window.webkitAudioContext!="undefined"){var r=u.UserMediaManager.get().audioContext;if(r===null)return;var i=this.toneScript(t),o=[],a=0;var s=function e(t){for(var n=0;n<r.sampleRate*t;n++){o.push(0)}};var c=function e(t,n){for(var a=0;a<r.sampleRate*n;a++){var s=0;for(var c=0;c<t.length;c++){s+=Math.pow(10,i.frequencies[t[c]].decibels/20)*Math.sin((o.length+a)*(3.14159265359/r.sampleRate)*i.frequencies[t[c]].frequency);if(a<10)s*=a/10;if(a>r.sampleRate*n-10)s*=(r.sampleRate*n-a)/10}o.push(s)}};var l=function e(t,n){if(n!=Infinity)var r=n;else r=n=20;if(t.off!==0&&t.off!=Infinity){while(r>0){c(t.frequencies,t.on);r-=t.on;s(t.off);r-=t.off;var i=r*10;r=parseInt(String(r*10))/10}}else{c(t.frequencies,n)}};var d=function e(t){if(t.duration!=Infinity)a+=t.duration;else a+=20;for(var n=0;n<t.sections.length;n++){l(t.sections[n],t.duration)}};this.source=r.createBufferSource();for(var f=0;f<i.cadences.length;f++){if(i.cadences[f].duration==Infinity)this.source.loop=true;d(i.cadences[f])}this.source.connect(r.destination);var g=r.createBuffer(1,a*r.sampleRate,r.sampleRate);var p=g.getChannelData(0);for(var v=0;v<a*r.sampleRate;v++){p[v]=o[v]}o=null;this.source.buffer=g;if(n===true)this.source.loop=true;this.source.start(0)}}},{key:"stopPlayback",value:function e(){if(typeof this.source!=="undefined"&&this.source!==null){this.source.stop(0);this.source=null;return true}return false}},{key:"sendRequest",value:function e(t,n,r,i){var o=false;var a=function e(){var t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];var n;for(var r=0;r<t.length;r++){try{n=t[r]();if(r===0)o=true}catch(e){continue}break}return n};var s=a();if(!s)return;var c=i?"POST":"GET";if(!o){s.open(c,t,true);if(i)s.setRequestHeader("Content-type","application/x-www-form-urlencoded");s.onreadystatechange=function(){if(s.readyState!=4)return;if(s.status!=200&&s.status!=304){r(s);return}n(s)};if(s.readyState==4)return;s.send(i)}else{s.onerror=function(){r(s)};s.ontimeout=function(){r(s)};s.onload=function(){n(s)};s.open(c,t);s.timeout=5e3;s.send()}}},{key:"getServers",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var r=arguments[2];var i="https:"==document.location.protocol?"https://":"http://";if(n===true)var o=i+"balancer.voximplant.com/getNearestHost";else o=i+"balancer.voximplant.com/getNearestHost";this.sendRequest(o,function(e){a(e.responseText)},function(e){a(null)});function a(e){if(e!==null)t(e);else if(n!==true)this.getServers(t,true,r);else r.dispatchEvent({name:"ConnectionFailed",message:"VoxImplant Cloud is unavailable"})}}},{key:"generateUUID",value:function e(){var t=this._gri,n=this._ha;return n(t(32),8)+"-"+n(t(16),4)+"-"+n(16384|t(12),4)+"-"+n(32768|t(14),4)+"-"+n(t(48),12)}},{key:"_gri",value:function e(t){if(t<0)return NaN;if(t<=30)return 0|Math.random()*(1<<t);if(t<=53)return(0|Math.random()*(1<<30))+(0|Math.random()*(1<<t-30))*(1<<30);return NaN}},{key:"_ha",value:function e(t,n){var r=t.toString(16),i=n-r.length,o="0";for(;i>0;i>>>=1,o+=o){if(i&1){r=o+r}}return r}},{key:"filterXSS",value:function e(t){var n=document.createElement("div");n.appendChild(document.createTextNode(t));t=n.innerHTML;return t}},{key:"checkCA",value:function e(){if(!c.Client.getInstance().connected())throw new Error("NOT_CONNECTED_TO_VOXIMPLANT");if(!l.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED")}},{key:"canRTC",value:function e(t){return}},{key:"mixObjectToLeft",value:function e(t,n){for(var r in t){if(typeof n[r]=="undefined")continue;t[r]=n[r]}return t}},{key:"makeRandomString",value:function e(t){var n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/";var r="";for(var i=0;i<t;i++){r+=n.charAt(Math.floor(Math.random()*n.length))}return r}}]);return e}();d.source=null;a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"extend",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"stringifyExtraHeaders",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"cadScript",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"freqScript",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"toneScript",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"playToneScript",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"stopPlayback",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"sendRequest",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"getServers",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"generateUUID",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"_gri",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"_ha",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"filterXSS",null);a([s.LogManager.d_trace(s.LogCategory.UTILS)],d,"checkCA",null);t.Utils=d},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=n(4);var a=function(){r(e,null,[{key:"get",value:function t(){if(!this.inst)this.inst=new e;return this.inst}}]);function e(){i(this,e);this.audioCache={};this.videoCache={}}r(e,[{key:"clear",value:function e(){var t=true;var n=false;var r=undefined;try{for(var i=this.videoCache[Symbol.iterator](),o;!(t=(o=i.next()).done);t=true){var a=o.value;a.stop()}}catch(e){n=true;r=e}finally{try{if(!t&&i.return){i.return()}}finally{if(n){throw r}}}var s=true;var c=false;var l=undefined;try{for(var u=this.audioCache[Symbol.iterator](),d;!(s=(d=u.next()).done);s=true){var f=d.value;f.stop()}}catch(e){c=true;l=e}finally{try{if(!s&&u.return){u.return()}}finally{if(c){throw l}}}}},{key:"getTrack",value:function e(t,n){var r=this;return new Promise(function(e,i){if(t=="")t="def";switch(n){case"audio":e(r.audioCache[t]);break;case"video":e(r.videoCache[t]);break;default:e();break}})}},{key:"setTrack",value:function t(n,r,i){if(n=="")n="def";switch(r){case"audio":this.audioCache[n]=i;break;case"video":this.videoCache[n]=i;break;default:return}i.onmute=function(t){e.get().removeTrackByTrack(t.target)}}},{key:"removeTrackByTrack",value:function e(t){switch(t.kind){case"audio":this._removeTrackFromCache(this.audioCache,t);break;case"video":this._removeTrackFromCache(this.videoCache,t);break;default:return}o.UserMediaManager.get().resetLocalVideo()}},{key:"_removeTrackFromCache",value:function e(t,n){for(var r in t){if(t.hasOwnProperty(r)){if(t[r].id===n.id)delete t[r]}}n.stop()}},{key:"getAudioCache",value:function e(){return this.audioCache}},{key:"getVideoCache",value:function e(){return this.videoCache}},{key:"_traceName",value:function e(){return"MediaCache"}}]);return e}();t.MediaCache=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(9);var c=n(0);var l=function(){function e(t,n){var r=this;o(this,e);this._pcStatus=n;this._q=[];t.on(s.CallEvents.Updated,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"Updated with result "+t.result);if(e._currentReinvite){var n=e._currentReinvite;if(t.result)n.resolve(t);else n.reject(t);e._currentReinvite=undefined}r.runNext()});t.on(s.CallEvents.PendingUpdate,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"IncomingUpdate. Local RI=="+i(e._currentReinvite));if(e._currentReinvite){e._currentReinvite.reject();e._currentReinvite=undefined}});t.on(s.CallEvents.UpdateFailed,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"UpdateFailed");if(e._currentReinvite){e._currentReinvite.reject();e._currentReinvite=undefined}})}r(e,[{key:"runNext",value:function t(){if(typeof e._currentReinvite==="undefined"&&this._q.length>0&&this._pcStatus()){e._currentReinvite=this._q.splice(0,1)[0];e._currentReinvite.fx()}}},{key:"add",value:function e(t){this._q.push(t);this.runNext()}},{key:"clear",value:function e(){this._q.forEach(function(e){e.reject()})}},{key:"_traceName",value:function e(){return"ReInviteQ"}}]);return e}();a([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"runNext",null);a([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"add",null);a([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"clear",null);t.ReInviteQ=l},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=function(){function e(){o(this,e)}r(e,[{key:"_traceName",value:function e(){return"SDPMuggle"}}],[{key:"detectDirections",value:function t(n){var r=[];var i=n.split(/(\r\n|\r|\n)/).filter(e.validLine);var o="";i.forEach(function(e){if(e.indexOf("m=")===0){var t=e.substr(2);o=t.split(" ")[0]}if(o!==""&&(e==="a=sendrecv"||e==="a=sendonly"||e==="a=recvonly"||e==="a=inactive")){r.push({type:o,direction:e.substr(2)});o=""}});return r}},{key:"removeTelephoneEvents",value:function t(n){if(n.sdp.indexOf("a=rtpmap:127 telephone-event/8000")!==-1){var r=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=-1;for(var o=0;o<r.length;o++){if(r[o].indexOf("m=audio")!==-1){var a=r[o];if(typeof a==="string")r[o]=a.replace(" 127","")}if(r[o].indexOf("a=rtpmap:127 telephone-event/8000")!==-1)i=o}r.splice(i,1);n.sdp=r.join("\r\n")+"\r\n"}return n}},{key:"removeDoubleOpus",value:function t(n){if(n.sdp.indexOf("a=rtpmap:109 opus")!==-1&&n.sdp.indexOf("a=rtpmap:111 opus")!==-1){var r=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=-1;for(var o=0;o<r.length;o++){if(r[o].indexOf("m=audio")!==-1){var a=r[o];if(typeof a==="string")r[o]=a.replace(" 109","")}if(r[o].indexOf("a=rtpmap:109 opus")!==-1)i=o}r.splice(i,1);n.sdp=r.join("\r\n")+"\r\n"}return n}},{key:"removeTIAS",value:function t(n){if(n.sdp.indexOf("b=TIAS")!==-1){var r=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var i=[];r.forEach(function(e,t){if(e.indexOf("b=TIAS")!==-1)i.unshift(t)});i.forEach(function(e){return r.splice(e,1)});n={type:n.type,sdp:r.join("\r\n")+"\r\n"}}return n}},{key:"fixVideoRecieve",value:function t(n,r){var i=n.sdp.indexOf("m=video");if(i!==-1&&!r){var o=n.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine);var a=null;o=o.map(function(e,t){if(a===null){if(e.indexOf("m=video")!==-1)a=t}else{if(e==="a=sendrecv")e="a=sendonly";else if(e==="a=recvonly")e="a=inactive"}return e});n.sdp=o.join("\r\n")+"\r\n"}return n}},{key:"addSetupAttribute",value:function e(t){var n=t.indexOf("a=setup:");if(n==-1){t+="a=setup:actpass\r\n"}return t}}]);return e}();c.validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/);a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"removeTelephoneEvents",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"removeDoubleOpus",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"removeTIAS",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"fixVideoRecieve",null);t.SDPMuggle=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var l=n(0);var u=n(26);var d=n(1);var f=n(15);var g=function(e){s(t,e);function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(t.instance){throw new Error("Error - use Client.getMessagingInstance()")}e.eventListeners=[];e.query=[];setInterval(function(){e.updateQuery()},220);return e}r(t,[{key:"handleWsData",value:function e(t){var n=["onCreateConversation","onEditConversation","onRemoveConversation","onJoinConversation","onLeaveConversation","onGetConversation","onSendMessage","onEditMessage","onRemoveMessage","onTyping","onRetransmitEvents","onEditUser","onGetUser","isRead","isDelivered","onError","onSubscribe","onUnSubscribe","onSetStatus"];if(n.indexOf(t.event)!=-1)this.dispatchEvent(t.event,t);else throw new Error("Unknown messaging event "+t.event+" with payload "+JSON.stringify(t.payload))}},{key:"sendPayload",value:function e(t,n){var r={service:u.MsgService.Chat,event:t,payload:n};this.query.push(r);return true}},{key:"updateQuery",value:function e(){if(this.query.length){var t=this.query.splice(0,1);d.VoxSignaling.get().sendRaw(t[0])}}},{key:"dispatchEvent",value:function e(t,n){if(typeof this.eventListeners[t]!="undefined")for(var r=0;r<this.eventListeners[t].length;r++){if(typeof this.eventListeners[t][r]=="function")this.eventListeners[t][r](n.payload)}}},{key:"_traceName",value:function e(){return"MsgSignaling"}}],[{key:"get",value:function e(){t.instance=t.instance||new t;return t.instance}}]);return t}(f.EventDispatcher);c([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"handleWsData",null);c([l.LogManager.d_trace(l.LogCategory.MESSAGING)],g.prototype,"sendPayload",null);t.MsgSignaling=g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["Chat"]="chat"]="Chat"})(r=t.MsgService||(t.MsgService={}));var i;(function(e){e[e["createConversation"]="createConversation"]="createConversation";e[e["editConversation"]="editConversation"]="editConversation";e[e["removeConversation"]="removeConversation"]="removeConversation";e[e["joinConversation"]="joinConversation"]="joinConversation";e[e["leaveConversation"]="leaveConversation"]="leaveConversation";e[e["getConversation"]="getConversation"]="getConversation";e[e["getConversations"]="getConversations"]="getConversations";e[e["sendMessage"]="sendMessage"]="sendMessage";e[e["editMessage"]="editMessage"]="editMessage";e[e["removeMessage"]="removeMessage"]="removeMessage";e[e["typingMessage"]="typingMessage"]="typingMessage";e[e["editUser"]="editUser"]="editUser";e[e["getUser"]="getUser"]="getUser";e[e["getUsers"]="getUsers"]="getUsers";e[e["retransmitEvents"]="retransmitEvents"]="retransmitEvents";e[e["isRead"]="isRead"]="isRead";e[e["isDelivered"]="isDelivered"]="isDelivered";e[e["addParticipants"]="addParticipants"]="addParticipants";e[e["editParticipants"]="editParticipants"]="editParticipants";e[e["removeParticipants"]="removeParticipants"]="removeParticipants";e[e["addModerators"]="addModerators"]="addModerators";e[e["removeModerators"]="removeModerators"]="removeModerators";e[e["subscribe"]="subscribe"]="subscribe";e[e["unsubscribe"]="unsubscribe"]="unsubscribe";e[e["setStatus"]="setStatus"]="setStatus"})(i=t.MsgAction||(t.MsgAction={}));var o;(function(e){e[e["onCreateConversation"]="onCreateConversation"]="onCreateConversation";e[e["onEditConversation"]="onEditConversation"]="onEditConversation";e[e["onRemoveConversation"]="onRemoveConversation"]="onRemoveConversation";e[e["onJoinConversation"]="onJoinConversation"]="onJoinConversation";e[e["onLeaveConversation"]="onLeaveConversation"]="onLeaveConversation";e[e["onGetConversation"]="onGetConversation"]="onGetConversation";e[e["onSendMessage"]="onSendMessage"]="onSendMessage";e[e["onEditMessage"]="onEditMessage"]="onEditMessage";e[e["onRemoveMessage"]="onRemoveMessage"]="onRemoveMessage";e[e["onTyping"]="onTyping"]="onTyping";e[e["onRetransmitEvents"]="onRetransmitEvents"]="onRetransmitEvents";e[e["onEditUser"]="onEditUser"]="onEditUser";e[e["onGetUser"]="onGetUser"]="onGetUser";e[e["onError"]="onError"]="onError";e[e["isRead"]="isRead"]="isRead";e[e["isDelivered"]="isDelivered"]="isDelivered";e[e["onsubscribe"]="onsubscribe"]="onsubscribe";e[e["onUnSubscribe"]="onUnSubscribe"]="onUnSubscribe";e[e["onSetStatus"]="onSetStatus"]="onSetStatus"})(o=t.MsgEvent||(t.MsgEvent={}))},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=function(){function e(t){i(this,e);this.str=t||e.getNewGUIDString()}r(e,[{key:"toString",value:function e(){return this.str}},{key:"_traceName",value:function e(){return"GUID"}}],[{key:"getNewGUIDString",value:function e(){var t=(new Date).getTime();if(window.performance&&typeof window.performance.now==="function"){t+=performance.now()}return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=(t+Math.random()*16)%16|0;t=Math.floor(t/16);return(e=="x"?n:n&3|8).toString(16)})}}]);return e}();t.GUID=o},function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)};r.localCName=r.generateIdentifier();r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})};r.splitSections=function(e){var t=e.split("\nm=");return t.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})};r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return e.indexOf(t)===0})};r.parseCandidate=function(e){var t;if(e.indexOf("a=candidate:")===0){t=e.substring(12).split(" ")}else{t=e.substring(10).split(" ")}var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]};for(var r=8;r<t.length;r+=2){switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1];n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1];break}}return n};r.writeCandidate=function(e){var t=[];t.push(e.foundation);t.push(e.component);t.push(e.protocol.toUpperCase());t.push(e.priority);t.push(e.ip);t.push(e.port);var n=e.type;t.push("typ");t.push(n);if(n!=="host"&&e.relatedAddress&&e.relatedPort){t.push("raddr");t.push(e.relatedAddress);t.push("rport");t.push(e.relatedPort)}if(e.tcpType&&e.protocol.toLowerCase()==="tcp"){t.push("tcptype");t.push(e.tcpType)}if(e.ufrag){t.push("ufrag");t.push(e.ufrag)}return"candidate:"+t.join(" ")};r.parseIceOptions=function(e){return e.substr(14).split(" ")};r.parseRtpMap=function(e){var t=e.substr(9).split(" ");var n={payloadType:parseInt(t.shift(),10)};t=t[0].split("/");n.name=t[0];n.clockRate=parseInt(t[1],10);n.numChannels=t.length===3?parseInt(t[2],10):1;return n};r.writeRtpMap=function(e){var t=e.payloadType;if(e.preferredPayloadType!==undefined){t=e.preferredPayloadType}return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(e.numChannels!==1?"/"+e.numChannels:"")+"\r\n"};r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}};r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+"\r\n"};r.parseFmtp=function(e){var t={};var n;var r=e.substr(e.indexOf(" ")+1).split(";");for(var i=0;i<r.length;i++){n=r[i].trim().split("=");t[n[0].trim()]=n[1]}return t};r.writeFmtp=function(e){var t="";var n=e.payloadType;if(e.preferredPayloadType!==undefined){n=e.preferredPayloadType}if(e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])});t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t};r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}};r.writeRtcpFb=function(e){var t="";var n=e.payloadType;if(e.preferredPayloadType!==undefined){n=e.preferredPayloadType}if(e.rtcpFeedback&&e.rtcpFeedback.length){e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})}return t};r.parseSsrcMedia=function(e){var t=e.indexOf(" ");var n={ssrc:parseInt(e.substr(7,t-7),10)};var r=e.indexOf(":",t);if(r>-1){n.attribute=e.substr(t+1,r-t-1);n.value=e.substr(r+1)}else{n.attribute=e.substr(t+1)}return n};r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t){return t.substr(6)}};r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}};r.getDtlsParameters=function(e,t){var n=r.matchPrefix(e+t,"a=fingerprint:");return{role:"auto",fingerprints:n.map(r.parseFingerprint)}};r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"});return n};r.getIceParameters=function(e,t){var n=r.splitLines(e);n=n.concat(r.splitLines(t));var i={usernameFragment:n.filter(function(e){return e.indexOf("a=ice-ufrag:")===0})[0].substr(12),password:n.filter(function(e){return e.indexOf("a=ice-pwd:")===0})[0].substr(10)};return i};r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\n"+"a=ice-pwd:"+e.password+"\r\n"};r.parseRtpParameters=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]};var n=r.splitLines(e);var i=n[0].split(" ");for(var o=3;o<i.length;o++){var a=i[o];var s=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=r.parseRtpMap(s);var l=r.matchPrefix(e,"a=fmtp:"+a+" ");c.parameters=l.length?r.parseFmtp(l[0]):{};c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb);t.codecs.push(c);switch(c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase());break;default:break}}}r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))});return t};r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ";n+=t.codecs.length>0?"9":"0";n+=" UDP/TLS/RTP/SAVPF ";n+=t.codecs.map(function(e){if(e.preferredPayloadType!==undefined){return e.preferredPayloadType}return e.payloadType}).join(" ")+"\r\n";n+="c=IN IP4 0.0.0.0\r\n";n+="a=rtcp:9 IN IP4 0.0.0.0\r\n";t.codecs.forEach(function(e){n+=r.writeRtpMap(e);n+=r.writeFmtp(e);n+=r.writeRtcpFb(e)});var i=0;t.codecs.forEach(function(e){if(e.maxptime>i){i=e.maxptime}});if(i>0){n+="a=maxptime:"+i+"\r\n"}n+="a=rtcp-mux\r\n";t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)});return n};r.parseRtpEncodingParameters=function(e){var t=[];var n=r.parseRtpParameters(e);var i=n.fecMechanisms.indexOf("RED")!==-1;var o=n.fecMechanisms.indexOf("ULPFEC")!==-1;var a=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"});var s=a.length>0&&a[0].ssrc;var c;var l=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");t.shift();return t.map(function(e){return parseInt(e,10)})});if(l.length>0&&l[0].length>1&&l[0][0]===s){c=l[0][1]}n.codecs.forEach(function(e){if(e.name.toUpperCase()==="RTX"&&e.parameters.apt){var n={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:c}};t.push(n);if(i){n=JSON.parse(JSON.stringify(n));n.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"};t.push(n)}}});if(t.length===0&&s){t.push({ssrc:s})}var u=r.matchPrefix(e,"b=");if(u.length){if(u[0].indexOf("b=TIAS:")===0){u=parseInt(u[0].substr(7),10)}else if(u[0].indexOf("b=AS:")===0){u=parseInt(u[0].substr(5),10)*1e3*.95-50*40*8}else{u=undefined}t.forEach(function(e){e.maxBitrate=u})}return t};r.parseRtcpParameters=function(e){var t={};var n;var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="cname"})[0];if(i){t.cname=i.value;t.ssrc=i.ssrc}var o=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=o.length>0;t.compound=o.length===0;var a=r.matchPrefix(e,"a=rtcp-mux");t.mux=a.length>0;return t};r.parseMsid=function(e){var t;var n=r.matchPrefix(e,"a=msid:");if(n.length===1){t=n[0].substr(7).split(" ");return{stream:t[0],track:t[1]}}var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return e.attribute==="msid"});if(i.length>0){t=i[0].value.split(" ");return{stream:t[0],track:t[1]}}};r.generateSessionId=function(){return Math.random().toString().substr(2,21)};r.writeSessionBoilerplate=function(e,t){var n;var i=t!==undefined?t:2;if(e){n=e}else{n=r.generateSessionId()}return"v=0\r\n"+"o=thisisadapterortc "+n+" "+i+" IN IP4 127.0.0.1\r\n"+"s=-\r\n"+"t=0 0\r\n"};r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);o+=r.writeIceParameters(e.iceGatherer.getLocalParameters());o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":"active");o+="a=mid:"+e.mid+"\r\n";if(e.direction){o+="a="+e.direction+"\r\n"}else if(e.rtpSender&&e.rtpReceiver){o+="a=sendrecv\r\n"}else if(e.rtpSender){o+="a=sendonly\r\n"}else if(e.rtpReceiver){o+="a=recvonly\r\n"}else{o+="a=inactive\r\n"}if(e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a;o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a;if(e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a;o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"}return o};r.getDirection=function(e,t){var n=r.splitLines(e);for(var i=0;i<n.length;i++){switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2);default:}}if(t){return r.getDirection(t)}return"sendrecv"};r.getKind=function(e){var t=r.splitLines(e);var n=t[0].split(" ");return n[0].substr(2)};r.isRejected=function(e){return e.split(" ",2)[1]==="0"};r.parseMLine=function(e){var t=r.splitLines(e);var n=t[0].split(" ");return{kind:n[0].substr(2),port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}};if(true){e.exports=r}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(25);var c=n(27);var l=n(0);var u=n(10);var d=n(26);var f;(function(e){var t=function(){function e(t,n,r,i,a){o(this,e);this._distinct=n;this._publicJoin=r;this._participants=t;this._customData=i;this._moderators=a}r(e,[{key:"_getPayload",value:function e(){if(typeof this._uuid=="undefined")throw Error("You must create UUID with createUUID() function!");var t={uuid:this._uuid,participants:this._prepareParticipants(this._participants)};if(typeof this._title!="undefined")t["title"]=this._title;else t["title"]="";if(typeof this._moderators!="undefined")t["moderators"]=this._moderators;else t["moderators"]=[];if(typeof this._lastRead!="undefined")t["last_readed"]=this._lastRead;if(typeof this._distinct!="undefined")t["distinct"]=this._distinct;else t["distinct"]=false;if(typeof this._publicJoin!="undefined")t["enable_public_join"]=this._publicJoin;else t["enable_public_join"]=false;if(typeof this._customData!="undefined")t["custom_data"]=this._customData;else t["custom_data"]={};if(typeof this._createdAt!="undefined")t["created_at"]=this._createdAt;if(typeof this._createdAt!="undefined")t["uber_conversation"]=this._uberConversation;return t}},{key:"_getSimplePayload",value:function e(){if(typeof this._uuid=="undefined")throw Error("You must create UUID with createUUID() function!");return{uuid:this._uuid,title:typeof this._title!="undefined"?this._title:"",distinct:typeof this._distinct!="undefined"?this._distinct:false,enable_public_join:typeof this._publicJoin!="undefined"?this._publicJoin:false,custom_data:typeof this._customData!="undefined"?this._customData:{}}}},{key:"_prepareParticipants",value:function e(t){var r=[];var i=true;var o=false;var a=undefined;try{for(var s=t[Symbol.iterator](),c;!(i=(c=s.next()).done);i=true){var l=c.value;if(typeof l.userId!="undefined"){var u={user_id:n.extractUserName(l.userId)};u["can_write"]=typeof l.canWrite=="undefined"?true:l.canWrite;u["can_manage_participants"]=typeof l.canManageParticipants=="undefined"?false:l.canManageParticipants;r.push(u)}}}catch(e){o=true;a=e}finally{try{if(!i&&s.return){s.return()}}finally{if(o){throw a}}}return r}},{key:"_createUUID",value:function e(){if(typeof this._uuid!="undefined")throw Error("UUID already created!");this._uuid=(new c.GUID).toString()}},{key:"toCache",value:function e(){return{uuid:this._uuid,seq:this._lastSeq,lastUpdate:this._lastUpdate,moderators:this._moderators,title:this._title,createdAt:this._createdAt,lastRead:this._lastRead,distinct:this._distinct,publicJoin:this._publicJoin,participants:this._participants,customData:this._customData}}},{key:"sendMessage",value:function e(t,n){var r=new i(t,n);r.sendTo(this);return r}},{key:"typing",value:function e(){var t=this;if(this._debounceLock)return false;setTimeout(function(){t._debounceLock=false},1e4);this._debounceLock=true;s.MsgSignaling.get().sendPayload(d.MsgAction.typingMessage,{conversation:this._uuid});return true}},{key:"markAsRead",value:function e(t){s.MsgSignaling.get().sendPayload(d.MsgAction.isRead,{conversation:this._uuid,seq:t});this._lastRead=t}},{key:"markAsDelivered",value:function e(t){s.MsgSignaling.get().sendPayload(d.MsgAction.isDelivered,{conversation:this._uuid,seq:t})}},{key:"remove",value:function e(){n.get().removeConversation(this._uuid)}},{key:"update",value:function e(){n.get().editConversation(this)}},{key:"setTitle",value:function e(t){this._title=t;n.get().editConversation(this)}},{key:"setPublicJoin",value:function e(t){this._publicJoin=t;n.get().editConversation(this)}},{key:"setDistinct",value:function e(t){this._distinct=t;n.get().editConversation(this)}},{key:"setCustomData",value:function e(t){this._customData=t;n.get().editConversation(this)}},{key:"addParticipants",value:function e(t){var n=this;return new Promise(function(e,r){if(t.length==0)r();s.MsgSignaling.get().sendPayload(d.MsgAction.addParticipants,{uuid:n._uuid,participants:n._prepareParticipants(t)});f.getInstance()._registerPromise(g.EditConversation,e,r)})}},{key:"editParticipants",value:function e(t){var n=this;return new Promise(function(e,r){if(t.length==0)r();s.MsgSignaling.get().sendPayload(d.MsgAction.editParticipants,{uuid:n._uuid,participants:n._prepareParticipants(t)});f.getInstance()._registerPromise(g.EditConversation,e,r)})}},{key:"removeParticipants",value:function e(t){var n=this;return new Promise(function(e,r){if(t.length==0)r();s.MsgSignaling.get().sendPayload(d.MsgAction.removeParticipants,{uuid:n._uuid,participants:t.map(function(e){if(typeof e.userId!=="undefined")return e.userId})});f.getInstance()._registerPromise(g.EditConversation,e,r)})}},{key:"addModerators",value:function e(t){var n=this;return new Promise(function(e,r){if(t.length==0)r();s.MsgSignaling.get().sendPayload(d.MsgAction.addModerators,{uuid:n._uuid,moderators:t});f.getInstance()._registerPromise(g.EditConversation,e,r)})}},{key:"removeModerators",value:function e(t){var n=this;return new Promise(function(e,r){if(t.length==0)r();s.MsgSignaling.get().sendPayload(d.MsgAction.removeModerators,{uuid:n._uuid,moderators:t});f.getInstance()._registerPromise(g.EditConversation,e,r)})}},{key:"retransmitEvents",value:function e(t,n){t=t|0;n=n|0;s.MsgSignaling.get().sendPayload(d.MsgAction.retransmitEvents,{uuid:this._uuid,eventsFrom:t,eventsTo:n})}},{key:"updateSeq",value:function e(t){if(t>this._lastSeq){this._lastSeq=t}this._lastUpdate=Date.now()/1e3|0}},{key:"_traceName",value:function e(){return"Conversation"}},{key:"lastRead",get:function e(){return this._lastRead}},{key:"uberConversation",get:function e(){return this._uberConversation}},{key:"uuid",get:function e(){return this._uuid}},{key:"title",set:function e(t){this._title=t},get:function e(){return this._title}},{key:"distinct",set:function e(t){this._distinct=t},get:function e(){return this._distinct}},{key:"publicJoin",set:function e(t){this._publicJoin=t},get:function e(){return this._publicJoin}},{key:"customData",set:function e(t){this._customData=t},get:function e(){return this._customData}},{key:"moderators",get:function e(){return this._moderators}},{key:"createdAt",get:function e(){return this._createdAt}},{key:"participants",get:function e(){return this._participants}},{key:"lastSeq",get:function e(){return this._lastSeq}},{key:"lastUpdate",get:function e(){return this._lastUpdate}}],[{key:"_createFromBus",value:function t(n,r){var i=new e([]);i._lastSeq=r;i._uuid=n.uuid;i._title=n.title;i._moderators=n.moderators;i._createdAt=n.created_at;i._lastRead=n.last_read;i._distinct=n.distinct;i._publicJoin=n.public_join;i._uberConversation=n.uber_conversation;if(n.participants)i._participants=n.participants.map(function(e){return{userId:e.user_id,canWrite:e.can_write,canManageParticipants:e.can_manage_participants}});if(n.custom_data)i._customData=n.custom_data;i._lastUpdate=n.last_update;return i}},{key:"createFromCache",value:function t(n){var r=new e([]);r._uuid=n.uuid;r._lastSeq=n.seq;r._lastUpdate=n.lastUpdate;r._title=n.title;r._moderators=n.moderators;r._createdAt=n.createdAt;r._lastRead=n.lastRead;r._distinct=n.distinct;r._publicJoin=n.publicJoin;r._participants=n.participants;r._customData=n.customData;r._uberConversation=n.uberConversation;return r}}]);return e}();a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"_getPayload",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"_getSimplePayload",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"_prepareParticipants",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"_createUUID",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"toCache",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"markAsRead",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"markAsDelivered",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"remove",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"update",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"addParticipants",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"editParticipants",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"removeParticipants",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"addModerators",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"removeModerators",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"retransmitEvents",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t.prototype,"updateSeq",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t,"_createFromBus",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],t,"createFromCache",null);e.Conversation=t;var n=function(){function e(){var n=this;o(this,e);if(e.instance)throw new Error("Error - use ConversationManager.get()");this.signalling=s.MsgSignaling.get();this.awaitingConversations={};this.signalling.addEventListener(d.MsgEvent.onEditConversation,function(e){n.resolveEvent(e,g.EditConversation)});this.signalling.addEventListener(d.MsgEvent.onGetConversation,function(e){n.resolveEvent(e,g.GetConversation)});this.signalling.addEventListener(d.MsgEvent.onRemoveConversation,function(e){n.resolveEvent(e,g.RemoveConversation)});this.signalling.addEventListener(d.MsgEvent.onCreateConversation,function(e){n.resolveEvent(e,g.CreateConversation)});this.signalling.addEventListener(d.MsgEvent.onSendMessage,function(e){n.resolveMessageEvent(e,g.SendMessage)});this.signalling.addEventListener(d.MsgEvent.onEditMessage,function(e){n.resolveMessageEvent(e,g.EditMessage)});this.signalling.addEventListener(d.MsgEvent.onRemoveMessage,function(e){n.resolveMessageEvent(e,g.RemoveMessage)});this.signalling.addEventListener(d.MsgEvent.isRead,function(e){var t=e.object;f.getInstance()._dispatchEvent(g.Read,{conversation:t.conversation,timestamp:new Date(t.timestamp*1e3),userId:e.user_id,seq:t.seq,onIncomingEvent:e.on_incoming_event,name:g[g.Read]})});this.signalling.addEventListener(d.MsgEvent.isDelivered,function(e){var t=e.object;f.getInstance()._dispatchEvent(g.Delivered,{conversation:t.conversation,timestamp:new Date(t.timestamp*1e3),userId:e.user_id,seq:t.seq,onIncomingEvent:e.on_incoming_event,name:g[g.Delivered]})});this.signalling.addEventListener(d.MsgEvent.onTyping,function(e){f.getInstance()._dispatchEvent(g.Typing,{name:g[g.Typing],conversation:e.object.conversation,userId:e.user_id,onIncomingEvent:e.on_incoming_event})});this.signalling.addEventListener(d.MsgEvent.onRetransmitEvents,function(e){f.getInstance()._dispatchEvent(g.RetransmitEvents,{events:e.object.map(function(e){if(e.event){if(e.event.indexOf("Message")==-1)return{name:e.event,conversation:t._createFromBus(e.payload.object,e.payload.seq),userId:e.payload.user_id,seq:e.payload.seq,onIncomingEvent:e.payload.on_incoming_event};else return{name:e.event,message:i._createFromBus(e.payload.object,e.payload.seq),userId:e.payload.user_id,seq:e.payload.seq,onIncomingEvent:e.payload.on_incoming_event}}}),userId:e.user_id,seq:e.seq,from:e.from,to:e.to,onIncomingEvent:e.on_incoming_event})});this._converasationList=[]}r(e,[{key:"resolveEvent",value:function e(n,r){if(g[r]===g[g.RemoveConversation]){var i=n.object;f.getInstance()._dispatchEvent(r,{name:g[r],uuid:i.uuid,userId:n.user_id,seq:n.seq,onIncomingEvent:n.on_incoming_event});return}var o=t._createFromBus(n.object,n.seq);this.registerConversation(o);if(typeof o!="undefined")o.updateSeq(n.seq);f.getInstance()._dispatchEvent(r,{name:g[r],conversation:o,userId:n.user_id,seq:n.seq,onIncomingEvent:n.on_incoming_event});if(r===g.GetConversation&&typeof this.awaitingConversations[o.uuid]!=="undefined"){this.awaitingConversations[o.uuid](o);delete this.awaitingConversations[o.uuid]}}},{key:"resolveMessageEvent",value:function e(t,n){var r=i._createFromBus(t.object,t.seq);if(typeof this._converasationList[r.conversation]!="undefined")this._converasationList[r.conversation].updateSeq(t.seq);f.getInstance()._dispatchEvent(n,{name:g[n],message:r,userId:t.user_id,seq:t.seq,onIncomingEvent:t.on_incoming_event})}},{key:"createConversation",value:function e(n,r,i,o,a,s){var c=new t(n,i,o,a,s);c.title=r;c._createUUID();this.signalling.sendPayload(d.MsgAction.createConversation,c._getPayload())}},{key:"registerConversation",value:function e(t){this._converasationList.filter(function(e){return e.uuid!==t.uuid});this._converasationList.push(t)}},{key:"removeConversation",value:function e(t){this.signalling.sendPayload(d.MsgAction.removeConversation,{uuid:t})}},{key:"editConversation",value:function e(t){this.signalling.sendPayload(d.MsgAction.editConversation,t._getSimplePayload())}},{key:"getConversation",value:function e(t){this.signalling.sendPayload(d.MsgAction.getConversation,{uuid:t})}},{key:"getConversationByUUID",value:function e(t){var n=this;return new Promise(function(e,r){var i=true;var o=false;var a=undefined;try{for(var s=n._converasationList[Symbol.iterator](),c;!(i=(c=s.next()).done);i=true){var l=c.value;if(l.uuid===t){f.getInstance()._dispatchEvent(g.GetConversation,{conversation:l});e(l);return}}}catch(e){o=true;a=e}finally{try{if(!i&&s.return){s.return()}}finally{if(o){throw a}}}n.awaitingConversations[t]=e})}},{key:"getConversations",value:function e(t){this.signalling.sendPayload(d.MsgAction.getConversations,{uuids:t})}},{key:"_traceName",value:function e(){return"ConversationManager"}}],[{key:"get",value:function t(){e.instance=e.instance||new e;return e.instance}},{key:"extractUserName",value:function e(t){var n=t.split("@");n[1]=n[1].split(".").splice(0,2).join(".");return n.join("@")}},{key:"deserialize",value:function e(n){return t.createFromCache(n)}},{key:"serialize",value:function e(t){return t.toCache()}}]);return e}();a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"resolveEvent",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"resolveMessageEvent",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"createConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"registerConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"removeConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"editConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"getConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"getConversationByUUID",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n.prototype,"getConversations",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n,"get",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n,"extractUserName",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n,"deserialize",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],n,"serialize",null);var i=function(){function e(t,n){o(this,e);this._text=t;this._payload=n;this._uuid=(new c.GUID).toString()}r(e,[{key:"sendTo",value:function e(t){this._conversation=t.uuid;s.MsgSignaling.get().sendPayload(d.MsgAction.sendMessage,this.getPayload())}},{key:"getPayload",value:function e(){var t={uuid:this._uuid,text:this._text,conversation:this._conversation};if(typeof this._payload!=="undefined")t["payload"]=this._payload;else t["payload"]=[];return t}},{key:"update",value:function e(){s.MsgSignaling.get().sendPayload(d.MsgAction.editMessage,this.getPayload())}},{key:"remove",value:function e(){s.MsgSignaling.get().sendPayload(d.MsgAction.removeMessage,{uuid:this._uuid,conversation:this.conversation})}},{key:"toCache",value:function e(){return{seq:this._seq,uuid:this._uuid,text:this._text,payload:this._payload,conversation:this._conversation,sender:this._sender}}},{key:"_traceName",value:function e(){return"Message"}},{key:"uuid",get:function e(){return this._uuid}},{key:"conversation",get:function e(){return this._conversation}},{key:"text",get:function e(){return this._text},set:function e(t){this._text=t}},{key:"payload",get:function e(){return this._payload},set:function e(t){this._payload=t}},{key:"seq",get:function e(){return this._seq}},{key:"sender",get:function e(){return this._sender}}],[{key:"_createFromBus",value:function t(n,r){var i=new e(n.text,n.payload);i._uuid=n.uuid;i._conversation=n.conversation;i._sender=n.sender;i._seq=r;return i}},{key:"createFromCache",value:function t(n){var r=new e(n.text,n.payload);r._uuid=n.uuid;r._conversation=n.conversation;r._sender=n.sender;r._seq=n.seq;return r}}]);return e}();a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"sendTo",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"getPayload",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"update",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"remove",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i.prototype,"toCache",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i,"_createFromBus",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],i,"createFromCache",null);e.Message=i;var f=function(){function e(){var t=this;o(this,e);if(e.instance){throw new Error("Error - use Client.getIM()")}this.eventListeners={};this.signalling=s.MsgSignaling.get();this.cm=n.get();this.signalling.addEventListener(d.MsgEvent.onError,function(e){t._dispatchEvent(g.Error,e)});n.get();this.signalling.addEventListener(d.MsgEvent.onEditUser,function(e){var n=e.object;var r={user:{customData:n.custom_data,privateCustomData:n.private_custom_data,userId:n.user_id},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event};t._dispatchEvent(g.EditUser,r)});this.signalling.addEventListener(d.MsgEvent.onGetUser,function(e){var n=e.object;var r={user:{conversationsList:n.conversations_list,leaveConversationList:n.leave_conversation_list,customData:n.custom_data,privateCustomData:n.private_custom_data,userId:n.user_id},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event};t._dispatchEvent(g.GetUser,r)});this.signalling.addEventListener(d.MsgEvent.onsubscribe,function(e){t._dispatchEvent(g.Subscribe,{users:e.users})});this.signalling.addEventListener(d.MsgEvent.onUnSubscribe,function(e){t._dispatchEvent(g.Unsubscribe,{users:e.users})});this.signalling.addEventListener(d.MsgEvent.onSetStatus,function(e){t._dispatchEvent(g.SetStatus,{user:{userId:e.object.user_id,online:e.object.online,timestamp:e.object.timestamp},userId:e.user_id,seq:e.seq,onIncomingEvent:e.on_incoming_event})});this.awaitPromiseList=[]}r(e,[{key:"createConversation",value:function e(t,n,r,i,o,a){this.cm.createConversation(t,n,r,i,o,a)}},{key:"getConversation",value:function e(t){this.cm.getConversation(t)}},{key:"getConversations",value:function e(t){if(t.length>30){l.LogManager.get().writeMessage(l.LogCategory.MESSAGING,"Rate limit",l.LogLevel.ERROR,"you can get maximum 30 conversation in one getConversations");return}return this.cm.getConversations(t)}},{key:"getRawConversations",value:function e(t){return this.cm.getConversations(t)}},{key:"removeConversation",value:function e(t){this.cm.removeConversation(t)}},{key:"joinConversation",value:function e(t){this.signalling.sendPayload(d.MsgAction.joinConversation,{uuid:t})}},{key:"leaveConversation",value:function e(t){this.signalling.sendPayload(d.MsgAction.leaveConversation,{uuid:t})}},{key:"getUser",value:function e(t){this.signalling.sendPayload(d.MsgAction.getUser,{user_id:t})}},{key:"getMe",value:function e(){return n.extractUserName(u.Authenticator.get().username())}},{key:"editUser",value:function e(t,r){var i={user_id:n.extractUserName(u.Authenticator.get().username())};if(t)i["custom_data"]=t;if(r)i["private_custom_data"]=r;this.signalling.sendPayload(d.MsgAction.editUser,i)}},{key:"getUsers",value:function e(t){this.signalling.sendPayload(d.MsgAction.getUsers,{users:t})}},{key:"addEventListener",value:function e(t,n){if(typeof this.eventListeners[t]==="undefined")this.eventListeners[t]=[];this.eventListeners[t].push(n)}},{key:"removeEventListener",value:function e(t,n){if(typeof this.eventListeners[t]==="undefined")return;if(typeof n==="function"){for(var r=0;r<this.eventListeners[t].length;r++){if(this.eventListeners[t][r]===n){this.eventListeners[t].splice(r,1);break}}}else{this.eventListeners[t]=[]}}},{key:"_dispatchEvent",value:function e(t,n){n.name=g[t];if(typeof this.eventListeners[t]!=="undefined")this.eventListeners[t].forEach(function(e){if(typeof e==="function")e(n)});if(typeof this.awaitPromiseList[t]!=="undefined"&&this.awaitPromiseList[t].length!=0){var r=this.awaitPromiseList[t].splice(0,1);r.resolve(n);window.clearTimeout(r.expire)}}},{key:"on",value:function e(t,n){this.addEventListener(t,n)}},{key:"off",value:function e(t,n){this.removeEventListener(t,n)}},{key:"_registerPromise",value:function e(t,n,r){if(typeof this.awaitPromiseList[t]==="undefined")this.awaitPromiseList[t]=[];this.awaitPromiseList[t].push({resolve:n,reject:r,expire:setTimeout(function(){r()},2e4)})}},{key:"createConversationFromCache",value:function e(n){if(typeof n==="undefined")return null;return t.createFromCache(n)}},{key:"createMessageFromCache",value:function e(t){if(typeof t==="undefined")return null;return i.createFromCache(t)}},{key:"subscribe",value:function e(t){this.signalling.sendPayload(d.MsgAction.subscribe,{users:t})}},{key:"unsubscribe",value:function e(t){this.signalling.sendPayload(d.MsgAction.unsubscribe,{users:t})}},{key:"setPresence",value:function e(t){this.setStatus(t)}},{key:"setStatus",value:function e(t){this.signalling.sendPayload(d.MsgAction.setStatus,{online:t})}},{key:"_traceName",value:function e(){return"Messenger"}}],[{key:"getInstance",value:function t(){e.instance=e.instance||new e;return e.instance}}]);return e}();a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"createConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"getConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"getConversations",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"getRawConversations",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"removeConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"joinConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"leaveConversation",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"getUser",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"getMe",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"editUser",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"getUsers",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"addEventListener",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"removeEventListener",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"_dispatchEvent",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"on",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"off",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"_registerPromise",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"createConversationFromCache",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"createMessageFromCache",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"subscribe",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"unsubscribe",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"setPresence",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f.prototype,"setStatus",null);a([l.LogManager.d_trace(l.LogCategory.MESSAGING)],f,"getInstance",null);e.Messenger=f;var g=void 0;(function(e){e["CreateConversation"]="CreateConversation";e["EditConversation"]="EditConversation";e["RemoveConversation"]="RemoveConversation";e["GetConversation"]="GetConversation";e["SendMessage"]="SendMessage";e["EditMessage"]="EditMessage";e["RemoveMessage"]="RemoveMessage";e["Typing"]="Typing";e["EditUser"]="EditUser";e["GetUser"]="GetUser";e["Error"]="Error";e["RetransmitEvents"]="RetransmitEvents";e["Read"]="Read";e["Delivered"]="Delivered";e["Subscribe"]="Subscribe";e["Unsubscribe"]="Unsubscribe";e["SetStatus"]="SetStatus"})(g=e.MessengerEvents||(e.MessengerEvents={}));var p=void 0;(function(e){e[e["createConversation"]="createConversation"]="createConversation";e[e["editConversation"]="editConversation"]="editConversation";e[e["removeConversation"]="removeConversation"]="removeConversation";e[e["joinConversation"]="joinConversation"]="joinConversation";e[e["leaveConversation"]="leaveConversation"]="leaveConversation";e[e["getConversation"]="getConversation"]="getConversation";e[e["getConversations"]="getConversations"]="getConversations";e[e["sendMessage"]="sendMessage"]="sendMessage";e[e["editMessage"]="editMessage"]="editMessage";e[e["removeMessage"]="removeMessage"]="removeMessage";e[e["typingMessage"]="typingMessage"]="typingMessage";e[e["editUser"]="editUser"]="editUser";e[e["getUser"]="getUser"]="getUser";e[e["getUsers"]="getUsers"]="getUsers";e[e["retransmitEvents"]="retransmitEvents"]="retransmitEvents";e[e["isRead"]="isRead"]="isRead";e[e["isDelivered"]="isDelivered"]="isDelivered";e[e["addParticipants"]="addParticipants"]="addParticipants";e[e["editParticipants"]="editParticipants"]="editParticipants";e[e["removeParticipants"]="removeParticipants"]="removeParticipants";e[e["addModerators"]="addModerators"]="addModerators";e[e["removeModerators"]="removeModerators"]="removeModerators";e[e["subscribe"]="subscribe"]="subscribe";e[e["unsubscribe"]="unsubscribe"]="unsubscribe";e[e["setStatus"]="setStatus"]="setStatus"})(p=e.MessengerAction||(e.MessengerAction={}));var v=void 0;(function(e){e[e["Error_1"]="1"]="Error_1";e[e["Error_2"]="2"]="Error_2";e[e["Error_3"]="3"]="Error_3";e[e["Error_4"]="4"]="Error_4";e[e["Error_5"]="5"]="Error_5";e[e["Error_6"]="6"]="Error_6";e[e["Error_7"]="7"]="Error_7";e[e["Error_8"]="8"]="Error_8";e[e["Error_9"]="9"]="Error_9";e[e["Error_10"]="10"]="Error_10";e[e["Error_11"]="11"]="Error_11";e[e["Error_12"]="12"]="Error_12";e[e["Error_13"]="13"]="Error_13";e[e["Error_14"]="14"]="Error_14";e[e["Error_15"]="15"]="Error_15";e[e["Error_16"]="16"]="Error_16";e[e["Error_17"]="17"]="Error_17";e[e["Error_18"]="18"]="Error_18";e[e["Error_19"]="19"]="Error_19";e[e["Error_21"]="21"]="Error_21";e[e["Error_22"]="22"]="Error_22";e[e["Error_23"]="23"]="Error_23";e[e["Error_24"]="24"]="Error_24";e[e["Error_30"]="30"]="Error_30";e[e["Error_500"]="500"]="Error_500";e[e["Error_777"]="777"]="Error_777"})(v=e.MessengerError||(e.MessengerError={}))})(f=t.Messaging||(t.Messaging={}))},function(e,t,n){"use strict";function r(e){for(var n in e){if(!t.hasOwnProperty(n))t[n]=e[n]}}Object.defineProperty(t,"__esModule",{value:true});var i=n(3);n(46);var o=n(10);var a=n(29);var s=n(18);t.Events=s.Events;var c=n(9);t.CallEvents=c.CallEvents;var l=n(58);t.EndPoint=l.EndPoint;r(n(29));var u=n(59);t.OperatorACDStatuses=u.OperatorACDStatuses;var d=n(0);t.LogCategory=d.LogCategory;t.LogLevel=d.LogLevel;r(n(13));function f(){return i.Client.getInstance()}t.getInstance=f;t.version=i.Client.getInstance().version;function g(){if(!o.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED");return a.Messaging.Messenger.getInstance()}t.getMessenger=g},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=n(32);var a=n(22);var s=n(17);var c=n(0);var l=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"FF"}}],[{key:"attachStream",value:function e(t,n){if(typeof n.srcObject==="undefined"){n["mozSrcObject"]=t}else{n.srcObject=t}n.load();n.play()}},{key:"detachStream",value:function e(t){if(typeof t.srcObject==="undefined"){t["mozSrcObject"]=null}else{t.srcObject=null}t.load();t.src=""}},{key:"screenSharingSupported",value:function e(){return new Promise(function(e,t){if(window.location.protocol!="https:"){e(false);return}e(true)})}},{key:"getScreenMedia",value:function e(){var t={audio:false,video:{mediaSource:"window"||"screen"}};c.LogManager.get().writeMessage(c.LogCategory.USERMEDIA,"[constraints]",c.LogLevel.TRACE,JSON.stringify(t));return navigator.mediaDevices.getUserMedia(t)}},{key:"getRTCStats",value:function e(t){return new Promise(function(e,n){t.getStats(null).then(function(t){var n=[];t.forEach(function(e){if(e.type=="inboundrtp"||e.type=="outboundrtp")n.push(e)});e(n)}).catch(n)})}},{key:"getUserMedia",value:function e(t){return new Promise(function(e,n){var r=new MediaStream;var i=a.MediaCache.get();var s=[];new Promise(function(e,n){var r=[];if(typeof t.audio!=="undefined"&&t.audio!==false){var a=o.Md5.hashStr(JSON.stringify(t.audio));i.getTrack(a,"audio").then(function(n){if(typeof n!=="undefined"&&n.readyState!=="ended"){r.push(n);e(r)}else{var o=JSON.parse(JSON.stringify(t));o.video=false;c.LogManager.get().writeMessage(c.LogCategory.USERMEDIA,"[constraints]",c.LogLevel.TRACE,JSON.stringify(o));navigator.mediaDevices.getUserMedia(o).then(function(t){var n=true;var o=false;var s=undefined;try{for(var c=t.getTracks()[Symbol.iterator](),l;!(n=(l=c.next()).done);n=true){var u=l.value;i.setTrack(a,"audio",u);r.push(u)}}catch(e){o=true;s=e}finally{try{if(!n&&c.return){c.return()}}finally{if(o){throw s}}}e(r)}).catch(function(t){e([])})}})}else{e([])}}).then(function(e){return new Promise(function(n,r){if(typeof t.video!=="undefined"&&t.video!==false){var a=o.Md5.hashStr(JSON.stringify(t.video));s.push(new Promise(function(r,o){i.getTrack(a,"video").then(function(r){if(typeof r!=="undefined"&&r.readyState!=="ended"){e.push(r);n(e)}else{var o=JSON.parse(JSON.stringify(t));o.audio=false;c.LogManager.get().writeMessage(c.LogCategory.USERMEDIA,"[constraints]",c.LogLevel.TRACE,JSON.stringify(o));navigator.mediaDevices.getUserMedia(o).then(function(t){var r=true;var o=false;var s=undefined;try{for(var c=t.getTracks()[Symbol.iterator](),l;!(r=(l=c.next()).done);r=true){var u=l.value;i.setTrack(a,"video",u);e.push(u);n(e)}}catch(e){o=true;s=e}finally{try{if(!r&&c.return){c.return()}}finally{if(o){throw s}}}}).catch(function(t){n(e)})}})}))}else{n(e)}})}).then(function(t){var i=true;var o=false;var a=undefined;try{for(var s=t[Symbol.iterator](),c;!(i=(c=s.next()).done);i=true){var l=c.value;if(typeof l!=="undefined")r.addTrack(l)}}catch(e){o=true;a=e}finally{try{if(!i&&s.return){s.return()}}finally{if(o){throw a}}}if(t.length>0)e(r);else n()}).catch(function(e){n(e)})})}},{key:"getDTMFSender",value:function e(t,n){var r=/Firefox\/([0-9\.]+)(?:\s|$)/;var i=navigator.userAgent;if(r.test(i)){var o=r.exec(i);var a=o[1].split(".");if(+a[0]>=53){var c=t.getSenders().map(function(e){if(e.track.kind==="audio"&&!!e.dtmf)return e.dtmf});if(c.length>0)return c[0]}}return new s.SignalingDTMFSender(n)}}]);return e}();t.FF=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(){this._state=new Int32Array(4);this._buffer=new ArrayBuffer(68);this._buffer8=new Uint8Array(this._buffer,0,68);this._buffer32=new Uint32Array(this._buffer,0,17);this.start()}e.hashStr=function(e,t){if(t===void 0){t=false}return this.onePassHasher.start().appendStr(e).end(t)};e.hashAsciiStr=function(e,t){if(t===void 0){t=false}return this.onePassHasher.start().appendAsciiStr(e).end(t)};e._hex=function(t){var n=e.hexChars;var r=e.hexOut;var i;var o;var a;var s;for(s=0;s<4;s+=1){o=s*8;i=t[s];for(a=0;a<8;a+=2){r[o+1+a]=n.charAt(i&15);i>>>=4;r[o+0+a]=n.charAt(i&15);i>>>=4}}return r.join("")};e._md5cycle=function(e,t){var n=e[0];var r=e[1];var i=e[2];var o=e[3];n+=(r&i|~r&o)+t[0]-680876936|0;n=(n<<7|n>>>25)+r|0;o+=(n&r|~n&i)+t[1]-389564586|0;o=(o<<12|o>>>20)+n|0;i+=(o&n|~o&r)+t[2]+606105819|0;i=(i<<17|i>>>15)+o|0;r+=(i&o|~i&n)+t[3]-1044525330|0;r=(r<<22|r>>>10)+i|0;n+=(r&i|~r&o)+t[4]-176418897|0;n=(n<<7|n>>>25)+r|0;o+=(n&r|~n&i)+t[5]+1200080426|0;o=(o<<12|o>>>20)+n|0;i+=(o&n|~o&r)+t[6]-1473231341|0;i=(i<<17|i>>>15)+o|0;r+=(i&o|~i&n)+t[7]-45705983|0;r=(r<<22|r>>>10)+i|0;n+=(r&i|~r&o)+t[8]+1770035416|0;n=(n<<7|n>>>25)+r|0;o+=(n&r|~n&i)+t[9]-1958414417|0;o=(o<<12|o>>>20)+n|0;i+=(o&n|~o&r)+t[10]-42063|0;i=(i<<17|i>>>15)+o|0;r+=(i&o|~i&n)+t[11]-1990404162|0;r=(r<<22|r>>>10)+i|0;n+=(r&i|~r&o)+t[12]+1804603682|0;n=(n<<7|n>>>25)+r|0;o+=(n&r|~n&i)+t[13]-40341101|0;o=(o<<12|o>>>20)+n|0;i+=(o&n|~o&r)+t[14]-1502002290|0;i=(i<<17|i>>>15)+o|0;r+=(i&o|~i&n)+t[15]+1236535329|0;r=(r<<22|r>>>10)+i|0;n+=(r&o|i&~o)+t[1]-165796510|0;n=(n<<5|n>>>27)+r|0;o+=(n&i|r&~i)+t[6]-1069501632|0;o=(o<<9|o>>>23)+n|0;i+=(o&r|n&~r)+t[11]+643717713|0;i=(i<<14|i>>>18)+o|0;r+=(i&n|o&~n)+t[0]-373897302|0;r=(r<<20|r>>>12)+i|0;n+=(r&o|i&~o)+t[5]-701558691|0;n=(n<<5|n>>>27)+r|0;o+=(n&i|r&~i)+t[10]+38016083|0;o=(o<<9|o>>>23)+n|0;i+=(o&r|n&~r)+t[15]-660478335|0;i=(i<<14|i>>>18)+o|0;r+=(i&n|o&~n)+t[4]-405537848|0;r=(r<<20|r>>>12)+i|0;n+=(r&o|i&~o)+t[9]+568446438|0;n=(n<<5|n>>>27)+r|0;o+=(n&i|r&~i)+t[14]-1019803690|0;o=(o<<9|o>>>23)+n|0;i+=(o&r|n&~r)+t[3]-187363961|0;i=(i<<14|i>>>18)+o|0;r+=(i&n|o&~n)+t[8]+1163531501|0;r=(r<<20|r>>>12)+i|0;n+=(r&o|i&~o)+t[13]-1444681467|0;n=(n<<5|n>>>27)+r|0;o+=(n&i|r&~i)+t[2]-51403784|0;o=(o<<9|o>>>23)+n|0;i+=(o&r|n&~r)+t[7]+1735328473|0;i=(i<<14|i>>>18)+o|0;r+=(i&n|o&~n)+t[12]-1926607734|0;r=(r<<20|r>>>12)+i|0;n+=(r^i^o)+t[5]-378558|0;n=(n<<4|n>>>28)+r|0;o+=(n^r^i)+t[8]-2022574463|0;o=(o<<11|o>>>21)+n|0;i+=(o^n^r)+t[11]+1839030562|0;i=(i<<16|i>>>16)+o|0;r+=(i^o^n)+t[14]-35309556|0;r=(r<<23|r>>>9)+i|0;n+=(r^i^o)+t[1]-1530992060|0;n=(n<<4|n>>>28)+r|0;o+=(n^r^i)+t[4]+1272893353|0;o=(o<<11|o>>>21)+n|0;i+=(o^n^r)+t[7]-155497632|0;i=(i<<16|i>>>16)+o|0;r+=(i^o^n)+t[10]-1094730640|0;r=(r<<23|r>>>9)+i|0;n+=(r^i^o)+t[13]+681279174|0;n=(n<<4|n>>>28)+r|0;o+=(n^r^i)+t[0]-358537222|0;o=(o<<11|o>>>21)+n|0;i+=(o^n^r)+t[3]-722521979|0;i=(i<<16|i>>>16)+o|0;r+=(i^o^n)+t[6]+76029189|0;r=(r<<23|r>>>9)+i|0;n+=(r^i^o)+t[9]-640364487|0;n=(n<<4|n>>>28)+r|0;o+=(n^r^i)+t[12]-421815835|0;o=(o<<11|o>>>21)+n|0;i+=(o^n^r)+t[15]+530742520|0;i=(i<<16|i>>>16)+o|0;r+=(i^o^n)+t[2]-995338651|0;r=(r<<23|r>>>9)+i|0;n+=(i^(r|~o))+t[0]-198630844|0;n=(n<<6|n>>>26)+r|0;o+=(r^(n|~i))+t[7]+1126891415|0;o=(o<<10|o>>>22)+n|0;i+=(n^(o|~r))+t[14]-1416354905|0;i=(i<<15|i>>>17)+o|0;r+=(o^(i|~n))+t[5]-57434055|0;r=(r<<21|r>>>11)+i|0;n+=(i^(r|~o))+t[12]+1700485571|0;n=(n<<6|n>>>26)+r|0;o+=(r^(n|~i))+t[3]-1894986606|0;o=(o<<10|o>>>22)+n|0;i+=(n^(o|~r))+t[10]-1051523|0;i=(i<<15|i>>>17)+o|0;r+=(o^(i|~n))+t[1]-2054922799|0;r=(r<<21|r>>>11)+i|0;n+=(i^(r|~o))+t[8]+1873313359|0;n=(n<<6|n>>>26)+r|0;o+=(r^(n|~i))+t[15]-30611744|0;o=(o<<10|o>>>22)+n|0;i+=(n^(o|~r))+t[6]-1560198380|0;i=(i<<15|i>>>17)+o|0;r+=(o^(i|~n))+t[13]+1309151649|0;r=(r<<21|r>>>11)+i|0;n+=(i^(r|~o))+t[4]-145523070|0;n=(n<<6|n>>>26)+r|0;o+=(r^(n|~i))+t[11]-1120210379|0;o=(o<<10|o>>>22)+n|0;i+=(n^(o|~r))+t[2]+718787259|0;i=(i<<15|i>>>17)+o|0;r+=(o^(i|~n))+t[9]-343485551|0;r=(r<<21|r>>>11)+i|0;e[0]=n+e[0]|0;e[1]=r+e[1]|0;e[2]=i+e[2]|0;e[3]=o+e[3]|0};e.prototype.start=function(){this._dataLength=0;this._bufferLength=0;this._state.set(e.stateIdentity);return this};e.prototype.appendStr=function(t){var n=this._buffer8;var r=this._buffer32;var i=this._bufferLength;var o;var a;for(a=0;a<t.length;a+=1){o=t.charCodeAt(a);if(o<128){n[i++]=o}else if(o<2048){n[i++]=(o>>>6)+192;n[i++]=o&63|128}else if(o<55296||o>56319){n[i++]=(o>>>12)+224;n[i++]=o>>>6&63|128;n[i++]=o&63|128}else{o=(o-55296)*1024+(t.charCodeAt(++a)-56320)+65536;if(o>1114111){throw new Error("Unicode standard supports code points up to U+10FFFF")}n[i++]=(o>>>18)+240;n[i++]=o>>>12&63|128;n[i++]=o>>>6&63|128;n[i++]=o&63|128}if(i>=64){this._dataLength+=64;e._md5cycle(this._state,r);i-=64;r[0]=r[16]}}this._bufferLength=i;return this};e.prototype.appendAsciiStr=function(t){var n=this._buffer8;var r=this._buffer32;var i=this._bufferLength;var o;var a=0;for(;;){o=Math.min(t.length-a,64-i);while(o--){n[i++]=t.charCodeAt(a++)}if(i<64){break}this._dataLength+=64;e._md5cycle(this._state,r);i=0}this._bufferLength=i;return this};e.prototype.appendByteArray=function(t){var n=this._buffer8;var r=this._buffer32;var i=this._bufferLength;var o;var a=0;for(;;){o=Math.min(t.length-a,64-i);while(o--){n[i++]=t[a++]}if(i<64){break}this._dataLength+=64;e._md5cycle(this._state,r);i=0}this._bufferLength=i;return this};e.prototype.getState=function(){var e=this;var t=e._state;return{buffer:String.fromCharCode.apply(null,e._buffer8),buflen:e._bufferLength,length:e._dataLength,state:[t[0],t[1],t[2],t[3]]}};e.prototype.setState=function(e){var t=e.buffer;var n=e.state;var r=this._state;var i;this._dataLength=e.length;this._bufferLength=e.buflen;r[0]=n[0];r[1]=n[1];r[2]=n[2];r[3]=n[3];for(i=0;i<t.length;i+=1){this._buffer8[i]=t.charCodeAt(i)}};e.prototype.end=function(t){if(t===void 0){t=false}var n=this._bufferLength;var r=this._buffer8;var i=this._buffer32;var o=(n>>2)+1;var a;this._dataLength+=n;r[n]=128;r[n+1]=r[n+2]=r[n+3]=0;i.set(e.buffer32Identity.subarray(o),o);if(n>55){e._md5cycle(this._state,i);i.set(e.buffer32Identity)}a=this._dataLength*8;if(a<=4294967295){i[14]=a}else{var s=a.toString(16).match(/(.*?)(.{0,8})$/);if(s===null){return}var c=parseInt(s[2],16);var l=parseInt(s[1],16)||0;i[14]=c;i[15]=l}e._md5cycle(this._state,i);return t?this._state:e._hex(this._state)};e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);e.hexChars="0123456789abcdef";e.hexOut=[];e.onePassHasher=new e;return e}();t.Md5=r;if(r.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592"){console.error("Md5 self test failed.")}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=function(){function e(){i(this,e)}r(e,[{key:"clone",value:function t(){var n=new e;n.videoInputId=this.videoInputId;n.audioInputId=this.audioInputId;n.audioEnabled=this.audioEnabled;n.videoEnabled=this.videoEnabled;n.videoSettings=this.videoSettings;return n}},{key:"setVideoSettings",value:function e(t){this.videoSettings=t;if(typeof t.deviceId!="undefined")this.videoInputId=t.deviceId}},{key:"_traceName",value:function e(){return"MediaCaptureConfig"}}]);return e}();t.MediaCaptureConfig=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=n(5);var a=n(0);var s=function(){function e(t){i(this,e);this.kind=t;this.inUse=false;this.track=null;this.callId=null}r(e,[{key:"attach",value:function e(t,n){o.default.attachMedia(new MediaStream([t]),this.element);this.direction=n}},{key:"free",value:function e(){o.default.detachMedia(this.element);this.inUse=false;this.track=null;this.callId=null}}]);return e}();t.ReusableStructure=s;var c=function(){r(e,null,[{key:"get",value:function t(){if(!this.inst)this.inst=new e;return this.inst}}]);function e(){i(this,e);this.elementList=new Array;this.log=a.LogManager.get().createLogger(a.LogCategory.RTC,"Renderer")}r(e,[{key:"getFreeElements",value:function e(t){return this.elementList.filter(function(e){if(e.inUse&&(t=="all"||t==e.kind))return true})}},{key:"catchRender",value:function e(t,n,r){var i=this.getFreeElements(t.kind);var o=void 0;if(i.length){o=i[0]}else{o=new s(t.kind);this.elementList.push(o)}o.inUse=true;o.track=t;o.callId=n;o.attach(t,r);return o.element}},{key:"catchRenders",value:function e(t,n,r){var i=t.getTracks();var o=[];for(var a=0;a<i.length;a++){o.push(this.catchRender(i[a],n,r))}return o}},{key:"freeRendersByCallId",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"all";this.elementList.map(function(e){if(e.callId==t&&(n=="all"||n==e.direction))e.free()})}},{key:"freeRenderByTrack",value:function e(t){this.elementList.map(function(e){if(e.track.id==t.id)e.free()})}},{key:"getRendererByCallId",value:function e(t){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"all";this.elementList.filter(function(e){if(e.callId==t&&(n=="all"||n==e.direction))return true})}},{key:"_traceName",value:function e(){return"ReusableStructure"}}]);return e}();t.ReusableRenderer=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":o(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a}return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var u=n(14);var d=n(1);var f=n(6);var g=n(0);var p=n(2);var v=function(e){c(t,e);function t(e,n,r,i){a(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r,i));o.settings.mode=u.CallMode.SERVER;return o}r(t,[{key:"answer",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,n,r);var o={tracks:this.peerConnection.getTrackKind()};d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,this.settings.id,f.CallManager.cleanHeaders(r),o)}},{key:"_traceName",value:function e(){return"CallExServer"}}]);return t}(u.Call);l([g.LogManager.d_trace(g.LogCategory.CALLEXSERVER)],v.prototype,"answer",null);t.CallExServer=v},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":o(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a}return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var u=n(14);var d=n(1);var f=n(0);var g=n(4);var p=n(2);var v=n(11);var h=function(e){c(t,e);function t(){a(this,t);return s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}r(t,[{key:"answer",value:function e(n,r,o){var a=this;i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,n,r);if(typeof n!="undefined"){if(typeof r=="undefined")r={};r[v.Constants.CALL_DATA_HEADER]=n}var s=g.UserMediaManager.get();if(typeof o=="undefined")s.attachTo(this._peerConnection);else if(!o.sendVideo){s.attachToSound(this._peerConnection)}else{s.attachTo(this._peerConnection)}this._peerConnection.getLocalAnswer().then(function(e){d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,a.id(),r,e.sdp)})}},{key:"_traceName",value:function e(){return"CallExP2P"}}]);return t}(u.Call);l([f.LogManager.d_trace(f.LogCategory.CALLEXP2P)],h.prototype,"answer",null);t.CallExP2P=h},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};var o=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function c(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=undefined&&undefined.__decorate||function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":o(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(i<3?s(a):i>3?s(t,n,a):s(t,n))||a}return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var u=n(14);var d=n(1);var f=n(0);var g=n(4);var p=n(2);var v=n(11);var h=n(3);var y=n(13);var m=n(9);var C=function(e){c(t,e);function t(){a(this,t);return s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}r(t,[{key:"answer",value:function e(n,r,a){var s=this;i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,n,r);if(typeof n!="undefined"){if(typeof r=="undefined"||(typeof r==="undefined"?"undefined":o(r))!=="object")r={};r[v.Constants.CALL_DATA_HEADER]=n}var c=h.Client.getInstance().config();if(c.experiments&&c.experiments.hardware){return new Promise(function(e,t){if((typeof a==="undefined"?"undefined":o(a))==="object")s.settings.videoDirections=a;y.default.StreamManager.get().getCallStream(s).then(function(t){s._peerConnection.bindLocalMedia(t);s._peerConnection.getLocalAnswer().then(function(t){var n={tracks:s.peerConnection.getTrackKind()};d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,s.id(),r,t.sdp,n);e()})}).catch(function(e){return t(e)})})}else{var l=g.UserMediaManager.get();if(typeof a=="undefined")l.attachTo(this._peerConnection);else if(!a.sendVideo){this._peerConnection.setVideoFlags(a);this.settings.videoDirections=a;l.attachToSound(this._peerConnection)}else{this._peerConnection.setVideoFlags(a);this.settings.videoDirections=a;l.attachTo(this._peerConnection)}this._peerConnection.getLocalAnswer().then(function(e){var t={tracks:s.peerConnection.getTrackKind()};d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,s.id(),r,e.sdp,t)})}}},{key:"setActive",value:function e(t){var n=this;if(t===this.settings.active){return new Promise(function(e,t){t({name:m.CallEvents["Updated"],result:false,call:n})})}this.settings.active=t;return this.peerConnection.hold(!t)}},{key:"_traceName",value:function e(){return"CallExMedia"}}]);return t}(u.Call);l([f.LogManager.d_trace(f.LogCategory.CALL)],C.prototype,"answer",null);l([f.LogManager.d_trace(f.LogCategory.CALL)],C.prototype,"setActive",null);t.CallExMedia=C},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=function(){function e(){o(this,e)}r(e,[{key:"_traceName",value:function e(){return"CodecSorterHelpers"}}],[{key:"H264Sorter",value:function e(t,n){if(!n)return new Promise(function(e){for(var n=0;n<t.sections.length;n++){if(t.sections[n].kind.toLowerCase()=="video"){t.sections[n].codec.sort(function(e,t){if(e.toLowerCase().indexOf("h264")!=-1&&e.toLowerCase().indexOf("uc")==-1)return-1;if(t.toLowerCase().indexOf("h264")!=-1&&t.toLowerCase().indexOf("uc")==-1)return 1;return 0})}}e(t)});else return new Promise(function(e){for(var n=0;n<t.sections.length;n++){if(t.sections[n].kind.toLowerCase()=="video"){var r=t.sections[n].codec.filter(function(e){return e.toLowerCase().indexOf("h264")!=-1&&e.toLowerCase().indexOf("uc")==-1});if(r.length)t.sections[n].codec=r}}e(t)})}},{key:"VP8Sorter",value:function e(t,n){return new Promise(function(e,n){for(var r=0;r<t.sections.length;r++){if(t.sections[r].kind.toLowerCase()=="video"){t.sections[r].codec.sort(function(e,t){if(e.toLowerCase().indexOf("vp8")!=-1)return-1;if(t.toLowerCase().indexOf("vp8")!=-1)return 1;return 0})}}e(t)})}}]);return e}();a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"H264Sorter",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"VP8Sorter",null);t.CodecSorterHelpers=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=n(17);var a=n(3);var s=n(0);var c=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"Webkit"}}],[{key:"attachStream",value:function e(t,n){try{if(typeof n.srcObject!=="undefined")n.srcObject=t;else n.src=URL.createObjectURL(t);n.load();if(n instanceof HTMLVideoElement)n.play().catch(function(e){});else{n.play();var r=a.Client.getInstance()._defaultSinkId;if(r!=null)n.setSinkId(r)}}catch(e){s.LogManager.get().writeMessage(s.LogCategory.USERMEDIA,"Webkit: ",s.LogLevel.WARNING,JSON.stringify(e))}}},{key:"detachStream",value:function e(t){if(t instanceof HTMLVideoElement){var n=t.pause();if(typeof n!=="undefined")n.catch(function(e){})}else t.pause();t.src=""}},{key:"getDTMFSender",value:function e(t,n){if(!!t.createDTMFSender){var r=[];t.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){r.push(e)})});if(r.length){return t.createDTMFSender(r[0])}}else return new o.SignalingDTMFSender(n)}},{key:"getUserMedia",value:function e(t){return navigator.mediaDevices.getUserMedia(t)}},{key:"screenSharingSupported",value:function e(){return new Promise(function(e,t){window.postMessage("VoximplantWebsdkCheckExtension","*");var n=function t(n){if(n.origin===window.location.origin||n.data==="VoximplantWebsdkExtensionLoaded"){window.removeEventListener("message",t);clearTimeout(r);e(true)}};var r=setTimeout(function(){window.removeEventListener("message",n);e(false)},800);window.addEventListener("message",n)})}},{key:"getScreenMedia",value:function e(){return new Promise(function(e,t){window.postMessage("voximplantWebsdkGetSourceId","*");var n=function n(r){if(!r.data||r.origin!==window.location.origin)return;if(!r.data.result)return;if(r.data.result==="err")return t(new Error(r.data.reason));if(r.data.result==="ok"&&typeof r.data.sourceId!=="undefined"){window.removeEventListener("message",n);var i={audio:false,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:r.data.sourceId},optional:[{googTemporalLayeredScreencast:true}]}};s.LogManager.get().writeMessage(s.LogCategory.USERMEDIA,"[constraints]",s.LogLevel.TRACE,JSON.stringify(i));navigator.mediaDevices.getUserMedia(i).then(e,t)}};window.addEventListener("message",n)})}},{key:"getRTCStats",value:function e(t){return new Promise(function(e,n){var r=[];t.getStats(null).then(function(t){t.forEach(function(e){if(e.type=="outbound-rtp"||e.type=="inbound-rtp"){r.push(e)}});e(r);return}).catch(n)})}}]);return e}();t.Webkit=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var c=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var l=n(19);var u=n(5);var d=n(4);var f=n(20);var g=n(8);var p=n(0);var v=n(1);var h=n(6);var y=n(2);var m=n(41);var C=n(9);var _=n(16);var S=n(11);var L=n(24);var E=n(3);var M=n(23);var R=n(13);var T;(function(e){e[e["offer"]="offer"]="offer";e[e["answer"]="answer"]="answer";e[e["pranswer"]="pranswer"]="pranswer";e[e["rollback"]="rollback"]="rollback"})(T||(T={}));var b;(function(e){e[e["controlling"]="controlling"]="controlling";e[e["controlled"]="controlled"]="controlled"})(b||(b={}));var k=function(e){s(t,e);function t(e,n,r){o(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));i.iceTimer=null;i.needTransportRestart=true;i.ICE_TIMEOUT=2e4;i.RENEGOTIATION_TIMEOUT=15e3;i._canReInvite=function(){return i.impl.iceConnectionState==="connected"||i.impl.iceConnectionState==="completed"};var s=g.PCFactory.get().iceConfig;var c=s;if(typeof c==="undefined"||c===null){c={gatherPolicy:"all",iceServers:[]}}c.bundlePolicy="max-compat";i.impl=new RTCPeerConnection(c);if(typeof i.impl.ontrack!=="undefined"){i.impl.ontrack=function(e){return i.onAddTrack(e)}}else if(typeof i.impl.onaddtrack!=="undefined"){i.impl.onaddtrack=function(e){return i.onAddTrack(e)}}else{i.impl.onaddstream=function(e){return i.onAddStream(e)}}i.impl.onicecandidate=function(e){i.onICECandidate(e["candidate"])};i.impl.oniceconnectionstatechange=function(e){if(i.impl.iceConnectionState==="completed"||i.impl.iceConnectionState==="connected"){i.iceTimer&&clearTimeout(i.iceTimer);i.iceTimer=null;if(i.reInviteQ)i.reInviteQ.runNext()}};i.rtpSenders=[];i.renegotiationInProgress=false;i.impl.onnegotiationneeded=function(e){return i.onRenegotiation()};i.impl.onsignalingstatechange=function(e){return i.onSignalingStateChange()};i.impl.oniceconnectionstatechange=function(e){return i.onConnectionChange()};i.iceRole=b.controlling;i._remoteStreams=[];i.banReinviteAnswer=false;i._call=h.CallManager.get().calls[i.id];if(typeof i._call!="undefined")i.onHold=!i._call.active();else i.onHold=false;i.rtcCollectingCycle=setInterval(function(){i.getPCStats()},h.CallManager.get().rtcStatsCollectionInterval);if(typeof i._call!=="undefined"){var l=i._call.headers()[S.Constants.CALLSTATSIOID_HEADER];if(typeof l==="undefined")l=i._call.id();_.CallstatsIo.get().addNewFabric(i.impl,i._call.number(),r?_.CallstatsIoFabricUsage.multiplex:_.CallstatsIoFabricUsage.audio,l)}i.needTransportRestart=false;if(e!=="_default"&&h.CallManager.get().calls[e])i.reInviteQ=new M.ReInviteQ(h.CallManager.get().calls[e],i._canReInvite);return i}r(t,[{key:"onSignalingStateChange",value:function e(){this.log.info("Signal state changed to "+this.impl.signalingState+" for PC:"+this.id);if(this.impl.signalingState==="stable"){}}},{key:"getPCStats",value:function e(){var t=this;u.default.getRTCStats(this.impl).then(function(e){if(typeof t._call!=="undefined")t._call.dispatchEvent({name:"RTCStatsReceived",stats:e})})}},{key:"onConnectionChange",value:function e(){if(this.impl.iceConnectionState==="completed"){if(typeof this._call!=="undefined"){this._call.dispatchEvent({name:"ICECompleted",call:this._call})}}if(this.impl.iceConnectionState==="completed"||this.impl.iceConnectionState==="connected"){this.iceTimer&&clearTimeout(this.iceTimer);this.iceTimer=null;if(this.reInviteQ)this.reInviteQ.runNext()}}},{key:"onRenegotiation",value:function e(){var t=this;if(typeof this.impl==="undefined")return;if(this.impl.connectionState==="disconnected"||this.impl.connectionState==="failed"){this.log.info("Renegotiation requested on closed PeerConnection");return}if(this.impl.localDescription===null){this.log.info("Renegotiation needed, but no local SD, skipping");return}if(this.impl.iceConnectionState!=="connected"&&this.impl.iceConnectionState!=="completed"){this.log.info("Renegotiation requested while ice state is "+this.impl.iceConnectionState+". Postponing");setTimeout(this.onRenegotiation,100);return}if(this.renegotiationInProgress){this.log.info("Renegotiation in progress. Queueing");return}else{this.log.info("Renegotiation started")}if(this.renegotiationInProgress===false){this.renegotiationInProgress=true;var n=this.getReceiveOptions();this.updateHoldState();this.impl.createOffer(n).then(function(e){return t.codecRearrange(e)}).then(function(e){var n={type:e.type,sdp:e.sdp};n=g.PCFactory.get().addBandwidthParams(n);n=L.SDPMuggle.removeTelephoneEvents(n);n=L.SDPMuggle.removeDoubleOpus(n);n=L.SDPMuggle.fixVideoRecieve(n,t.videoEnabled.receiveVideo);return n}).then(function(e){t.srcLocalSDP=e.sdp;t.pendingOffer=e;return e}).then(function(){var e={tracks:t._getTrackKind()};v.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.reInvite,t._call.id(),{},t.pendingOffer.sdp,e)}).catch(function(e){t.log.error("Error when renegatiation start "+e.message)})}else{this.log.error("Another renegatiation in progress")}}},{key:"getReceiveOptions",value:function e(){return{offerToReceiveAudio:!this.onHold?1:0,offerToReceiveVideo:this.videoEnabled.receiveVideo&&!this.onHold?1:0}}},{key:"updateHoldState",value:function e(){var t=this;this.impl.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.enabled=!t.onHold})});this.impl.getRemoteStreams().forEach(function(e){e.getTracks().forEach(function(e){e.enabled=!t.onHold})})}},{key:"onICECandidate",value:function e(t){if(t&&t!==null){this.sendLocalCandidateToPeer("a="+t.candidate,t.sdpMLineIndex)}else{this.log.info("End of candidates")}}},{key:"onAddTrack",value:function e(t){var n=t.track.kind;var r=new MediaStream([t.track]);var i=this.renderStream(r,n);if(n==="video"&&typeof this.videoRendered==="undefined")this.videoRendered=i;else if(typeof this.audioRendered==="undefined")this.audioRendered=i;this.updateHoldState();this._remoteStreams.push(r);this.renderers.push(i);this.mapRenderer(r,i)}},{key:"onAddStream",value:function e(t){var n=d.UserMediaManager.getVideoTracks(t.stream).length?"video":"audio";var r=this.renderStream(t.stream,n);if(n==="video"&&typeof this.videoRendered==="undefined")this.videoRendered=r;else if(typeof this.audioRendered==="undefined")this.audioRendered=r;this.updateHoldState();this._remoteStreams.push(t.stream);this.renderers.push(r);this.mapRenderer(t.stream,r)}},{key:"mapRenderer",value:function e(t,n){var r=this;t.getTracks().forEach(function(e){e.onended=function(){r.checkStreamActive(t,n)}})}},{key:"checkStreamActive",value:function e(t,n){if(!t.getTracks().some(function(e){return e.readyState==="live"})){if(this._call)this._call.dispatchEvent({name:C.CallEvents.MediaElementRemoved,call:this._call,elementId:n.id,type:t.getVideoTracks().length?"video":"audio"});f.Renderer.get().releaseElement(n)}}},{key:"renderStream",value:function e(t,n){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var i=document.body;var o=t.getTracks();var a=E.Client.getInstance().remoteVideoContainerId;if(r){a=E.Client.getInstance().localVideoContainerId}if((n==="video"||n==="sharing")&&typeof a!=="undefined")i=document.getElementById(a);var s=f.Renderer.get().getElement(o[0].id,n==="video"||n==="sharing",i);if(t.oninactive)t.oninactive(function(){u.default.detachMedia(s)});if(typeof this.sinkId!=="undefined"){s.setSinkId(this.sinkId)}u.default.attachMedia(t,s);if(typeof this._call!=="undefined"&&!r){this._call.dispatchEvent({name:C.CallEvents.MediaElementCreated,call:this._call,stream:t,element:s,type:n})}else if(r){this._call.dispatchEvent({name:C.CallEvents.LocalVideoStreamAdded,stream:t,element:s,type:n})}return s}},{key:"checkMediaAttached",value:function e(t){return this._remoteStreams.length>0&&this._remoteStreams.reduce(function(e,n){if(t==="audio")return e&&n.getAudioTracks().length>0;else if(t==="video")return e&&n.getVideoTracks().length>0;else return e},true)}},{key:"wireRemoteStream",value:function e(t){return new Promise(function(e,t){t(new Error("Not implemented"))})}},{key:"_processRemoteAnswer",value:function e(t,n){var r=this;this.iceTimer=setTimeout(function(){r._call.notifyICETimeout()},this.ICE_TIMEOUT);this.pendingEvent=[t,n];if(this.impl.remoteDescription!==null)if(this.impl.remoteDescription.sdp!="")return;var i={sdp:n,type:T.answer};this.srcRemoteSDP=n;i=L.SDPMuggle.removeTIAS(i);return this.impl.setRemoteDescription(i)}},{key:"_getLocalOffer",value:function e(){var t=this;this.iceRole=b.controlling;return new Promise(function(e,n){var r=t.getReceiveOptions();t.impl.createOffer(r).then(function(e){var n={type:e.type,sdp:e.sdp};n=g.PCFactory.get().addBandwidthParams(n);return t.codecRearrange(n)}).then(function(e){t.srcLocalSDP=e.sdp;return t.impl.setLocalDescription(e)}).then(function(){e(t.impl.localDescription)}).catch(function(e){n(e)})})}},{key:"_getLocalAnswer",value:function e(){var t=this;this.iceRole=b.controlled;return new Promise(function(e,n){var r={mandatory:t.getReceiveOptions()};t.impl.createAnswer(r).then(function(e){var n={type:e.type,sdp:e.sdp};n=g.PCFactory.get().addBandwidthParams(n);n=L.SDPMuggle.fixVideoRecieve(n,t.videoEnabled.receiveVideo);return t.codecRearrange(n)}).then(function(e){t.srcLocalSDP=e.sdp;return t.impl.setLocalDescription(e)}).then(function(){e({type:T.answer,sdp:t.impl.localDescription.sdp})}).catch(function(e){n(e)})})}},{key:"_setRemoteDescription",value:function e(t){var n=new RTCSessionDescription({sdp:t,type:T.offer});n=L.SDPMuggle.removeTIAS(n);this.srcRemoteSDP=t;return this.impl.setRemoteDescription(n)}},{key:"_processRemoteOffer",value:function e(t){var n=this;this.iceRole=b.controlled;return new Promise(function(e,r){var i=new RTCSessionDescription({sdp:t,type:T.offer});n.srcRemoteSDP=t;i=L.SDPMuggle.removeTIAS(i);n.impl.setRemoteDescription(i).then(function(){var e={mandatory:n.getReceiveOptions()};return n.impl.createAnswer(e)}).then(function(e){return n.codecRearrange(e)}).then(function(e){n.srcLocalSDP=e.sdp;return n.impl.setLocalDescription(e)}).then(function(){e(n.impl.localDescription.sdp)}).catch(function(e){r(e)})})}},{key:"_close",value:function e(){var t=this;clearInterval(this.rtcCollectingCycle);this.impl.onnegotiationneeded=null;var n=E.Client.getInstance().config();if(this.impl.removeTrack)this.rtpSenders.forEach(function(e){t.impl.removeTrack(e)});else this.impl.getLocalStreams().forEach(function(e){if(!n.experiments||!n.experiments.hardware){e.getTracks().forEach(function(t){t.stop();e.removeTrack(t)})}t.impl.removeStream(e)});if(n.experiments&&n.experiments.hardware&&typeof this._call!=="undefined"){R.default.StreamManager.get().remCallStream(this._call)}this.impl.close();if(typeof this._call!=="undefined")_.CallstatsIo.get().sendFabricEvent(this.impl,_.CallstatsIoFabricEvent.fabricTerminated,this._call.id());this._localStream=null;this._remoteStreams=null}},{key:"_addRemoteCandidate",value:function e(t,n){var r=this;return new Promise(function(e,i){try{r.impl.addIceCandidate(new RTCIceCandidate({candidate:t.substring(2),sdpMLineIndex:n})).then(function(){e()}).catch(function(){e()})}catch(t){e()}})}},{key:"_bindLocalMedia",value:function e(){var t=this;if(typeof this._localStream!=="undefined"){if(u.default.getWSVendor()==="firefox"){this._localStream.getTracks().forEach(function(e){t.rtpSenders.push(t.impl.addTrack(e,t._localStream))})}else{this.impl.addStream(this._localStream)}if(!!this._call){var n=u.default.getDTMFSender(this.impl,this._call.id());if(n)this.dtmfSender=n}this.updateHoldState()}}},{key:"_addMediaStream",value:function e(t){var n=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(typeof this.shareScreenMedia==="undefined")this.shareScreenMedia=[];if(typeof this.shareScreenMediaTracks==="undefined")this.shareScreenMediaTracks=[];this.shareScreenMedia.push(t);t.getTracks().forEach(function(e){n.shareScreenMediaTracks.push(e.id)});if(u.default.getWSVendor()==="firefox"){t.getTracks().forEach(function(e){var t=new MediaStream([e]);n.rtpSenders.push(n.impl.addTrack(e,t))})}else{this.impl.addStream(t)}if(r){var i=this.renderStream(t,"sharing",true);this.renderers.push(i)}}},{key:"_unbindLocalMegia",value:function e(){var t=this;this.needTransportRestart=true;if(u.default.getWSVendor()==="firefox"){this.rtpSenders.forEach(function(e){if(t.shareScreenMediaTracks){if(t.shareScreenMediaTracks.indexOf(e.track.id)===-1){t.impl.removeTrack(e)}}else{t.impl.removeTrack(e)}})}else{if(this._localStream)this.impl.removeStream(this._localStream)}if(this._localStream)this._localStream.getTracks().forEach(function(e){e.stop();t._localStream.removeTrack(e)});this._localStream=null}},{key:"_handleReinvite",value:function e(t,n){var r=this;return new Promise(function(e,i){if(r.banReinviteAnswer){i(new Error)}if(r.renegotiationInProgress===false){r.renegotiationInProgress=true;var o={sdp:n,type:T.offer};r.srcRemoteSDP=n;o=L.SDPMuggle.removeTIAS(o);r.impl.setRemoteDescription(o).then(function(){var n={mandatory:r.getReceiveOptions()};r.impl.createAnswer(n).then(function(n){var o={type:n.type,sdp:n.sdp};o=L.SDPMuggle.removeDoubleOpus(o);o=L.SDPMuggle.fixVideoRecieve(o,r.videoEnabled.receiveVideo);r.srcLocalSDP=o.sdp;try{r.impl.setLocalDescription(o).then(function(){var n={tracks:r._getTrackKind()};v.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.acceptReInvite,r._call.id(),t,r.impl.localDescription.sdp,n);r.renegotiationInProgress=false;r._call.dispatchEvent({name:C.CallEvents.Updated,result:true,call:r._call});r.updateHoldState();e()})}catch(e){r.renegotiationInProgress=false;i(e)}})})}else if(r.renegotiationInProgress===true){var a={sdp:n,type:T.answer};r.renegotiationInProgress=false;r.srcRemoteSDP=n;a=L.SDPMuggle.removeTIAS(a);r.impl.setLocalDescription(r.pendingOffer).then(function(){try{r.impl.setRemoteDescription(a).then(function(){r._call.dispatchEvent({name:C.CallEvents.Updated,result:true,call:r._call});r.updateHoldState();e()})}catch(e){r._call.dispatchEvent({name:C.CallEvents.Updated,result:false,call:r._call});r.renegotiationInProgress=false;r.log.error(JSON.stringify(e));i(e)}clearTimeout(r.renegotiationTimer)})}else{i(new Error("Universe was broken!"))}})}},{key:"codecRearrange",value:function e(t){var n=this;return new Promise(function(e,r){var i=h.CallManager.get().calls[n.id];if(typeof i!=="undefined"){var o=new m.CodecSorter(t.sdp);var a=o.getUserCodecList();if(typeof i.rearangeCodecs!=="undefined"){i.rearangeCodecs(a,i.settings.incoming).then(function(n){o.setUserCodecList(n);e({type:t.type,sdp:o.getSDP()})},function(e){n.log.error(JSON.stringify(e));r(e)})}else{n.log.info("No sdp transformer registered");o.setUserCodecList(a);e({type:t.type,sdp:o.getSDP()})}}else{e(t)}})}},{key:"_sendDTMF",value:function e(t,n,r){if(typeof this.dtmfSender!=="undefined"){this.dtmfSender.insertDTMF(t,n,r)}}},{key:"_hold",value:function e(t){_.CallstatsIo.get().sendFabricEvent(this.impl,t?_.CallstatsIoFabricEvent.fabricHold:_.CallstatsIoFabricEvent.fabricResume,this._call.id());this.onHold=t;this.onRenegotiation()}},{key:"_getDirections",value:function e(){var t={};t["local"]=L.SDPMuggle.detectDirections(this.impl.localDescription.sdp);t["remote"]=L.SDPMuggle.detectDirections(this.impl.remoteDescription.sdp);return t}},{key:"_getStreamActivity",value:function e(){var t={};t["local"]=this.getMediaActivity(this.impl.getLocalStreams());t["remote"]=this.getMediaActivity(this.impl.getRemoteStreams());return t}},{key:"getMediaActivity",value:function e(t){return t.map(function(e){return e.getTracks().map(function(e){return{id:e.id,kind:e.kind,mutted:e.muted,active:e.enabled,label:e.label}})})}},{key:"_hdnFRSPrep",value:function e(){this.banReinviteAnswer=true}},{key:"_hdnFRS",value:function e(){this.renegotiationInProgress=false;this.onRenegotiation()}},{key:"_getTrackKind",value:function e(){var t=this;var n={};if(i(this.impl.getSenders)){this.impl.getSenders().forEach(function(e){if(e.track){if(e.track.kind!=="video")n[e.track.id]=e.track.kind;else if(t.shareScreenMedia&&t.shareScreenMedia.some(function(t){return t.getTracks().some(function(t){return t.id===e.track.id})}))n[e.track.id]="sharing";else n[e.track.id]="video"}})}else{this.impl.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){if(e.kind!=="video")n[e.id]=e.kind;else if(t.shareScreenMedia&&t.shareScreenMedia.some(function(t){return t.getTracks().some(function(t){return t.id===e.id})}))n[e.id]="sharing";else n[e.id]="video"})})}return n}},{key:"_stopSharing",value:function e(){var t=this;if(typeof this.shareScreenMedia==="undefined")return;if(u.default.getWSVendor()==="firefox"){this.impl.getSenders().forEach(function(e){if(t.shareScreenMediaTracks.indexOf(e.track.id)!==-1)t.impl.removeTrack(e)})}else{this.shareScreenMedia.forEach(function(e){t.impl.removeStream(e)})}this.shareScreenMedia.forEach(function(e){e.getTracks().forEach(function(n){n.stop();e.removeTrack(n);t.renderers.forEach(function(e){if(e.id===n.id){t._call.dispatchEvent({name:C.CallEvents.MediaElementRemoved,call:t._call,elementId:e.id,type:"video"});f.Renderer.get().releaseElement(e)}})})});this.shareScreenMediaTracks=[];this.shareScreenMedia=[]}},{key:"_traceName",value:function e(){return"WebRTCPC"}},{key:"hasLocalAudio",value:function e(){return this.impl.getLocalStreams().some(function(e){if(e.getAudioTracks().length)return true;else return false})}},{key:"hasLocalVideo",value:function e(){var t=this;return this.impl.getLocalStreams().some(function(e){return e.getVideoTracks().some(function(e){if(!t.shareScreenMedia||!t.shareScreenMedia.some(function(t){return t.getTracks().some(function(t){return t.id===e.id})})){return true}else{return false}})})}},{key:"enableVideo",value:function e(t){var n=this;this.impl.getLocalStreams().forEach(function(e){e.getVideoTracks().forEach(function(e){if(!n.shareScreenMedia||!n.shareScreenMedia.some(function(t){return t.getTracks().some(function(t){return t.id===e.id})})){e.enabled=t}})})}}]);return t}(l.PeerConnection);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"onSignalingStateChange",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"getPCStats",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"onConnectionChange",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"onRenegotiation",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"getReceiveOptions",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"updateHoldState",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"onICECandidate",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"onAddTrack",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"onAddStream",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"mapRenderer",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"checkStreamActive",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"renderStream",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"checkMediaAttached",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"wireRemoteStream",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_processRemoteAnswer",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_getLocalOffer",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_getLocalAnswer",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_setRemoteDescription",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_processRemoteOffer",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_close",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_addRemoteCandidate",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_bindLocalMedia",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_unbindLocalMegia",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_handleReinvite",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"codecRearrange",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_sendDTMF",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_hold",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_getStreamActivity",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"getMediaActivity",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_hdnFRSPrep",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_hdnFRS",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_getTrackKind",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"_stopSharing",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"hasLocalAudio",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"hasLocalVideo",null);c([p.LogManager.d_trace(p.LogCategory.RTC)],k.prototype,"enableVideo",null);t.WebRTCPC=k},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=undefined&&undefined.__decorate||function(e,t,n,r){var o=arguments.length,a=o<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,s;if((typeof Reflect==="undefined"?"undefined":i(Reflect))==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--){if(s=e[c])a=(o<3?s(a):o>3?s(t,n,a):s(t,n))||a}return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:true});var s=n(0);var c=function(){function e(t){o(this,e);this.originalSDP=t}r(e,[{key:"getCodecList",value:function t(){this.originalCodecList={prefix:"",sections:[],sufix:""};var n=RegExp.prototype.test.bind(/^([a-z])=(.*)/);var r=e.splitSections(this.originalSDP);this.originalCodecList.prefix=r[0];for(var i=1;i<r.length;i++){var o={kind:"audio",firstLine:"",prefix:"",sufix:"",codec:[]};var a=r[i].split("\na=rtpmap");a=a.map(function(e,t){return(t>0?"a=rtpmap"+e:e).trim()+"\r\n"});o.prefix=a.shift();var s=a.pop();s=s.split(/(\r\n|\r|\n)/).filter(n);var c=true;a.push("");while(c){c=false;if(s.length!==0){var l=s.shift();if(l.indexOf("a=rtpmap")===0||l.indexOf("a=rtcp-fb")===0||l.indexOf("a=fmtp")===0||l.indexOf("a=x-caps")===0||l.indexOf("a=maxptime")===0){a[a.length-1]+=l+"\r\n";c=true}else s.unshift(l)}}for(var u=0;u<a.length;u++){o.codec.push(a[u].split(/(\r\n|\r|\n)/).filter(n))}var d=o.prefix.split(/(\r\n|\r|\n)/).filter(n);o.firstLine=d.shift();var f=o.firstLine.split(" ");f.splice(-1*o.codec.length,o.codec.length);o.kind=f[0].substring(2);o.prefix=d.join("\r\n")+"\r\n";o.firstLine=f.join(" ");if(s.length>0)o.sufix=s.join("\r\n")+"\r\n";this.originalCodecList.sections.push(o)}return this.originalCodecList}},{key:"getUserCodecList",value:function t(){if(typeof this.originalCodecList==="undefined")this.getCodecList();var n={sections:[]};n.sections=this.originalCodecList.sections.filter(function(e){return e.kind==="video"||e.kind==="audio"}).map(function(t,n,r){var i={kind:t.kind,codec:t.codec.map(function(t){return e.codecToUserCodec(t)})};var o=[];var a=true;var s=false;var c=undefined;try{for(var l=i.codec[Symbol.iterator](),u;!(a=(u=l.next()).done);a=true){var d=u.value;if(o.indexOf(d)===-1)o.push(d)}}catch(e){s=true;c=e}finally{try{if(!a&&l.return){l.return()}}finally{if(s){throw c}}}i.codec=o;return i});return n}},{key:"setUserCodecList",value:function t(n){if(typeof this.originalCodecList==="undefined")this.getCodecList();for(var r=0;r<n.sections.length;r++){if(n.sections[r].kind===this.originalCodecList.sections[r].kind){this.originalCodecList.sections[r].codec=e.resortSection(n.sections[r].codec,this.originalCodecList.sections[r].codec)}}}},{key:"getSDP",value:function e(){var t=this.originalCodecList.prefix;for(var n=0;n<this.originalCodecList.sections.length;n++){var r="";var i=[];for(var o=0;o<this.originalCodecList.sections[n].codec.length;o++){i.push(this.originalCodecList.sections[n].codec[o][0].split(" ")[0].substring(9));r+=this.originalCodecList.sections[n].codec[o].join("\r\n")+"\r\n"}t+=this.originalCodecList.sections[n].firstLine+" "+i.join(" ")+"\r\n";t+=this.originalCodecList.sections[n].prefix;t+=r;t+=this.originalCodecList.sections[n].sufix}return t}},{key:"_traceName",value:function e(){return"CodecSorter"}}],[{key:"splitSections",value:function e(t){var n=t.split("\nm=");return n.map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})}},{key:"codecToUserCodec",value:function e(t){var n=t[0].split(" ");n.shift();return n.join(" ")}},{key:"resortSection",value:function t(n,r){var i=[];for(var o=0;o<n.length;o++){for(var a=0;a<r.length;a++){if(n[o]===e.codecToUserCodec(r[a])){i.push(r[a])}}}return i}},{key:"downOpusBandwidth",value:function e(t){return new Promise(function(e,n){var r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);var i=t.sdp.split(/(\r\n|\r|\n)/).filter(r);var o=false;for(var a=0;a<i.length;a++){if(i[a].indexOf("a=fmtp:114")!==-1){i[a]="a=fmtp:114 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000";o=true}if(i[a].indexOf("a=fmtp:111")!==-1){i[a]="a=fmtp:111 minptime=10; useinbandfec=1; sprop-maxcapturerate=8000";o=true}}if(!o){n(t)}t.sdp=i.join("\r\n")+"\r\n";e(t)})}}]);return e}();a([s.LogManager.d_trace(s.LogCategory.RTC)],c.prototype,"getCodecList",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c.prototype,"getUserCodecList",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c.prototype,"setUserCodecList",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c.prototype,"getSDP",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"splitSections",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"codecToUserCodec",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"resortSection",null);a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"downOpusBandwidth",null);t.CodecSorter=c},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"Edge"}}],[{key:"attachStream",value:function e(t,n){n.srcObject=t;n.play()}},{key:"detachStream",value:function e(t){t.pause();t.src=""}},{key:"getScreenMedia",value:function e(){return new Promise(function(e,t){t(new Error("Screen sharing not allowed for you platform"))})}},{key:"getRTCStats",value:function e(t){return new Promise(function(e,t){t(new Error("RTCStats sharing not allowed for you platform"))})}}]);return e}();t.Edge=o},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=n(17);var a=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"Safari"}}],[{key:"attachStream",value:function e(t,n){n.srcObject=t}},{key:"detachStream",value:function e(t){if(t instanceof HTMLVideoElement){var n=t.pause();if(typeof n!="undefined")n.catch(function(e){})}else t.pause();t.src=""}},{key:"getDTMFSender",value:function e(t,n){if(!!t.createDTMFSender)return t.createDTMFSender(t.getLocalStreams()[0].getAudioTracks()[0]);else return new o.SignalingDTMFSender(n)}},{key:"getScreenMedia",value:function e(){return new Promise(function(e,t){window.postMessage("get-sourceId","*");window.addEventListener("message",function(n){if(n.origin==window.location.origin){if(n.data=="PermissionDeniedError"){t(new Error("PermissionDeniedError"))}if(typeof n.data!="string"&&typeof n.data.sourceId!="undefined"){var r={audio:false,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:n.data.sourceId},optional:[{googTemporalLayeredScreencast:true}]}};navigator.mediaDevices.getUserMedia(r).then(function(t){e(t)}).catch(function(e){t(e)})}}})})}},{key:"getRTCStats",value:function e(t){return new Promise(function(e,n){var r=[];t.getStats(null).then(function(t){t.forEach(function(e){if(e.type=="ssrc"){var t={};t.id=e.id;t.type=e.type;t.timestamp=e.timestamp;r.push(t)}});e(r)}).catch(n)})}}]);return e}();t.Safari=a},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=n(18);var a=n(6);var s=n(1);var c=n(2);var l=n(4);var u=n(12);var d=n(10);var f=n(9);var g=function(){function e(t){var n=this;i(this,e);this.client=t;this.currentCall=null;this.onConnectionFailed=null;this.onConnectionEstablished=null;this.onCheckComplete=null;this.onCallFailed=null;this.onCallConnected=null;this.onCallEnded=null;this.onCallRinging=null;this.onCallMediaStarted=null;this.onVoicemail=null;this.onNetStatsReceived=null;a.CallManager.get().protocolVersion=="2";t.on(o.Events.ConnectionFailed,function(e){return n.runLegacyCallback(n.onConnectionFailed,e)});t.on(o.Events.ConnectionEstablished,function(e){return n.runLegacyCallback(n.onConnectionEstablished,e)});s.VoxSignaling.get().setRPCHandler(u.RemoteEvent.handlePreFlightCheckResult,function(e,t,r){return n.onCheckComplete(e,t,r)});s.VoxSignaling.get().setRPCHandler(u.RemoteEvent.handleVoicemail,function(e){return n.runLegacyCallback(n.onVoicemail,e)})}r(e,[{key:"connectTo",value:function e(t,n,r,i){var o=s.VoxSignaling.get();d.Authenticator.get().ziAuthorized(true);o.lagacyConnectTo(t,n,r,i)}},{key:"connect",value:function e(){}},{key:"requestMedia",value:function e(t,n,r,i){var o=l.UserMediaManager.get();o.enableAudio(true);o.queryMedia().then(function(e){l.UserMediaManager.get().updateLocalVideo(e);if(typeof n=="function")n(e)}).catch(function(e){if(typeof r=="function")r(e)})}},{key:"hangupCall",value:function e(t,n){a.CallManager.get().calls[t].hangup(n);s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.disconnectCall,t,{})}},{key:"callTo",value:function e(t,n,r,i){this.currentCall=this.client.call({number:t,video:n,extraHeaders:r,extraParams:i});this.bindCurrentCall();return this.currentCall.id()}},{key:"voicemailPromptFinished",value:function e(t){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.zPromptFinished,t)}},{key:"makeid",value:function e(t){var n="";var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<t;i++){n+=r.charAt(Math.floor(Math.random()*r.length))}return n}},{key:"muteMicrophone",value:function e(t){var n=a.CallManager.get();for(var r in n.calls){if(n.calls.hasOwnProperty(r)){if(t)n.calls[r].muteMicrophone();else n.calls[r].unmuteMicrophone()}}}},{key:"sendDigit",value:function e(t,n){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.sendDTMF,t,n)}},{key:"startPreFlightCheck",value:function e(t,n){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.zStartPreFlightCheck,!!t,!!n)}},{key:"runLegacyCallback",value:function e(t,n){if(typeof t!=="undefined"&&t!==null){t(n)}}},{key:"bindCurrentCall",value:function e(){var t=this;window["currentCall"]=this.currentCall;this.currentCall.on(f.CallEvents.Failed,function(e){t.runLegacyCallback(t.onCallFailed,e);t.unbindCurrentCall()});this.currentCall.on(f.CallEvents.Connected,function(e){t.runLegacyCallback(t.onCallConnected,e);t.runLegacyCallback(t.onCallMediaStarted,e);var n=a.CallManager.get();setTimeout(function(){var e=document.getElementById(window["currentCall"].peerConnection.impl.getRemoteStreams()[0].getTracks()[0].id);e.srcObject=window["currentCall"].peerConnection.impl.getRemoteStreams()[0];e.load();e.play()},1e3)});this.currentCall.on(f.CallEvents.Disconnected,function(e){t.runLegacyCallback(t.onCallEnded,e);t.unbindCurrentCall()});this.client.on(o.Events.NetStatsReceived,function(e){return t.onNetStatsReceived(e)})}},{key:"unbindCurrentCall",value:function e(){this.currentCall.off(f.CallEvents.Failed);this.currentCall.off(f.CallEvents.Connected);this.currentCall.off(f.CallEvents.Disconnected);this.currentCall.off(f.CallEvents.ProgressToneStart);this.currentCall.off(f.CallEvents.Connected);this.client.off(o.Events.NetStatsReceived)}},{key:"_traceName",value:function e(){return"ZingayaAPI"}}]);return e}();t.ZingayaAPI=g},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}Object.defineProperty(t,"__esModule",{value:true});var o=n(1);var a=n(2);var s=function(){function e(){i(this,e)}r(e,[{key:"_traceName",value:function e(){return"PushService"}}],[{key:"register",value:function e(t){return new Promise(function(e,n){var r=o.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.registerPushToken,t);if(r)e();else n()})}},{key:"unregister",value:function e(t){return new Promise(function(e,n){var r=o.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.unregisterPushToken,t);if(r)e();else n()})}},{key:"incomingPush",value:function e(t){return new Promise(function(e,n){var r=o.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.pushFeedback,t);if(r)e();else n()})}}]);return e}();t.PushService=s},function(e,t,n){"use strict";(function(t){var r=n(48);e.exports=r({window:t.window})}).call(t,n(47))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(1,eval)("this")}catch(e){if(typeof window==="object")n=window}e.exports=n},function(e,t,n){"use strict";var r=n(7);e.exports=function(e,t){var i=e&&e.window;var o={shimChrome:true,shimFirefox:true,shimEdge:true,shimSafari:true};for(var a in t){if(hasOwnProperty.call(t,a)){o[a]=t[a]}}var s=r.log;var c=r.detectBrowser(i);var l={browserDetails:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};var u=n(49)||null;var d=n(51)||null;var f=n(54)||null;var g=n(56)||null;var p=n(57)||null;switch(c.browser){case"chrome":if(!u||!u.shimPeerConnection||!o.shimChrome){s("Chrome shim is not included in this adapter release.");return l}s("adapter.js shimming chrome.");l.browserShim=u;p.shimCreateObjectURL(i);u.shimGetUserMedia(i);u.shimMediaStream(i);u.shimSourceObject(i);u.shimPeerConnection(i);u.shimOnTrack(i);u.shimAddTrackRemoveTrack(i);u.shimGetSendersWithDtmf(i);p.shimRTCIceCandidate(i);break;case"firefox":if(!f||!f.shimPeerConnection||!o.shimFirefox){s("Firefox shim is not included in this adapter release.");return l}s("adapter.js shimming firefox.");l.browserShim=f;p.shimCreateObjectURL(i);f.shimGetUserMedia(i);f.shimSourceObject(i);f.shimPeerConnection(i);f.shimOnTrack(i);f.shimRemoveStream(i);p.shimRTCIceCandidate(i);break;case"edge":if(!d||!d.shimPeerConnection||!o.shimEdge){s("MS edge shim is not included in this adapter release.");return l}s("adapter.js shimming edge.");l.browserShim=d;p.shimCreateObjectURL(i);d.shimGetUserMedia(i);d.shimPeerConnection(i);d.shimReplaceTrack(i);break;case"safari":if(!g||!o.shimSafari){s("Safari shim is not included in this adapter release.");return l}s("adapter.js shimming safari.");l.browserShim=g;p.shimCreateObjectURL(i);g.shimRTCIceServerUrls(i);g.shimCallbacksAPI(i);g.shimLocalStreamsAPI(i);g.shimRemoteStreamsAPI(i);g.shimTrackEventTransceiver(i);g.shimGetUserMedia(i);g.shimCreateOfferLegacy(i);p.shimRTCIceCandidate(i);break;default:s("Unsupported browser!");break}return l}},function(e,t,n){"use strict";var r=n(7);var i=r.log;var o={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack)}this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;if(!n._ontrackpoly){n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;if(e.RTCPeerConnection.prototype.getReceivers){i=n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id})}else{i={track:r.track}}var o=new Event("track");o.track=r.track;o.receiver=i;o.transceiver={receiver:i};o.streams=[t.stream];n.dispatchEvent(o)});t.stream.getTracks().forEach(function(r){var i;if(e.RTCPeerConnection.prototype.getReceivers){i=n.getReceivers().find(function(e){return e.track&&e.track.id===r.id})}else{i={track:r}}var o=new Event("track");o.track=r;o.receiver=i;o.transceiver={receiver:i};o.streams=[t.stream];n.dispatchEvent(o)})};n.addEventListener("addstream",n._ontrackpoly)}return t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){if(this._dtmf===undefined){if(t.kind==="audio"){this._dtmf=e.createDTMFSender(t)}else{this._dtmf=null}}return this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){this._senders=this._senders||[];return this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=this;var o=n.apply(i,arguments);if(!o){o=t(i,e);i._senders.push(o)}return o};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;r.apply(t,arguments);var n=t._senders.indexOf(e);if(n!==-1){t._senders.splice(n,1)}}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[];i.apply(n,[e]);e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[];o.apply(t,[e]);e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});if(n){t._senders.splice(t._senders.indexOf(n),1)}})}}else if(typeof e==="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this;var t=a.apply(e,[]);t.forEach(function(t){t._pc=e});return t};Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=this._pc.createDTMFSender(this.track)}else{this._dtmf=null}}return this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e;if(this.src){t.revokeObjectURL(this.src)}if(!e){this.src="";return undefined}this.src=t.createObjectURL(e);e.addEventListener("addtrack",function(){if(n.src){t.revokeObjectURL(n.src)}n.src=t.createObjectURL(e)});e.addEventListener("removetrack",function(){if(n.src){t.revokeObjectURL(n.src)}n.src=t.createObjectURL(e)})}})}}},shimAddTrackRemoveTrack:function(e){var t=r.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=64){return}var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;var t=n.apply(this);e._reverseStreams=e._reverseStreams||{};return t.map(function(t){return e._reverseStreams[t.id]})};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;n._streams=n._streams||{};n._reverseStreams=n._reverseStreams||{};t.getTracks().forEach(function(e){var t=n.getSenders().find(function(t){return t.track===e});if(t){throw new DOMException("Track already exists.","InvalidAccessError")}});if(!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r;n._reverseStreams[r.id]=t;t=r}i.apply(n,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{};t._reverseStreams=t._reverseStreams||{};o.apply(t,[t._streams[e.id]||e]);delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id];delete t._streams[e.id]};e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if(r.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}var i=[].slice.call(arguments,1);if(i.length!==1||!i[0].getTracks().find(function(e){return e===t})){throw new DOMException("The adapter.js addTrack polyfill only supports a single "+" stream which is associated with the specified track.","NotSupportedError")}var o=r.getSenders().find(function(e){return e.track===t});if(o){throw new DOMException("Track already exists.","InvalidAccessError")}r._streams=r._streams||{};r._reverseStreams=r._reverseStreams||{};var a=r._streams[n.id];if(a){a.addTrack(t);Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))})}else{var s=new e.MediaStream([t]);r._streams[n.id]=s;r._reverseStreams[s.id]=n;r.addStream(s)}return r.getSenders().find(function(e){return e.track===t})};function a(e,t){var n=t.sdp;Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t];var i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)});return new RTCSessionDescription({type:t.type,sdp:n})}function s(e,t){var n=t.sdp;Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t];var i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)});return new RTCSessionDescription({type:t.type,sdp:n})}["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;var t=arguments;var r=arguments.length&&typeof arguments[0]==="function";if(r){return n.apply(e,[function(n){var r=a(e,n);t[0].apply(null,[r])},function(e){if(t[1]){t[1].apply(null,e)}},arguments[2]])}return n.apply(e,arguments).then(function(t){return a(e,t)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;if(!arguments.length||!arguments[0].type){return c.apply(e,arguments)}arguments[0]=s(e,arguments[0]);return c.apply(e,arguments)};var l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this;var t=l.get.apply(this);if(t.type===""){return t}return a(e,t)}});e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if(t.signalingState==="closed"){throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError")}if(!e._pc){throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.","TypeError")}var n=e._pc===t;if(!n){throw new DOMException("Sender was not created by this connection.","InvalidAccessError")}t._streams=t._streams||{};var r;Object.keys(t._streams).forEach(function(n){var i=t._streams[n].getTracks().find(function(t){return e.track===t});if(i){r=t._streams[n]}});if(r){if(r.getTracks().length===1){t.removeStream(t._reverseStreams[r.id])}else{r.removeTrack(e.track)}t.dispatchEvent(new Event("negotiationneeded"))}}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(!e.RTCPeerConnection){e.RTCPeerConnection=function(t,n){i("PeerConnection");if(t&&t.iceTransportPolicy){t.iceTransports=t.iceTransportPolicy}return new e.webkitRTCPeerConnection(t,n)};e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype;if(e.webkitRTCPeerConnection.generateCertificate){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}})}}else{var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){var i=[];for(var o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];if(!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")){r.deprecated("RTCIceServer.url","RTCIceServer.urls");a=JSON.parse(JSON.stringify(a));a.urls=a.url;i.push(a)}else{i.push(e.iceServers[o])}}e.iceServers=i}return new n(e,t)};e.RTCPeerConnection.prototype=n.prototype;Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this;var i=arguments;if(arguments.length>0&&typeof e==="function"){return o.apply(this,arguments)}if(o.length===0&&(arguments.length===0||typeof arguments[0]!=="function")){return o.apply(this,[])}var a=function(e){var t={};var n=e.result();n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)});t[n.id]=n});return t};var s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i[1](s(a(e)))};return o.apply(this,[c,arguments[0]])}return new Promise(function(e,t){o.apply(r,[function(t){e(s(a(t)))},t])}).then(t,n)};if(t.version<51){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments;var t=this;var r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});if(e.length<2){return r}return r.then(function(){e[1].apply(null,[])},function(t){if(e.length>=3){e[2].apply(null,[t])}})}})}if(t.version<52){["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]==="object"){var t=arguments.length===1?arguments[0]:undefined;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}})}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return a.apply(this,arguments)}}};e.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimAddTrackRemoveTrack:o.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:o.shimGetSendersWithDtmf,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:n(50)}},function(e,t,n){"use strict";var r=n(7);var i=r.log;e.exports=function(e){var t=r.detectBrowser(e);var n=e&&e.navigator;var o=function(e){if(typeof e!=="object"||e.mandatory||e.optional){return e}var t={};Object.keys(e).forEach(function(n){if(n==="require"||n==="advanced"||n==="mediaSource"){return}var r=typeof e[n]==="object"?e[n]:{ideal:e[n]};if(r.exact!==undefined&&typeof r.exact==="number"){r.min=r.max=r.exact}var i=function(e,t){if(e){return e+t.charAt(0).toUpperCase()+t.slice(1)}return t==="deviceId"?"sourceId":t};if(r.ideal!==undefined){t.optional=t.optional||[];var o={};if(typeof r.ideal==="number"){o[i("min",n)]=r.ideal;t.optional.push(o);o={};o[i("max",n)]=r.ideal;t.optional.push(o)}else{o[i("",n)]=r.ideal;t.optional.push(o)}}if(r.exact!==undefined&&typeof r.exact!=="number"){t.mandatory=t.mandatory||{};t.mandatory[i("",n)]=r.exact}else{["min","max"].forEach(function(e){if(r[e]!==undefined){t.mandatory=t.mandatory||{};t.mandatory[i(e,n)]=r[e]}})}});if(e.advanced){t.optional=(t.optional||[]).concat(e.advanced)}return t};var a=function(e,r){if(t.version>=61){return r(e)}e=JSON.parse(JSON.stringify(e));if(e&&typeof e.audio==="object"){var a=function(e,t,n){if(t in e&&!(n in e)){e[n]=e[t];delete e[t]}};e=JSON.parse(JSON.stringify(e));a(e.audio,"autoGainControl","googAutoGainControl");a(e.audio,"noiseSuppression","googNoiseSuppression");e.audio=o(e.audio)}if(e&&typeof e.video==="object"){var s=e.video.facingMode;s=s&&(typeof s==="object"?s:{ideal:s});var c=t.version<66;if(s&&(s.exact==="user"||s.exact==="environment"||s.ideal==="user"||s.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete e.video.facingMode;var l;if(s.exact==="environment"||s.ideal==="environment"){l=["back","rear"]}else if(s.exact==="user"||s.ideal==="user"){l=["front"]}if(l){return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return e.kind==="videoinput"});var n=t.find(function(e){return l.some(function(t){return e.label.toLowerCase().indexOf(t)!==-1})});if(!n&&t.length&&l.indexOf("back")!==-1){n=t[t.length-1]}if(n){e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}}e.video=o(e.video);i("chrome: "+JSON.stringify(e));return r(e)})}}e.video=o(e.video)}i("chrome: "+JSON.stringify(e));return r(e)};var s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};var c=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){if(r){r(s(e))}})})};n.getUserMedia=c;var l=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(!n.mediaDevices){n.mediaDevices={getUserMedia:l,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:true,echoCancellation:true,facingMode:true,frameRate:true,height:true,width:true}}}}if(!n.mediaDevices.getUserMedia){n.mediaDevices.getUserMedia=function(e){return l(e)}}else{var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(e){e.stop()});throw new DOMException("","NotFoundError")}return t},function(e){return Promise.reject(s(e))})})}}if(typeof n.mediaDevices.addEventListener==="undefined"){n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}}if(typeof n.mediaDevices.removeEventListener==="undefined"){n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")}}}},function(e,t,n){"use strict";var r=n(7);var i=n(52);e.exports={shimGetUserMedia:n(53),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer){if(!e.RTCIceCandidate){e.RTCIceCandidate=function(e){return e}}if(!e.RTCSessionDescription){e.RTCSessionDescription=function(e){return e}}if(t.version<15025){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e;this.dispatchEvent(t)}})}}if(e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){if(this._dtmf===undefined){if(this.track.kind==="audio"){this._dtmf=new e.RTCDtmfSender(this)}else if(this.track.kind==="video"){this._dtmf=null}}return this._dtmf}})}e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){if(e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)){e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack}}}},function(e,t,n){"use strict";var r=n(28);function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);a+=r.writeIceParameters(e.iceGatherer.getLocalParameters());a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),n==="offer"?"actpass":o||"active");a+="a=mid:"+e.mid+"\r\n";if(e.rtpSender&&e.rtpReceiver){a+="a=sendrecv\r\n"}else if(e.rtpSender){a+="a=sendonly\r\n"}else if(e.rtpReceiver){a+="a=recvonly\r\n"}else{a+="a=inactive\r\n"}if(e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+s;a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s;if(e.sendEncodingParameters[0].rtx){a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s;a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n"}}a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n";if(e.rtpSender&&e.sendEncodingParameters[0].rtx){a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"}return a}function o(e,t){var n=false;e=JSON.parse(JSON.stringify(e));return e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;if(e.url&&!e.urls){console.warn("RTCIceServer.url is deprecated! Use urls instead.")}var i=typeof r==="string";if(i){r=[r]}r=r.filter(function(e){var r=e.indexOf("turn:")===0&&e.indexOf("transport=udp")!==-1&&e.indexOf("turn:[")===-1&&!n;if(r){n=true;return true}return e.indexOf("stun:")===0&&t>=14393&&e.indexOf("?transport=udp")===-1});delete e.url;e.urls=i?r[0]:r;return!!r.length}})}function a(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};var r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++){if(t[n].payloadType===e||t[n].preferredPayloadType===e){return t[n]}}};var i=function(e,t,n,i){var o=r(e.parameters.apt,n);var a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if(r.name.toLowerCase()==="rtx"&&r.parameters&&a.parameters.apt){if(!i(r,a,e.codecs,t.codecs)){continue}}a=JSON.parse(JSON.stringify(a));a.numChannels=Math.min(r.numChannels,a.numChannels);n.codecs.push(a);a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++){if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter){return true}}return false});break}}});e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}});return n}function s(e,t,n){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)!==-1}function c(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});if(!n){e.addRemoteCandidate(t)}return!n}function l(e,t){t.addTrack(e);var n=new Event("addtrack");n.track=e;t.dispatchEvent(n)}function u(e,t){t.removeTrack(e);var n=new Event("removetrack");n.track=e;t.dispatchEvent(n)}function d(e,t,n,r){var i=new Event("track");i.track=t;i.receiver=n;i.transceiver={receiver:n};i.streams=r;window.setTimeout(function(){e.dispatchEvent(i);if(typeof e.ontrack==="function"){e.ontrack(i)}})}e.exports=function(e,t){var n=function(n){var i=this;var a=document.createDocumentFragment();["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=a[e].bind(a)});this.onicecandidate=null;this.onaddstream=null;this.ontrack=null;this.onremovestream=null;this.onsignalingstatechange=null;this.oniceconnectionstatechange=null;this.onicegatheringstatechange=null;this.onnegotiationneeded=null;this.ondatachannel=null;this.canTrickleIceCandidates=null;this.needNegotiation=false;this.localStreams=[];this.remoteStreams=[];this.localDescription=null;this.remoteDescription=null;this.signalingState="stable";this.iceConnectionState="new";this.iceGatheringState="new";n=JSON.parse(JSON.stringify(n||{}));this.usingBundle=n.bundlePolicy==="max-bundle";if(n.rtcpMuxPolicy==="negotiate"){var s=new Error("rtcpMuxPolicy 'negotiate' is not supported");s.name="NotSupportedError";throw s}else if(!n.rtcpMuxPolicy){n.rtcpMuxPolicy="require"}switch(n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all";break}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced";break}n.iceServers=o(n.iceServers||[],t);this._iceGatherers=[];if(n.iceCandidatePoolSize){for(var c=n.iceCandidatePoolSize;c>0;c--){this._iceGatherers=new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy})}}else{n.iceCandidatePoolSize=0}this._config=n;this.transceivers=[];this._sdpSessionId=r.generateSessionId();this._sdpSessionVersion=0;this._dtlsRole=undefined};n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e);if(typeof this.onicegatheringstatechange==="function"){this.onicegatheringstatechange(e)}};n.prototype.getConfiguration=function(){return this._config};n.prototype.getLocalStreams=function(){return this.localStreams};n.prototype.getRemoteStreams=function(){return this.remoteStreams};n.prototype._createTransceiver=function(e){var t=this.transceivers.length>0;var n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:true};if(this.usingBundle&&t){n.iceTransport=this.transceivers[0].iceTransport;n.dtlsTransport=this.transceivers[0].dtlsTransport}else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport;n.dtlsTransport=r.dtlsTransport}this.transceivers.push(n);return n};n.prototype.addTrack=function(t,n){var r;for(var i=0;i<this.transceivers.length;i++){if(!this.transceivers[i].track&&this.transceivers[i].kind===t.kind){r=this.transceivers[i]}}if(!r){r=this._createTransceiver(t.kind)}this._maybeFireNegotiationNeeded();if(this.localStreams.indexOf(n)===-1){this.localStreams.push(n)}r.track=t;r.stream=n;r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport);return r.rtpSender};n.prototype.addStream=function(e){var n=this;if(t>=15025){e.getTracks().forEach(function(t){n.addTrack(t,e)})}else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})});r.getTracks().forEach(function(e){n.addTrack(e,r)})}};n.prototype.removeTrack=function(t){if(!(t instanceof e.RTCRtpSender)){throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack "+"does not implement interface RTCRtpSender.")}var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n){var r=new Error("Sender was not created by this connection.");r.name="InvalidAccessError";throw r}var i=n.stream;n.rtpSender.stop();n.rtpSender=null;n.track=null;n.stream=null;var o=this.transceivers.map(function(e){return e.stream});if(o.indexOf(i)===-1&&this.localStreams.indexOf(i)>-1){this.localStreams.splice(this.localStreams.indexOf(i),1)}this._maybeFireNegotiationNeeded()};n.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});if(n){t.removeTrack(n)}})};n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})};n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})};n.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0){return this.transceivers[0].iceGatherer}else if(this._iceGatherers.length){return this._iceGatherers.shift()}var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});Object.defineProperty(i,"state",{value:"new",writable:true});this.transceivers[t].candidates=[];this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||Object.keys(e.candidate).length===0;i.state=n?"completed":"gathering";if(r.transceivers[t].candidates!==null){r.transceivers[t].candidates.push(e.candidate)}};i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates);return i};n.prototype._gather=function(t,n){var i=this;var o=this.transceivers[n].iceGatherer;if(o.onlocalcandidate){return}var a=this.transceivers[n].candidates;this.transceivers[n].candidates=null;o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates);o.onlocalcandidate=function(e){if(i.usingBundle&&n>0){return}var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate;var c=!s||Object.keys(s).length===0;if(c){if(o.state==="new"||o.state==="gathering"){o.state="completed"}}else{if(o.state==="new"){o.state="gathering"}s.component=1;a.candidate.candidate=r.writeCandidate(s)}var l=r.splitSections(i.localDescription.sdp);if(!c){l[a.candidate.sdpMLineIndex+1]+="a="+a.candidate.candidate+"\r\n"}else{l[a.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n"}i.localDescription.sdp=l.join("");var u=i.transceivers.every(function(e){return e.iceGatherer&&e.iceGatherer.state==="completed"});if(i.iceGatheringState!=="gathering"){i.iceGatheringState="gathering";i._emitGatheringStateChange()}if(!c){i.dispatchEvent(a);if(typeof i.onicecandidate==="function"){i.onicecandidate(a)}}if(u){i.dispatchEvent(new Event("icecandidate"));if(typeof i.onicecandidate==="function"){i.onicecandidate(new Event("icecandidate"))}i.iceGatheringState="complete";i._emitGatheringStateChange()}};e.setTimeout(function(){a.forEach(function(e){var t=new Event("RTCIceGatherEvent");t.candidate=e;o.onlocalcandidate(t)})},0)};n.prototype._createIceAndDtlsTransports=function(){var t=this;var n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);r.ondtlsstatechange=function(){t._updateConnectionState()};r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:true});t._updateConnectionState()};return{iceTransport:n,dtlsTransport:r}};n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;if(t){delete t.onlocalcandidate;delete this.transceivers[e].iceGatherer}var n=this.transceivers[e].iceTransport;if(n){delete n.onicestatechange;delete this.transceivers[e].iceTransport}var r=this.transceivers[e].dtlsTransport;if(r){delete r.ondtlsstatechange;delete r.onerror;delete this.transceivers[e].dtlsTransport}};n.prototype._transceive=function(e,n,i){var o=a(e.localCapabilities,e.remoteCapabilities);if(n&&e.rtpSender){o.encodings=e.sendEncodingParameters;o.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound};if(e.recvEncodingParameters.length){o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc}e.rtpSender.send(o)}if(i&&e.rtpReceiver&&o.codecs.length>0){if(e.kind==="video"&&e.recvEncodingParameters&&t<15019){e.recvEncodingParameters.forEach(function(e){delete e.rtx})}if(e.recvEncodingParameters.length){o.encodings=e.recvEncodingParameters}o.rtcp={compound:e.rtcpParameters.compound};if(e.rtcpParameters.cname){o.rtcp.cname=e.rtcpParameters.cname}if(e.sendEncodingParameters.length){o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc}e.rtpReceiver.receive(o)}};n.prototype.setLocalDescription=function(e){var t=this;var n=arguments;if(!s("setLocalDescription",e.type,this.signalingState)){return new Promise(function(r,i){var o=new Error("Can not set local "+e.type+" in state "+t.signalingState);o.name="InvalidStateError";if(n.length>2&&typeof n[2]==="function"){n[2].apply(null,[o])}i(o)})}var i;var o;if(e.type==="offer"){i=r.splitSections(e.sdp);o=i.shift();i.forEach(function(e,n){var i=r.parseRtpParameters(e);t.transceivers[n].localCapabilities=i});this.transceivers.forEach(function(e,n){t._gather(e.mid,n)})}else if(e.type==="answer"){i=r.splitSections(t.remoteDescription.sdp);o=i.shift();var c=r.matchPrefix(o,"a=ice-lite").length>0;i.forEach(function(e,n){var i=t.transceivers[n];var s=i.iceGatherer;var l=i.iceTransport;var u=i.dtlsTransport;var d=i.localCapabilities;var f=i.remoteCapabilities;var g=r.isRejected(e)&&!r.matchPrefix(e,"a=bundle-only").length===1;if(!g&&!i.isDatachannel){var p=r.getIceParameters(e,o);var v=r.getDtlsParameters(e,o);if(c){v.role="server"}if(!t.usingBundle||n===0){t._gather(i.mid,n);if(l.state==="new"){l.start(s,p,c?"controlling":"controlled")}if(u.state==="new"){u.start(v)}}var h=a(d,f);t._transceive(i,h.codecs.length>0,false)}})}this.localDescription={type:e.type,sdp:e.sdp};switch(e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var l=arguments.length>1&&typeof arguments[1]==="function"&&arguments[1];return new Promise(function(e){if(l){l.apply(null)}e()})};n.prototype.setRemoteDescription=function(n){var i=this;var o=arguments;if(!s("setRemoteDescription",n.type,this.signalingState)){return new Promise(function(e,t){var r=new Error("Can not set remote "+n.type+" in state "+i.signalingState);r.name="InvalidStateError";if(o.length>2&&typeof o[2]==="function"){o[2].apply(null,[r])}t(r)})}var a={};this.remoteStreams.forEach(function(e){a[e.id]=e});var f=[];var g=r.splitSections(n.sdp);var p=g.shift();var v=r.matchPrefix(p,"a=ice-lite").length>0;var h=r.matchPrefix(p,"a=group:BUNDLE ").length>0;this.usingBundle=h;var y=r.matchPrefix(p,"a=ice-options:")[0];if(y){this.canTrickleIceCandidates=y.substr(14).split(" ").indexOf("trickle")>=0}else{this.canTrickleIceCandidates=false}g.forEach(function(o,s){var d=r.splitLines(o);var g=r.getKind(o);var y=r.isRejected(o)&&!r.matchPrefix(o,"a=bundle-only").length===1;var m=d[0].substr(2).split(" ")[2];var C=r.getDirection(o,p);var _=r.parseMsid(o);var S=r.getMid(o)||r.generateIdentifier();if(g==="application"&&m==="DTLS/SCTP"){i.transceivers[s]={mid:S,isDatachannel:true};return}var L;var E;var M;var R;var T;var b;var k;var P;var I;var w=r.parseRtpParameters(o);var A;var O;if(!y){A=r.getIceParameters(o,p);O=r.getDtlsParameters(o,p);O.role="client"}k=r.parseRtpEncodingParameters(o);var D=r.parseRtcpParameters(o);var N=r.matchPrefix(o,"a=end-of-candidates",p).length>0;var x=r.matchPrefix(o,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return e.component===1});if((n.type==="offer"||n.type==="answer")&&!y&&h&&s>0&&i.transceivers[s]){i._disposeIceAndDtlsTransports(s);i.transceivers[s].iceGatherer=i.transceivers[0].iceGatherer;i.transceivers[s].iceTransport=i.transceivers[0].iceTransport;i.transceivers[s].dtlsTransport=i.transceivers[0].dtlsTransport;if(i.transceivers[s].rtpSender){i.transceivers[s].rtpSender.setTransport(i.transceivers[0].dtlsTransport)}if(i.transceivers[s].rtpReceiver){i.transceivers[s].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)}}if(n.type==="offer"&&!y){L=i.transceivers[s]||i._createTransceiver(g);L.mid=S;if(!L.iceGatherer){L.iceGatherer=i._createIceGatherer(s,h)}if(x.length&&L.iceTransport.state==="new"){if(N&&(!h||s===0)){L.iceTransport.setRemoteCandidates(x)}else{x.forEach(function(e){c(L.iceTransport,e)})}}P=e.RTCRtpReceiver.getCapabilities(g);if(t<15019){P.codecs=P.codecs.filter(function(e){return e.name!=="rtx"})}b=L.sendEncodingParameters||[{ssrc:(2*s+2)*1001}];var F=false;if(C==="sendrecv"||C==="sendonly"){F=!L.rtpReceiver;T=L.rtpReceiver||new e.RTCRtpReceiver(L.dtlsTransport,g);if(F){var U;I=T.track;if(_&&_.stream==="-"){}else if(_){if(!a[_.stream]){a[_.stream]=new e.MediaStream;Object.defineProperty(a[_.stream],"id",{get:function(){return _.stream}})}Object.defineProperty(I,"id",{get:function(){return _.track}});U=a[_.stream]}else{if(!a.default){a.default=new e.MediaStream}U=a.default}if(U){l(I,U);L.associatedRemoteMediaStreams.push(U)}f.push([I,T,U])}}else if(L.rtpReceiver&&L.rtpReceiver.track){L.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===L.rtpReceiver.track.id});if(t){u(t,e)}});L.associatedRemoteMediaStreams=[]}L.localCapabilities=P;L.remoteCapabilities=w;L.rtpReceiver=T;L.rtcpParameters=D;L.sendEncodingParameters=b;L.recvEncodingParameters=k;i._transceive(i.transceivers[s],false,F)}else if(n.type==="answer"&&!y){L=i.transceivers[s];E=L.iceGatherer;M=L.iceTransport;R=L.dtlsTransport;T=L.rtpReceiver;b=L.sendEncodingParameters;P=L.localCapabilities;i.transceivers[s].recvEncodingParameters=k;i.transceivers[s].remoteCapabilities=w;i.transceivers[s].rtcpParameters=D;if(x.length&&M.state==="new"){if((v||N)&&(!h||s===0)){M.setRemoteCandidates(x)}else{x.forEach(function(e){c(L.iceTransport,e)})}}if(!h||s===0){if(M.state==="new"){M.start(E,A,"controlling")}if(R.state==="new"){R.start(O)}}i._transceive(L,C==="sendrecv"||C==="recvonly",C==="sendrecv"||C==="sendonly");if(T&&(C==="sendrecv"||C==="sendonly")){I=T.track;if(_){if(!a[_.stream]){a[_.stream]=new e.MediaStream}l(I,a[_.stream]);f.push([I,T,a[_.stream]])}else{if(!a.default){a.default=new e.MediaStream}l(I,a.default);f.push([I,T,a.default])}}else{delete L.rtpReceiver}}});if(this._dtlsRole===undefined){this._dtlsRole=n.type==="offer"?"active":"passive"}this.remoteDescription={type:n.type,sdp:n.sdp};switch(n.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+n.type+'"')}Object.keys(a).forEach(function(t){var n=a[t];if(n.getTracks().length){if(i.remoteStreams.indexOf(n)===-1){i.remoteStreams.push(n);var r=new Event("addstream");r.stream=n;e.setTimeout(function(){i.dispatchEvent(r);if(typeof i.onaddstream==="function"){i.onaddstream(r)}})}f.forEach(function(e){var t=e[0];var r=e[1];if(n.id!==e[2].id){return}d(i,t,r,[n])})}});f.forEach(function(e){if(e[2]){return}d(i,e[0],e[1],[])});e.setTimeout(function(){if(!(i&&i.transceivers)){return}i.transceivers.forEach(function(e){if(e.iceTransport&&e.iceTransport.state==="new"&&e.iceTransport.getRemoteCandidates().length>0){console.warn("Timeout for addRemoteCandidate. Consider sending "+"an end-of-candidates notification");e.iceTransport.addRemoteCandidate({})}})},4e3);return new Promise(function(e){if(o.length>1&&typeof o[1]==="function"){o[1].apply(null)}e()})};n.prototype.close=function(){this.transceivers.forEach(function(e){if(e.iceTransport){e.iceTransport.stop()}if(e.dtlsTransport){e.dtlsTransport.stop()}if(e.rtpSender){e.rtpSender.stop()}if(e.rtpReceiver){e.rtpReceiver.stop()}});this._updateSignalingState("closed")};n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t);if(typeof this.onsignalingstatechange==="function"){this.onsignalingstatechange(t)}};n.prototype._maybeFireNegotiationNeeded=function(){var t=this;if(this.signalingState!=="stable"||this.needNegotiation===true){return}this.needNegotiation=true;e.setTimeout(function(){if(t.needNegotiation===false){return}t.needNegotiation=false;var e=new Event("negotiationneeded");t.dispatchEvent(e);if(typeof t.onnegotiationneeded==="function"){t.onnegotiationneeded(e)}},0)};n.prototype._updateConnectionState=function(){var e;var t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){t[e.iceTransport.state]++;t[e.dtlsTransport.state]++});t.connected+=t.completed;e="new";if(t.failed>0){e="failed"}else if(t.connecting>0||t.checking>0){e="connecting"}else if(t.disconnected>0){e="disconnected"}else if(t.new>0){e="new"}else if(t.connected>0||t.completed>0){e="connected"}if(e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n);if(typeof this.oniceconnectionstatechange==="function"){this.oniceconnectionstatechange(n)}}};n.prototype.createOffer=function(){var n=this;var o=arguments;var a;if(arguments.length===1&&typeof arguments[0]!=="function"){a=arguments[0]}else if(arguments.length===3){a=arguments[2]}var s=this.transceivers.filter(function(e){return e.kind==="audio"}).length;var c=this.transceivers.filter(function(e){return e.kind==="video"}).length;if(a){if(a.mandatory||a.optional){throw new TypeError("Legacy mandatory/optional constraints not supported.")}if(a.offerToReceiveAudio!==undefined){if(a.offerToReceiveAudio===true){s=1}else if(a.offerToReceiveAudio===false){s=0}else{s=a.offerToReceiveAudio}}if(a.offerToReceiveVideo!==undefined){if(a.offerToReceiveVideo===true){c=1}else if(a.offerToReceiveVideo===false){c=0}else{c=a.offerToReceiveVideo}}}this.transceivers.forEach(function(e){if(e.kind==="audio"){s--;if(s<0){e.wantReceive=false}}else if(e.kind==="video"){c--;if(c<0){e.wantReceive=false}}});while(s>0||c>0){if(s>0){this._createTransceiver("audio");s--}if(c>0){this._createTransceiver("video");c--}}var l=r.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(i,o){var a=i.track;var s=i.kind;var c=r.generateIdentifier();i.mid=c;if(!i.iceGatherer){i.iceGatherer=n._createIceGatherer(o,n.usingBundle)}var l=e.RTCRtpSender.getCapabilities(s);if(t<15019){l.codecs=l.codecs.filter(function(e){return e.name!=="rtx"})}l.codecs.forEach(function(e){if(e.name==="H264"&&e.parameters["level-asymmetry-allowed"]===undefined){e.parameters["level-asymmetry-allowed"]="1"}});var u=i.sendEncodingParameters||[{ssrc:(2*o+1)*1001}];if(a){if(t>=15019&&s==="video"&&!u[0].rtx){u[0].rtx={ssrc:u[0].ssrc+1}}}if(i.wantReceive){i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)}i.localCapabilities=l;i.sendEncodingParameters=u});if(this._config.bundlePolicy!=="max-compat"){l+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}l+="a=ice-options:trickle\r\n";this.transceivers.forEach(function(e,t){l+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole);l+="a=rtcp-rsize\r\n";if(e.iceGatherer&&n.iceGatheringState!=="new"&&(t===0||!n.usingBundle)){e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1;l+="a="+r.writeCandidate(e)+"\r\n"});if(e.iceGatherer.state==="completed"){l+="a=end-of-candidates\r\n"}}});var u=new e.RTCSessionDescription({type:"offer",sdp:l});return new Promise(function(e){if(o.length>0&&typeof o[0]==="function"){o[0].apply(null,[u]);e();return}e(u)})};n.prototype.createAnswer=function(){var n=this;var o=arguments;var s=r.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);if(this.usingBundle){s+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"}var c=r.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(e,r){if(r+1>c){return}if(e.isDatachannel){s+="m=application 0 DTLS/SCTP 5000\r\n"+"c=IN IP4 0.0.0.0\r\n"+"a=mid:"+e.mid+"\r\n";return}if(e.stream){var o;if(e.kind==="audio"){o=e.stream.getAudioTracks()[0]}else if(e.kind==="video"){o=e.stream.getVideoTracks()[0]}if(o){if(t>=15019&&e.kind==="video"&&!e.sendEncodingParameters[0].rtx){e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}}}}var l=a(e.localCapabilities,e.remoteCapabilities);var u=l.codecs.filter(function(e){return e.name.toLowerCase()==="rtx"}).length;if(!u&&e.sendEncodingParameters[0].rtx){delete e.sendEncodingParameters[0].rtx}s+=i(e,l,"answer",e.stream,n._dtlsRole);if(e.rtcpParameters&&e.rtcpParameters.reducedSize){s+="a=rtcp-rsize\r\n"}});var l=new e.RTCSessionDescription({type:"answer",sdp:s});return new Promise(function(e){if(o.length>0&&typeof o[0]==="function"){o[0].apply(null,[l]);e();return}e(l)})};n.prototype.addIceCandidate=function(e){var t;var n;if(!e||e.candidate===""){for(var i=0;i<this.transceivers.length;i++){if(this.transceivers[i].isDatachannel){continue}this.transceivers[i].iceTransport.addRemoteCandidate({});n=r.splitSections(this.remoteDescription.sdp);n[i+1]+="a=end-of-candidates\r\n";this.remoteDescription.sdp=n.join("");if(this.usingBundle){break}}}else if(!(e.sdpMLineIndex!==undefined||e.sdpMid)){throw new TypeError("sdpMLineIndex or sdpMid required")}else if(!this.remoteDescription){t=new Error("Can not add ICE candidate without "+"a remote description");t.name="InvalidStateError"}else{var o=e.sdpMLineIndex;if(e.sdpMid){for(var a=0;a<this.transceivers.length;a++){if(this.transceivers[a].mid===e.sdpMid){o=a;break}}}var s=this.transceivers[o];if(s){if(s.isDatachannel){return Promise.resolve()}var l=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if(l.protocol==="tcp"&&(l.port===0||l.port===9)){return Promise.resolve()}if(l.component&&l.component!==1){return Promise.resolve()}if(o===0||o>0&&s.iceTransport!==this.transceivers[0].iceTransport){if(!c(s.iceTransport,l)){t=new Error("Can not add ICE candidate");t.name="OperationError"}}if(!t){var u=e.candidate.trim();if(u.indexOf("a=")===0){u=u.substr(2)}n=r.splitSections(this.remoteDescription.sdp);n[o+1]+="a="+(l.type?u:"end-of-candidates")+"\r\n";this.remoteDescription.sdp=n.join("")}}else{t=new Error("Can not add ICE candidate");t.name="OperationError"}}var d=arguments;return new Promise(function(e,n){if(t){if(d.length>2&&typeof d[2]==="function"){d[2].apply(null,[t])}n(t)}else{if(d.length>1&&typeof d[1]==="function"){d[1].apply(null)}e()}})};n.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){if(t[n]){e.push(t[n].getStats())}})});var t=arguments.length>1&&typeof arguments[1]==="function"&&arguments[1];var n=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(r){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=n(e[t]);i.set(t,e[t])})});if(t){t.apply(null,i)}r(i)})})};return n}},function(e,t,n){"use strict";e.exports=function(e){var t=e&&e.navigator;var n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}};var r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(n(e))})}}},function(e,t,n){"use strict";var r=n(7);var i={shimOnTrack:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){if(this._ontrack){this.removeEventListener("track",this._ontrack);this.removeEventListener("addstream",this._ontrackpoly)}this.addEventListener("track",this._ontrack=e);this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t;n.receiver={track:t};n.transceiver={receiver:n.receiver};n.streams=[e.stream];this.dispatchEvent(n)}.bind(this))}.bind(this))}})}if(typeof e==="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimSourceObject:function(e){if(typeof e==="object"){if(e.HTMLMediaElement&&!("srcObject"in e.HTMLMediaElement.prototype)){Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}})}}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(typeof e!=="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection)){return}if(!e.RTCPeerConnection){e.RTCPeerConnection=function(n,r){if(t.version<38){if(n&&n.iceServers){var i=[];for(var o=0;o<n.iceServers.length;o++){var a=n.iceServers[o];if(a.hasOwnProperty("urls")){for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};if(a.urls[s].indexOf("turn")===0){c.username=a.username;c.credential=a.credential}i.push(c)}}else{i.push(n.iceServers[o])}}n.iceServers=i}}return new e.mozRTCPeerConnection(n,r)};e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype;if(e.mozRTCPeerConnection.generateCertificate){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}})}e.RTCSessionDescription=e.mozRTCSessionDescription;e.RTCIceCandidate=e.mozRTCIceCandidate}["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]);return n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){if(!arguments[0]){if(arguments[1]){arguments[1].apply(null)}return Promise.resolve()}return n.apply(this,arguments)};var i=function(e){var t=new Map;Object.keys(e).forEach(function(n){t.set(n,e[n]);t[n]=e[n]});return t};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"};var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return a.apply(this,[e||null]).then(function(e){if(t.version<48){e=i(e)}if(t.version<53&&!n){try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(t){if(t.name!=="TypeError"){throw t}e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))})}}return e}).then(n,r)}},shimRemoveStream:function(e){if("removeStream"in e.RTCPeerConnection.prototype){return}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack");this.getSenders().forEach(function(n){if(n.track&&e.getTracks().indexOf(n.track)!==-1){t.removeTrack(n)}})}}};e.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimRemoveStream:i.shimRemoveStream,shimGetUserMedia:n(55)}},function(e,t,n){"use strict";var r=n(7);var i=r.log;e.exports=function(e){var t=r.detectBrowser(e);var n=e&&e.navigator;var o=e&&e.MediaStreamTrack;var a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the "+"user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}};var s=function(e,r,o){var s=function(e){if(typeof e!=="object"||e.require){return e}var t=[];Object.keys(e).forEach(function(n){if(n==="require"||n==="advanced"||n==="mediaSource"){return}var r=e[n]=typeof e[n]==="object"?e[n]:{ideal:e[n]};if(r.min!==undefined||r.max!==undefined||r.exact!==undefined){t.push(n)}if(r.exact!==undefined){if(typeof r.exact==="number"){r.min=r.max=r.exact}else{e[n]=r.exact}delete r.exact}if(r.ideal!==undefined){e.advanced=e.advanced||[];var i={};if(typeof r.ideal==="number"){i[n]={min:r.ideal,max:r.ideal}}else{i[n]=r.ideal}e.advanced.push(i);delete r.ideal;if(!Object.keys(r).length){delete e[n]}}});if(t.length){e.require=t}return e};e=JSON.parse(JSON.stringify(e));if(t.version<38){i("spec: "+JSON.stringify(e));if(e.audio){e.audio=s(e.audio)}if(e.video){e.video=s(e.video)}i("ff37: "+JSON.stringify(e))}return n.mozGetUserMedia(e,r,function(e){o(a(e))})};var c=function(e){return new Promise(function(t,n){s(e,t,n)})};if(!n.mediaDevices){n.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}}n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})};if(t.version<41){var l=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return l().then(undefined,function(e){if(e.name==="NotFoundError"){return[]}throw e})}}if(t.version<49){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length){t.getTracks().forEach(function(e){e.stop()});throw new DOMException("The object can not be found here.","NotFoundError")}return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var d=function(e,t,n){if(t in e&&!(n in e)){e[n]=e[t];delete e[t]}};var f=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){if(typeof e==="object"&&typeof e.audio==="object"){e=JSON.parse(JSON.stringify(e));d(e.audio,"autoGainControl","mozAutoGainControl");d(e.audio,"noiseSuppression","mozNoiseSuppression")}return f(e)};if(o&&o.prototype.getSettings){var g=o.prototype.getSettings;o.prototype.getSettings=function(){var e=g.apply(this,arguments);d(e,"mozAutoGainControl","autoGainControl");d(e,"mozNoiseSuppression","noiseSuppression");return e}}if(o&&o.prototype.applyConstraints){var p=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){if(this.kind==="audio"&&typeof e==="object"){e=JSON.parse(JSON.stringify(e));d(e,"autoGainControl","mozAutoGainControl");d(e,"noiseSuppression","mozNoiseSuppression")}return p.apply(this,[e])}}}n.getUserMedia=function(e,i,o){if(t.version<44){return s(e,i,o)}r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia");n.mediaDevices.getUserMedia(e).then(i,o)}}},function(e,t,n){"use strict";var r=n(7);var i={shimLocalStreamsAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}if(!("getLocalStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getLocalStreams=function(){if(!this._localStreams){this._localStreams=[]}return this._localStreams}}if(!("getStreamById"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;if(this._localStreams){this._localStreams.forEach(function(n){if(n.id===e){t=n}})}if(this._remoteStreams){this._remoteStreams.forEach(function(n){if(n.id===e){t=n}})}return t}}if(!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){if(!this._localStreams){this._localStreams=[]}if(this._localStreams.indexOf(e)===-1){this._localStreams.push(e)}var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})};e.RTCPeerConnection.prototype.addTrack=function(e,n){if(n){if(!this._localStreams){this._localStreams=[n]}else if(this._localStreams.indexOf(n)===-1){this._localStreams.push(n)}}t.call(this,e,n)}}if(!("removeStream"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.removeStream=function(e){if(!this._localStreams){this._localStreams=[]}var t=this._localStreams.indexOf(e);if(t===-1){return}this._localStreams.splice(t,1);var n=this;var r=e.getTracks();this.getSenders().forEach(function(e){if(r.indexOf(e.track)!==-1){n.removeTrack(e)}})}}},shimRemoteStreamsAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}if(!("getRemoteStreams"in e.RTCPeerConnection.prototype)){e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}}if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){if(this._onaddstream){this.removeEventListener("addstream",this._onaddstream);this.removeEventListener("track",this._onaddstreampoly)}this.addEventListener("addstream",this._onaddstream=e);this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(!this._remoteStreams){this._remoteStreams=[]}if(this._remoteStreams.indexOf(t)>=0){return}this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0];this.dispatchEvent(n)}.bind(this))}})}},shimCallbacksAPI:function(e){if(typeof e!=="object"||!e.RTCPeerConnection){return}var t=e.RTCPeerConnection.prototype;var n=t.createOffer;var r=t.createAnswer;var i=t.setLocalDescription;var o=t.setRemoteDescription;var a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0];var i=n.apply(this,[r]);if(!t){return i}i.then(e,t);return Promise.resolve()};t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0];var i=r.apply(this,[n]);if(!t){return i}i.then(e,t);return Promise.resolve()};var s=function(e,t,n){var r=i.apply(this,[e]);if(!n){return r}r.then(t,n);return Promise.resolve()};t.setLocalDescription=s;s=function(e,t,n){var r=o.apply(this,[e]);if(!n){return r}r.then(t,n);return Promise.resolve()};t.setRemoteDescription=s;s=function(e,t,n){var r=a.apply(this,[e]);if(!n){return r}r.then(t,n);return Promise.resolve()};t.addIceCandidate=s},shimGetUserMedia:function(e){var t=e&&e.navigator;if(!t.getUserMedia){if(t.webkitGetUserMedia){t.getUserMedia=t.webkitGetUserMedia.bind(t)}else if(t.mediaDevices&&t.mediaDevices.getUserMedia){t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)}}},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){var i=[];for(var o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];if(!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")){r.deprecated("RTCIceServer.url","RTCIceServer.urls");a=JSON.parse(JSON.stringify(a));a.urls=a.url;delete a.url;i.push(a)}else{i.push(e.iceServers[o])}}e.iceServers=i}return new t(e,n)};e.RTCPeerConnection.prototype=t.prototype;if("generateCertificate"in e.RTCPeerConnection){Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}},shimTrackEventTransceiver:function(e){if(typeof e==="object"&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver){Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var r=n.getTransceivers().find(function(e){return e.sender.track&&e.sender.track.kind==="audio"});if(e.offerToReceiveAudio===false&&r){if(r.direction==="sendrecv"){r.setDirection("sendonly")}else if(r.direction==="recvonly"){r.setDirection("inactive")}}else if(e.offerToReceiveAudio===true&&!r){n.addTransceiver("audio")}var i=n.getTransceivers().find(function(e){return e.sender.track&&e.sender.track.kind==="video"});if(e.offerToReceiveVideo===false&&i){if(i.direction==="sendrecv"){i.setDirection("sendonly")}else if(i.direction==="recvonly"){i.setDirection("inactive")}}else if(e.offerToReceiveVideo===true&&!i){n.addTransceiver("video")}}return t.apply(n,arguments)}}};e.exports={shimCallbacksAPI:i.shimCallbacksAPI,shimLocalStreamsAPI:i.shimLocalStreamsAPI,shimRemoteStreamsAPI:i.shimRemoteStreamsAPI,shimGetUserMedia:i.shimGetUserMedia,shimRTCIceServerUrls:i.shimRTCIceServerUrls,shimTrackEventTransceiver:i.shimTrackEventTransceiver,shimCreateOfferLegacy:i.shimCreateOfferLegacy}},function(e,t,n){"use strict";var r=n(28);var i=n(7);function o(e,t,n){if(!e.RTCPeerConnection){return}var r=e.RTCPeerConnection.prototype;var i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t){return i.apply(this,arguments)}var o=function(e){r(n(e))};this._eventMap=this._eventMap||{};this._eventMap[r]=o;return i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n]){return o.apply(this,arguments)}var r=this._eventMap[n];delete this._eventMap[n];return o.apply(this,[e,r])};Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){if(this["_on"+t]){this.removeEventListener(t,this["_on"+t]);delete this["_on"+t]}if(e){this.addEventListener(t,this["_on"+t]=e)}}})}e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype){return}var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if(typeof e==="object"&&e.candidate&&e.candidate.indexOf("a=")===0){e=JSON.parse(JSON.stringify(e));e.candidate=e.candidate.substr(2)}var n=new t(e);var i=r.parseCandidate(e.candidate);var o=Object.assign(n,i);o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}};return o};o(e,"icecandidate",function(t){if(t.candidate){Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"})}return t})},shimCreateObjectURL:function(e){var t=e&&e.URL;if(!(typeof e==="object"&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL)){return undefined}var n=t.createObjectURL.bind(t);var r=t.revokeObjectURL.bind(t);var o=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;o.set(t,e);i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream");return t}return n(e)};t.revokeObjectURL=function(e){r(e);o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){this.srcObject=o.get(e)||null;return s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){if(arguments.length===2&&(""+arguments[0]).toLowerCase()==="src"){this.srcObject=o.get(arguments[1])||null}return c.apply(this,arguments)}}}},function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,n,r){if(n)e(t.prototype,n);if(r)e(t,r);return t}}();var i=function e(t,n,r){if(t===null)t=Function.prototype;var i=Object.getOwnPropertyDescriptor(t,n);if(i===undefined){var o=Object.getPrototypeOf(t);if(o===null){return undefined}else{return e(o,n,r)}}else if("value"in i){return i.value}else{var a=i.get;if(a===undefined){return undefined}return a.call(r)}};function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}Object.defineProperty(t,"__esModule",{value:true});var c=n(15);var l=function(e){s(t,e);function t(e){o(this,t);return a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}r(t,[{key:"on",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,n,r)}},{key:"off",value:function e(n,r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,n,r)}},{key:"_traceName",value:function e(){return"EndPoint"}}]);return t}(c.EventDispatcher);t.EndPoint=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r;(function(e){e[e["Offline"]="OFFLINE"]="Offline";e[e["Online"]="ONLINE"]="Online";e[e["Ready"]="READY"]="Ready";e[e["InService"]="IN_SERVICE"]="InService";e[e["AfterService"]="AFTER_SERVICE"]="AfterService";e[e["Timeout"]="TIMEOUT"]="Timeout";e[e["DND"]="DND"]="DND"})(r=t.OperatorACDStatuses||(t.OperatorACDStatuses={}))}]);