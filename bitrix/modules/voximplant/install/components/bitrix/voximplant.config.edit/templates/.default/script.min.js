(function(e){if(!!e.BX.VoxImplantConfigEdit)return;var t={maximumGroups:0};var i="/bitrix/components/bitrix/voximplant.config.edit/ajax.php";var a=function(e){this.accessCodes=e.accessCodes||{};this.elements={main:e.node,addButton:null};this.init()};a.prototype.init=function(){BX.Access.Init({other:{disabled:true}});this.render()};a.prototype.render=function(){var e=this;var t=document.createDocumentFragment();for(var i in this.accessCodes){t.appendChild(BX.create("span",{props:{className:"bx-destination bx-destination-users"},children:[BX.create("span",{props:{className:"bx-destination-text"},text:BX.util.htmlspecialchars(this.accessCodes[i].NAME)}),BX.create("span",{props:{className:"bx-destination-del-but"},events:{click:function(t){e.deleteAccess(i);e.render()}}}),BX.create("input",{attrs:{type:"hidden",name:"LINE_ACCESS[]",value:BX.util.htmlspecialchars(i)}})]}))}this.elements.addButton=BX.create("span",{props:{className:"bx-destination-add"},text:BX.message("VI_CONFIG_LINE_ADD"),events:{click:this._onAddAccessClick.bind(this)}});t.appendChild(this.elements.addButton);BX.cleanNode(this.elements.main);this.elements.main.appendChild(t)};a.prototype._onAddAccessClick=function(){var e=this;BX.Access.SetSelected(this.accessCodes,"voximplantLineAccess");BX.Access.ShowForm({bind:"voximplantLineAccess",callback:function(t){var i;var a;for(var s in t){for(var l in t[s]){i=BX.Access.GetProviderName(t[s][l].provider);a=t[s][l].name;e.accessCodes[l]={PROVIDER:i,NAME:a}}}e.render()}})};a.prototype.deleteAccess=function(e){if(this.accessCodes[e])delete this.accessCodes[e]};BX.VoxImplantConfigEdit=function(e){console.log(e);this.node=e.node;this.melodies=e.melodies;this.accessCodes=e.accessCodes||{};this.popupTooltip={};this.settingsOpened=false;this.currentGroupId=null;this.previousGroupId=null;this.lineAccessEditor=null;this._onGroupSavedHandler=this._onGroupSaved.bind(this);this._onGroupEditCanceledHandler=this._onViGroupEditCanceled.bind(this);this._onGroupEditDestroyHandler=this._onGroupEditDestroy.bind(this);this._onTooltipMouseOverHandler=this._onTooltipMouseOver.bind(this);this._onTooltipMouseOutHandler=this._onTooltipMouseOut.bind(this);this.groupEditor=null;this.init();this.bindEvents()};BX.VoxImplantConfigEdit.setDefaults=function(e){for(var i in e){if(e.hasOwnProperty(i)&&t.hasOwnProperty(i)){t[i]=e[i]}}};BX.VoxImplantConfigEdit.prototype.getNode=function(e,t){if(!t)t=this.node;return t?t.querySelector('[data-role="'+e+'"]'):null};BX.VoxImplantConfigEdit.prototype.init=function(){this.currentGroupId=this.getNode("select-group").value;for(var e in this.melodies){if(this.melodies.hasOwnProperty(e)){this.loadMelody(e,this.melodies[e])}}};BX.VoxImplantConfigEdit.prototype.bindEvents=function(){var t=this;BX.bind(BX("vi_crm_forward"),"change",function(e){if(BX("vi_crm_forward").checked)BX("vi_crm_rule").style.height="40px";else BX("vi_crm_rule").style.height="0"});var i=BX("input-direct_code");if(i){BX.bind(BX("input-direct_code"),"change",function(e){if(BX("input-direct_code").checked)BX("vi-direct-code-rule").style.height="40px";else BX("vi-direct-code-rule").style.height="0"})}var s=BX("vi-recording");if(s){BX.bind(s,"change",function(e){if(s.checked)BX("vi-recording-details").style.maxHeight="160px";else BX("vi-recording-details").style.maxHeight=0})}var l=BX("vi_transcribe");if(l){BX.bind(l,"change",function(e){if(l.checked)BX("vi_transcribe_lang").style.height="40px";else BX("vi_transcribe_lang").style.height=0})}var n=BX("vi_callback_redial");if(n){BX.bind(n,"change",function(e){if(n.checked)BX("vi_callback_redial_options").style.maxHeight="100px";else BX("vi_callback_redial_options").style.maxHeight=0})}var r=BX("vi_can_be_selected");if(r){BX.bind(r,"change",function(e){if(e.target.dataset.locked==="Y"){BX.Voximplant.showLicensePopup("line-selection");e.target.checked=false;e.preventDefault();return false}if(r.checked)BX("vi_number_selection_option").style.maxHeight="250px";else BX("vi_number_selection_option").style.maxHeight=0})}var o=this.getNode("line-access");if(o){this.lineAccessEditor=new a({node:o,accessCodes:this.accessCodes})}var d=BX.findChildrenByClassName(BX("tel-set-main-wrap"),"tel-context-help");for(var p=0;p<d.length;p++){d[p].setAttribute("data-id",p);BX.bind(d[p],"mouseover",this._onTooltipMouseOverHandler);BX.bind(d[p],"mouseout",this._onTooltipMouseOutHandler)}BX.bind(this.getNode("show-group-config"),"click",this.onShowSettingsClick.bind(this));BX.bind(this.getNode("select-group"),"change",this._onGroupIdChanged.bind(this));BX.bind(this.getNode("config-edit-submit"),"click",this._onSubmitClick.bind(this));BX.bind(this.getNode("input-line-prefix"),"input",this._onInputLinePrefixInput.bind(this));BX.addCustomEvent(e,"onViGroupEditInit",this._onGroupEditInit.bind(this))};BX.VoxImplantConfigEdit.prototype.loadMelody=function(t,i){if(typeof i!=="object")return;var a=i.INPUT_NAME||"",s=i.DEFAULT_MELODY||"",l=BX["MFInput"]?BX.MFInput.get(t):null;BX.bind(BX("config_edit_form").elements["MELODY_LANG"],"change",function(){if(!(!!BX("config_edit_form").elements[a]&&!!BX("config_edit_form").elements[a]))e.jwplayer(t+"player_div").load([{file:s.replace("#LANG_ID#",this.value)}])});BX(t+"span").appendChild(BX("file_input_"+t));if(l){BX.bind(BX(t+"default"),"click",function(){l.clear()});BX.addCustomEvent(l,"onDeleteFile",function(){BX.hide(BX(t+"default"));BX.show(BX(t+"notice"));e.jwplayer(t+"player_div").load([{file:s.replace("#LANG_ID#",BX("config_edit_form").elements["MELODY_LANG"].value)}])});BX.addCustomEvent(l,"onUploadDone",function(i,a){BX.show(BX(t+"default"));BX.hide(BX(t+"notice"));if(!!e["jwplayer"]){e.jwplayer(t+"player_div").load([{file:i["url"]+(i["url"].indexOf(".mp3")>0?"":"&/melody.mp3")}])}})}else{BX.bind(BX(t+"default"),"click",function(){e["FILE_INPUT_"+t]._deleteFile(BX("config_edit_form").elements[a])});BX.addCustomEvent(e["FILE_INPUT_"+t],"onSubmit",function(){BX(t+"span").appendChild(BX.create("SPAN",{attrs:{id:t+"waiter"},props:{className:"webform-field-upload-list"},html:"<i></i>"}))});BX.addCustomEvent(e["FILE_INPUT_"+t],"onFileUploaderChange",function(){e["FILE_INPUT_"+t].INPUT.disabled=false});BX.addCustomEvent(e["FILE_INPUT_"+t],"onDeleteFile",function(i){BX.hide(BX(t+"default"));BX(t+"notice").innerHTML=BX.message("VI_CONFIG_EDIT_DOWNLOAD_TUNE_TIP");e.jwplayer(t+"player_div").load([{file:s.replace("#LANG_ID#",BX("config_edit_form").elements["MELODY_LANG"].value)}]);e["FILE_INPUT_"+t].INPUT.disabled=false});BX.addCustomEvent(e["FILE_INPUT_"+t],"onDone",function(i,a,s){BX.remove(BX(t+"waiter"));if(!!i&&i.length>0){var l=BX(t+"notice");if(s===false&&!!i[0]){if(a!=="init"){l.innerHTML=BX.message("VI_CONFIG_EDIT_UPLOAD_SUCCESS");if(!!e["jwplayer"]){e.jwplayer(t+"player_div").load([{file:i[0]["fileURL"]}])}BX(t+"default").style.display=""}}else if(!!i[0]&&i[0]["error"]){l.innerHTML=i[0]["error"]}}})}};BX.VoxImplantConfigEdit.prototype._onTooltipMouseOver=function(e){this.showTooltip(e.target.dataset.id,e.target,e.target.dataset.text)};BX.VoxImplantConfigEdit.prototype._onTooltipMouseOut=function(e){this.hideTooltip(e.target.dataset.id)};BX.VoxImplantConfigEdit.prototype.showTooltip=function(e,t,i){if(this.popupTooltip[e])this.popupTooltip[e].close();this.popupTooltip[e]=new BX.PopupWindow("bx-voximplant-tooltip",t,{lightShadow:true,autoHide:false,darkMode:true,offsetLeft:0,offsetTop:2,bindOptions:{position:"top"},zIndex:200,events:{onPopupClose:function(){this.destroy()}},content:BX.create("div",{attrs:{style:"padding-right: 5px; width: 250px;"},html:i})});this.popupTooltip[e].setAngle({offset:13,position:"bottom"});this.popupTooltip[e].show();return true};BX.VoxImplantConfigEdit.prototype.hideTooltip=function(e){this.popupTooltip[e].close();this.popupTooltip[e]=null};BX.VoxImplantConfigEdit.prototype.onShowSettingsClick=function(e){if(this.settingsOpened){if(this.currentGroupId==="new"){this.getNode("select-group").value=this.previousGroupId;this.currentGroupId=this.previousGroupId}this.hideGroupSetting()}else{this.showGroupSetting({groupId:this.getNode("select-group").value})}};BX.VoxImplantConfigEdit.prototype.showGroupSetting=function(e){this.settingsOpened=true;var t=BX("vi-group-settings-placeholder-wrapper");var a=BX("vi-group-settings-placeholder");var s=e.groupId;var l=this.getNode("show-group-config");l.innerText=BX.message("VI_CONFIG_GROUP_SETTINGS_HIDE");var n=this.getNode("select-group");n.disabled=true;var r={sessid:BX.bitrix_sessid(),GROUP_SETTINGS:"Y",ID:s};BX.ajax({url:i,method:"POST",dataType:"html",data:r,onsuccess:function(e){a.innerHTML=e;setTimeout(function(){t.style.maxHeight=a.scrollHeight+"px"},50)}})};BX.VoxImplantConfigEdit.prototype.hideGroupSetting=function(e){var t=this;var i=BX("vi-group-settings-placeholder-wrapper");var a=BX("vi-group-settings-placeholder");var s=this.getNode("show-group-config");s.innerText=BX.message("VI_CONFIG_GROUP_SETTINGS");var l=this.getNode("select-group");l.disabled=false;i.style.maxHeight=0;if(e){t.settingsOpened=false;a.innerHTML=""}else{setTimeout(function(){t.settingsOpened=false;a.innerHTML=""},300)}};BX.VoxImplantConfigEdit.prototype._onGroupIdChanged=function(e){var i=e.target.value;var a=e.target.options.length-2;if(i==="new"){if(t.maximumGroups>0&&a>=t.maximumGroups){e.target.value=e.target.options.item(2).value;BX.Voximplant.showLicensePopup("groups")}else{this.showGroupSetting({groupId:0})}}this.previousGroupId=this.currentGroupId;this.currentGroupId=i;BX.PreventDefault(e)};BX.VoxImplantConfigEdit.prototype._onSubmitClick=function(e){var t=this;var i=this.getNode("config-edit-submit");var a=BX.create("span",{props:{className:"wait"}});BX.addClass(i,"webform-small-button-wait webform-small-button-active");i.appendChild(a);if(this.groupEditor){this.groupEditor.save(function(e){t.hideGroupSetting(true);var i=e.GROUP;if(!i.ID)return;t.afterGroupSaved(i);BX.submit(BX("config_edit_form"))})}else{BX.submit(BX("config_edit_form"))}};BX.VoxImplantConfigEdit.prototype._onInputLinePrefixInput=function(e){var t=e.target;t.value=t.value.replace(/[^\d#*]/g,"");e.preventDefault()};BX.VoxImplantConfigEdit.prototype._onGroupEditInit=function(e){this.groupEditor=e;BX.addCustomEvent(this.groupEditor,"onSave",this._onGroupSavedHandler);BX.addCustomEvent(this.groupEditor,"onCancel",this._onGroupEditCanceledHandler);BX.addCustomEvent(this.groupEditor,"onDestroy",this._onGroupEditDestroyHandler)};BX.VoxImplantConfigEdit.prototype._onGroupEditDestroy=function(){BX.removeCustomEvent(this.groupEditor,"onSave",this._onGroupSavedHandler);BX.removeCustomEvent(this.groupEditor,"onCancel",this._onGroupEditCanceledHandler);BX.removeCustomEvent(this.groupEditor,"onDestroy",this._onGroupEditDestroyHandler);this.groupEditor=null};BX.VoxImplantConfigEdit.prototype._onGroupSaved=function(e){this.hideGroupSetting();this.groupEditor.destroy();var t=e.GROUP;if(!t.ID)return;this.afterGroupSaved(t)};BX.VoxImplantConfigEdit.prototype.afterGroupSaved=function(e){var t=this.getNode("select-group");var i=false;var a;for(var s=0;s<t.options.length;s++){a=t.options.item(s);if(a.value==e.ID){a.innerText=BX.util.htmlspecialchars(e.NAME);i=true;break}}if(!i){t.add(BX.create("option",{attrs:{value:e.ID},text:BX.util.htmlspecialchars(e.NAME)}))}t.value=e.ID};BX.VoxImplantConfigEdit.prototype._onViGroupEditCanceled=function(){this.hideGroupSetting();this.groupEditor.destroy();var e=this.getNode("select-group");var t=e.value;if(t==="new"){e.value=this.previousGroupId;this.currentGroupId=this.previousGroupId}};BX.ViCallerId={};BX.ViCallerId.init=function(e){BX.ViCallerId.inputNumber=e.number;BX.ViCallerId.placeholder=e.placeholder;BX.ViCallerId.number=e.number;BX.ViCallerId.numberFormatted=e.numberFormatted;BX.ViCallerId.verified=e.verified;BX.ViCallerId.verifiedUntil=e.verifiedUntil;BX.ViCallerId.phoneInput=null;BX.ViCallerId.codeInput=null;BX.ViCallerId.phoneNotice=null;BX.ViCallerId.blockAjax=false;BX.ViCallerId.blockVerify=false;BX.ViCallerId.phoneInputFormatter=null;BX.ViCallerId.drawState();BX.bind(BX("vi_link_options"),"click",function(e){if(BX("vi_link_options_div").style.display=="none"){BX.removeClass(BX(this),"webform-button-create");BX("vi_link_options_div").style.display="block"}else{BX.addClass(BX(this),"webform-button-create");BX("vi_link_options_div").style.display="none"}BX.PreventDefault(e)})};BX.ViCallerId.drawState=function(e){var t=null;var i=null;var a=null;var s=null;e=typeof e=="object"?e:{};e.state=e.state?parseInt(e.state):1;if(e.state==1){t=BX.create("div",{props:{className:"tel-new-num-form"},children:[BX.create("span",{props:{className:"tel-balance-phone-icon"}}),BX.create("a",{props:{attrs:{href:"#put-phone"},className:"tel-balance-phone-url"},events:{click:function(e){BX.ViCallerId.drawState({state:BX.ViCallerId.number.length<=0?2:3});return BX.PreventDefault(e)}},html:BX.ViCallerId.number.length<=0?BX.message("TELEPHONY_PUT_PHONE"):BX.message("TELEPHONY_VERIFY_PHONE")}),BX.ViCallerId.number.length<=0?null:BX.create("span",{props:{className:"tel-num-change-text"},html:" "+BX.message("TELEPHONY_OR")}),BX.ViCallerId.number.length<=0?null:BX.create("a",{props:{attrs:{href:"#change-phone"},className:"tel-balance-phone-url"},events:{click:function(e){BX.ViCallerId.removePhone();return BX.PreventDefault(e)}},html:BX.message("TELEPHONY_PUT_PHONE_AGAING")})]})}else if(e.state==2||e.state==3){t=BX.create("div",{attrs:{id:"tel-new-num-form"},props:{className:"tel-new-num-form "+(e.state==3?"tel-new-num-form-disable":"")},children:[BX.create("span",{props:{className:"tel-balance-phone-icon"}}),BX.create("a",{props:{attrs:{href:"#put-phone"},className:"webform-small-button"},events:{click:e.state==3?null:function(e){BX.ViCallerId.connectPhone(BX.ViCallerId.phoneInputFormatter.getValue());return BX.PreventDefault(e)}},children:[BX.create("span",{props:{className:"webform-small-button-left"}}),BX.create("span",{props:{className:"webform-small-button-text"},html:BX.message("TELEPHONY_CONFIRM")}),BX.create("span",{props:{className:"webform-small-button-right"}})]}),BX.create("div",{props:{className:"tel-new-num-inp-wrap"},children:[BX.ViCallerId.phoneInput=BX.create("input",{props:{className:"tel-new-num-inp"},attrs:{placeholder:BX.message("TELEPHONY_EXAMPLE"),type:"text",value:BX.ViCallerId.inputNumber,disabled:e.state==3}})]})]});BX.ViCallerId.phoneInputFormatter=new BX.PhoneNumber.Input({node:BX.ViCallerId.phoneInput});if(e.state==2){BX.ViCallerId.phoneNotice=s=BX.create("div",{props:{className:"tel-new-num-notice"},html:BX.message("TELEPHONY_VERIFY_CODE")+"<br>"+BX.message("TELEPHONY_VERIFY_CODE_4")+"<br><br>"+BX.message("TELEPHONY_VERIFY_CODE_3")})}else if(e.state==3){BX.ViCallerId.verifyPhone();BX.ViCallerId.phoneNotice=s=BX.create("div",{props:{className:"tel-new-num-notice"},html:BX.message("TELEPHONY_VERIFY_CODE_2")+"<br>"+BX.message("TELEPHONY_VERIFY_CODE_4")+"<br><br>"+BX.message("TELEPHONY_VERIFY_CODE_3")});i=BX.create("div",{props:{className:"tel-new-num-pass"},children:[BX.create("span",{props:{className:"tel-new-num-pass-title"},html:BX.message("TELEPHONY_PUT_CODE")}),BX.create("br"),BX.ViCallerId.codeInput=BX.create("input",{props:{className:"tel-new-num-inp"},attrs:{type:"text"}}),BX.create("a",{props:{attrs:{href:"#put-code"},className:"webform-small-button webform-small-button-accept"},events:{click:function(e){BX.ViCallerId.activatePhone(BX.ViCallerId.codeInput.value);return BX.PreventDefault(e)}},children:[BX.create("span",{props:{className:"webform-small-button-left"}}),BX.create("span",{props:{className:"webform-small-button-text"},html:BX.message("TELEPHONY_JOIN")}),BX.create("span",{props:{className:"webform-small-button-right"}})]}),BX.create("br"),BX.create("br"),BX.create("br"),BX.create("a",{attrs:{href:"#put-code",style:"margin-left: 3px; margin-right: 7px;"},props:{className:"webform-small-button"},events:{click:function(e){BX.ViCallerId.verifyPhone();return BX.PreventDefault(e)}},children:[BX.create("span",{props:{className:"webform-small-button-left"}}),BX.create("span",{props:{className:"webform-small-button-text"},html:BX.message("TELEPHONY_RECALL")}),BX.create("span",{props:{className:"webform-small-button-right"}})]}),BX.create("a",{props:{attrs:{href:"#put-code"},className:"webform-small-button"},events:{click:function(e){BX.ViCallerId.removePhone();return BX.PreventDefault(e)}},children:[BX.create("span",{props:{className:"webform-small-button-left"}}),BX.create("span",{props:{className:"webform-small-button-text"},html:BX.message("TELEPHONY_PUT_PHONE_AGAING")}),BX.create("span",{props:{className:"webform-small-button-right"}})]})]});a=null}}var l=[];if(BX.ViCallerId.number.length<=0||!BX.ViCallerId.verified){var n=null;if(BX.ViCallerId.number.length<=0){n=BX.create("div",{props:{className:"tel-balance-text"},children:[BX.create("span",{props:{className:"tel-balance-text-bold"},html:BX.message("TELEPHONY_EMPTY_PHONE")}),BX.create("span",{html:BX.message("TELEPHONY_EMPTY_PHONE_DESC")})]})}else{n=BX.create("div",{children:[BX.create("div",{props:{className:"tel-num-not-conf-text"},html:BX.message("TELEPHONY_CONFIRM_PHONE")}),BX.create("div",{props:{className:"tel-num-not-conf-block tel-num-block"},html:BX.ViCallerId.numberFormatted}),BX.create("div",{props:{className:"tel-balance-text"},children:[BX.create("strong",{html:BX.message("TELEPHONY_EMPTY_PHONE_DESC")})]})]})}l=[BX.create("div",{props:{className:"tel-new-num-block"},children:[n,t,s,i,a]})]}else{l=[BX.create("div",{props:{className:"tel-balance-text"},children:[BX.create("strong",{props:{className:"tel-balance-text-bold"},html:BX.message("TELEPHONY_PHONE")})]}),BX.create("div",{props:{className:"tel-num-block"},html:BX.ViCallerId.numberFormatted}),BX.create("div",{props:{className:"tel-num-change-block"},children:[BX.create("span",{props:{className:"tel-num-change-text"},html:BX.message("TELEPHONY_JOIN_TEXT")+" "}),BX.create("a",{props:{attrs:{href:"#change-phone"},className:"tel-num-change-link"},events:{click:function(e){if(confirm(BX.message("TELEPHONY_DELETE_CONFIRM"))){BX.ViCallerId.removePhone()}return BX.PreventDefault(e)}},html:BX.message("TELEPHONY_REJOIN")})]}),BX.create("div",{props:{className:"tel-set-item-block"},children:[BX.create("span",{props:{className:"tel-num-alert-text"},html:BX.message("TELEPHONY_CONFIRM_DATE").replace("#DATE#","<b>"+BX.ViCallerId.verifiedUntil+"</b>")})]})]}BX.ViCallerId.drawOnPlaceholder(l)};BX.ViCallerId.connectPhone=function(e){if(BX.ViCallerId.blockAjax)return false;BX.showWait();BX.ViCallerId.blockAjax=true;if(BX("tel-new-num-form")){BX.addClass(BX("tel-new-num-form"),"tel-new-num-form-disable")}BX.ajax({url:i,method:"POST",dataType:"json",timeout:30,data:{VI_CONNECT:"Y",NUMBER:e,VI_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(t){BX.closeWait();BX.ViCallerId.blockAjax=false;if(t.ERROR==""){BX.ViCallerId.inputNumber=e;if(t.VERIFIED){BX.ViCallerId.number=t.NUMBER;BX.ViCallerId.verified=true;BX.ViCallerId.verifiedUntil=t.VERIFIED_UNTIL;BX.ViCallerId.drawState({state:1})}else{BX.ViCallerId.verified=false;BX.ViCallerId.drawState({state:3})}}else{BX.addClass(BX.ViCallerId.phoneNotice,"tel-new-num-notice-err");BX.ViCallerId.phoneNotice.innerHTML=t.ERROR=="MONEY_LOW"?BX.message("TELEPHONY_ERROR_MONEY_LOW"):BX.message("TELEPHONY_ERROR_PHONE");BX.addClass(BX.ViCallerId.phoneInput,"tel-new-num-inp-err");BX.removeClass(BX("tel-new-num-form"),"tel-new-num-form-disable")}},this),onfailure:function(){BX.closeWait();BX.ViCallerId.blockAjax=false}})};BX.ViCallerId.verifyPhone=function(){if(BX.ViCallerId.blockAjax)return false;if(BX.ViCallerId.blockVerify){BX.Voximplant.alert(BX.message("VI_CONFIG_EDIT_ERROR"),BX.message("TELEPHONY_VERIFY_ALERT"));return true}setTimeout(function(){BX.ViCallerId.blockVerify=false},6e4);BX.ViCallerId.blockVerify=true;BX.showWait();BX.ViCallerId.blockAjax=true;BX.ajax({url:i,method:"POST",dataType:"json",timeout:30,data:{VI_VERIFY:"Y",VI_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:function(e){BX.closeWait();BX.ViCallerId.blockAjax=false;if(e.ERROR=="185"||e.ERROR=="183"){BX.Voximplant.alert(BX.message("VI_CONFIG_EDIT_ERROR"),BX.message("TELEPHONY_ERROR_BLOCK"));BX.ViCallerId.removePhone()}},onfailure:function(){BX.closeWait();BX.ViCallerId.blockVerify=false;BX.ViCallerId.blockAjax=false}})};BX.ViCallerId.activatePhone=function(e){if(BX.ViCallerId.blockAjax)return false;BX.showWait();BX.ViCallerId.blockAjax=true;BX.ajax({url:i,method:"POST",dataType:"json",timeout:30,data:{VI_ACTIVATE:"Y",CODE:e,VI_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.ViCallerId.blockVerify=false;BX.closeWait();BX.ViCallerId.blockAjax=false;if(e.ERROR==""){BX.ViCallerId.number=e.NUMBER;BX.ViCallerId.numberFormatted=e.NUMBER_FORMATTED;BX.ViCallerId.verified=true;BX.ViCallerId.verifiedUntil=e.VERIFIED_UNTIL;BX.ViCallerId.drawState({state:1})}else{BX.Voximplant.alert(BX.message("VI_CONFIG_EDIT_ERROR"),BX.message("TELEPHONY_WRONG_CODE"));BX.addClass(BX.ViCallerId.codeInput,"tel-new-num-inp-err")}},this),onfailure:function(){BX.closeWait();BX.ViCallerId.blockVerify=false;BX.ViCallerId.blockAjax=false}})};BX.ViCallerId.removePhone=function(){if(BX.ViCallerId.blockAjax)return false;BX.ViCallerId.blockVerify=false;BX.showWait();BX.ViCallerId.blockAjax=true;BX.ajax({url:i,method:"POST",dataType:"json",timeout:30,data:{VI_REMOVE:"Y",VI_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(e){BX.closeWait();BX.ViCallerId.blockAjax=false;if(e.ERROR==""){BX.ViCallerId.number="";BX.ViCallerId.verified=false;BX.ViCallerId.drawState({state:1})}else{BX.Voximplant.alert(BX.message("VI_CONFIG_EDIT_ERROR"),BX.message("TELEPHONY_ERROR_REMOVE"))}},this),onfailure:function(){BX.closeWait();BX.ViCallerId.blockAjax=false}})};BX.ViCallerId.drawOnPlaceholder=function(e){BX.ViCallerId.placeholder.innerHTML="";BX.adjust(BX.ViCallerId.placeholder,{children:e})}})(window);(function(){if(BX.Voximplant.Sip)return;BX.Voximplant.Sip=function(e){this.regId=e;this.elements={regStatus:BX("vi_sip_reg_status"),regStatusText:BX("vi_sip_reg_status_desc"),regNeedUpdate:BX("vi_sip_reg_need_update"),addFields:document.querySelector(".js-tel-set-sip-additional-fields")};this.init();this.checkStatus()};BX.Voximplant.Sip.prototype.init=function(){this.elements.addFields.addEventListener("click",function(){BX.addClass(BX("vi-tel-sip-show-additional-fields"),"tel-set-sip-additional-fields-hidden");BX.removeClass(BX("vi-tel-sip-additional-fields"),"tel-set-sip-additional-fields-hidden")})};BX.Voximplant.Sip.prototype.checkStatus=function(){var e=this;BX.showWait();BX.ajax({url:"/bitrix/components/bitrix/voximplant.config.edit/ajax.php?VI_SIP_CHECK",method:"POST",dataType:"json",timeout:60,data:{VI_SIP_CHECK:"Y",REG_ID:this.regId,VI_AJAX_CALL:"Y",sessid:BX.bitrix_sessid()},onsuccess:BX.delegate(function(t){if(t.ERROR==""){BX.closeWait();if(t.REG_STATUS=="in_progress"){setTimeout(function(){e.checkStatus()},3e4)}e.elements.regStatus.title=t.REG_LAST_UPDATED?BX.message("VI_CONFIG_SIP_LAST_UPDATED").replace("#DATE#",t.REG_LAST_UPDATED):"";e.elements.regStatus.className="tel-set-sip-reg-status-result tel-set-sip-reg-status-result-"+t.REG_STATUS;e.elements.regStatus.innerHTML=BX.message("VI_CONFIG_SIP_C_STATUS_"+t.REG_STATUS.toUpperCase());e.elements.regStatusText.innerHTML=BX.message("VI_CONFIG_SIP_C_STATUS_"+t.REG_STATUS.toUpperCase()+"_DESC");if(t.REG_STATUS=="error"){e.elements.regStatusText.innerHTML=e.elements.regStatusText.innerHTML+"<br><br>"+(t.REG_LAST_UPDATED?BX.message("VI_CONFIG_SIP_ERROR").replace("#DATE#",t.REG_LAST_UPDATED).replace("#CODE#",t.REG_CODE).replace("#MESSAGE#",t.REG_ERROR_MESSAGE):"");e.elements.regNeedUpdate.value="Y"}}else{e.elements.regStatus.title="";e.elements.regStatus.className="tel-set-sip-reg-status-result tel-set-sip-reg-status-result-error";e.elements.regStatus.innerHTML=BX.message("VI_CONFIG_SIP_C_STATUS_ERROR");e.elements.regStatusText.innerHTML=BX.message("VI_CONFIG_SIP_ERROR").replace("#DATE#","n/a").replace("#CODE#","ACCOUNT_ERROR").replace("#MESSAGE#",t.ERROR);e.elements.regNeedUpdate.value="Y"}},this),onfailure:function(){BX.closeWait();e.elements.regStatus.title="";e.elements.regStatus.className="tel-set-sip-reg-status-result tel-set-sip-reg-status-result-error";e.elements.regStatus.innerHTML=BX.message("VI_CONFIG_SIP_C_STATUS_ERROR");e.elements.regStatusText.innerHTML=BX.message("VI_CONFIG_SIP_C_STATUS_ERROR_DESC");e.elements.regNeedUpdate.value="Y"}})}})();