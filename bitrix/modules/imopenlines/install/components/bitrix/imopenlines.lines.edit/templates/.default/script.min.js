(function(e){if(!!e.BX.OpenLinesConfigEdit)return;var t=function(e,t){this.p=!!e?e:{};if(!!e["SELECTED"]){var i={},n,s;for(n in e["SELECTED"]){if(e["SELECTED"].hasOwnProperty(n)&&typeof e["SELECTED"][n]=="object"){for(s in e["SELECTED"][n]){if(e["SELECTED"][n].hasOwnProperty(s)){if(n=="USERS")i["U"+e["SELECTED"][n][s]]="users";else if(n=="SG")i["SG"+e["SELECTED"][n][s]]="sonetgroups";else if(n=="DR")i["DR"+e["SELECTED"][n][s]]="department"}}}}this.p["SELECTED"]=i}this.nodes={};var o=function(e,t){var i={},n,s,a;if(t[e]){for(a in t[e]){if(t[e].hasOwnProperty(a)){n=t[e][a];s=[];if(t[n]&&t[n].length>0)s=o(n,t);i[n]={id:n,type:"category",items:s}}}}return i},a=function(e){var t={},i;for(var n in e){if(e.hasOwnProperty(n)){i=e[n]["parent"];if(!t[i])t[i]=[];t[i][t[i].length]=n}}return o("DR0",t)};if(true||t=="users"){this.params={name:null,searchInput:null,extranetUser:this.p["EXTRANET_USER"]=="Y",bindMainPopup:{node:null,offsetTop:"5px",offsetLeft:"15px"},bindSearchPopup:{node:null,offsetTop:"5px",offsetLeft:"15px"},departmentSelectDisable:true,callback:{select:BX.delegate(this.select,this),unSelect:BX.delegate(this.unSelect,this),openDialog:BX.delegate(this.openDialog,this),closeDialog:BX.delegate(this.closeDialog,this),openSearch:BX.delegate(this.openDialog,this),closeSearch:BX.delegate(this.closeSearch,this)},items:{users:!!this.p["USERS"]?this.p["USERS"]:{},groups:{},sonetgroups:{},department:!!this.p["DEPARTMENT"]?this.p["DEPARTMENT"]:{},departmentRelation:!!this.p["DEPARTMENT"]?a(this.p["DEPARTMENT"]):{},contacts:{},companies:{},leads:{},deals:{}},itemsLast:{users:!!this.p["LAST"]&&!!this.p["LAST"]["USERS"]?this.p["LAST"]["USERS"]:{},sonetgroups:{},department:{},groups:{},contacts:{},companies:{},leads:{},deals:{},crm:[]},itemsSelected:!!this.p["SELECTED"]?BX.clone(this.p["SELECTED"]):{},isCrmFeed:false,destSort:!!this.p["DEST_SORT"]?BX.clone(this.p["DEST_SORT"]):{}}}},i=null;t.prototype={setInput:function(e,t){e=BX(e);if(!!e&&!e.hasAttribute("bx-destination-id")){var i="destination"+(""+(new Date).getTime()).substr(6),s;e.setAttribute("bx-destination-id",i);s=new n(i,e,t);this.nodes[i]=e;BX.defer_proxy(function(){this.params.name=s.id;this.params.searchInput=s.nodes.input;this.params.bindMainPopup.node=s.nodes.container;this.params.bindSearchPopup.node=s.nodes.container;BX.SocNetLogDestination.init(this.params)},this)()}},select:function(t,i,n,s,o){var a=i,l="S";if(i=="groups"){a="all-users"}else if(BX.util.in_array(i,["contacts","companies","leads","deals"])){a="crm"}if(i=="sonetgroups"){l="SG"}else if(i=="groups"){l="UA"}else if(i=="users"){l="U"}else if(i=="department"){l="DR"}else if(i=="contacts"){l="CRMCONTACT"}else if(i=="companies"){l="CRMCOMPANY"}else if(i=="leads"){l="CRMLEAD"}else if(i=="deals"){l="CRMDEAL"}var d=s?" bx-destination-undelete":"";d+=i=="sonetgroups"&&typeof e["arExtranetGroupID"]!="undefined"&&BX.util.in_array(t.entityId,e["arExtranetGroupID"])?" bx-destination-extranet":"";var p=BX.create("span",{attrs:{"data-id":t.id},props:{className:"bx-destination bx-destination-"+a+d},children:[BX.create("span",{props:{className:"bx-destination-text"},html:t.name})]});if(!s){p.appendChild(BX.create("span",{props:{className:"bx-destination-del-but"},events:{click:function(e){BX.SocNetLogDestination.deleteItem(t.id,i,o);BX.PreventDefault(e)},mouseover:function(){BX.addClass(this.parentNode,"bx-destination-hover")},mouseout:function(){BX.removeClass(this.parentNode,"bx-destination-hover")}}}))}BX.onCustomEvent(this.nodes[o],"select",[t,p,l])},unSelect:function(e,t,i,n){BX.onCustomEvent(this.nodes[n],"unSelect",[e])},openDialog:function(e){BX.onCustomEvent(this.nodes[e],"openDialog",[])},closeDialog:function(e){if(!BX.SocNetLogDestination.isOpenSearch()){BX.onCustomEvent(this.nodes[e],"closeDialog",[]);this.disableBackspace()}},closeSearch:function(e){if(!BX.SocNetLogDestination.isOpenSearch()){BX.onCustomEvent(this.nodes[e],"closeSearch",[]);this.disableBackspace()}},disableBackspace:function(){if(BX.SocNetLogDestination.backspaceDisable||BX.SocNetLogDestination.backspaceDisable!==null)BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.bind(e,"keydown",BX.SocNetLogDestination.backspaceDisable=function(e){if(e.keyCode==8){BX.PreventDefault(e);return false}return true});setTimeout(function(){BX.unbind(e,"keydown",BX.SocNetLogDestination.backspaceDisable);BX.SocNetLogDestination.backspaceDisable=null},5e3)}};var n=function(e,t,i){this.node=t;this.id=e;this.inputName=i;this.node.appendChild(BX.create("SPAN",{props:{className:"bx-destination-wrap"},html:['<span id="',this.id,'-container"><span class="bx-destination-wrap-item"></span></span>','<span class="bx-destination-input-box" id="',this.id,'-input-box">','<input type="text" value="" class="bx-destination-input" id="',this.id,'-input">',"</span>",'<a href="#" class="bx-destination-add" id="',this.id,'-add-button"></a>'].join("")}));BX.defer_proxy(this.bind,this)()};n.prototype={bind:function(){this.nodes={inputBox:BX(this.id+"-input-box"),input:BX(this.id+"-input"),container:BX(this.id+"-container"),button:BX(this.id+"-add-button")};BX.bind(this.nodes.input,"keyup",BX.proxy(this.search,this));BX.bind(this.nodes.input,"keydown",BX.proxy(this.searchBefore,this));BX.bind(this.nodes.button,"click",BX.proxy(function(e){BX.SocNetLogDestination.openDialog(this.id);BX.PreventDefault(e)},this));BX.bind(this.nodes.container,"click",BX.proxy(function(e){BX.SocNetLogDestination.openDialog(this.id);BX.PreventDefault(e)},this));this.onChangeDestination();BX.addCustomEvent(this.node,"select",BX.proxy(this.select,this));BX.addCustomEvent(this.node,"unSelect",BX.proxy(this.unSelect,this));BX.addCustomEvent(this.node,"delete",BX.proxy(this.delete,this));BX.addCustomEvent(this.node,"openDialog",BX.proxy(this.openDialog,this));BX.addCustomEvent(this.node,"closeDialog",BX.proxy(this.closeDialog,this));BX.addCustomEvent(this.node,"closeSearch",BX.proxy(this.closeSearch,this))},select:function(e,t,i){if(BX.message("LM_BUSINESS_USERS_ON")=="Y"&&BX.message("LM_BUSINESS_USERS").split(",").indexOf(e.id)==-1){BX.SocNetLogDestination.closeDialog(this.id);imolOpenTrialPopup("imol_queue");return false}if(!BX.findChild(this.nodes.container,{attr:{"data-id":e.id}},false,false)){t.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"CONFIG["+this.inputName+"]"+"["+i+"][]",value:e.id}}));this.nodes.container.appendChild(t)}this.onChangeDestination()},unSelect:function(e){var t=BX.findChildren(this.nodes.container,{attribute:{"data-id":""+e.id+""}},true);if(t!==null){for(var i=0;i<t.length;i++)BX.remove(t[i])}this.onChangeDestination()},onChangeDestination:function(){var e=[];var t=BX.findChildrenByClassName(this.nodes.container,"bx-destination",false);for(var i=0;i<t.length;i++){e.push({id:t[i].getAttribute("data-id").substr(1),name:t[i].innerText})}BX.onCustomEvent("onChangeDestination",[e]);this.nodes.input.innerHTML="";this.nodes.button.innerHTML=BX.SocNetLogDestination.getSelectedCount(this.id)<=0?BX.message("LM_ADD1"):BX.message("LM_ADD2")},openDialog:function(){BX.style(this.nodes.inputBox,"display","inline-block");BX.style(this.nodes.button,"display","none");BX.focus(this.nodes.input)},closeDialog:function(){if(this.nodes.input.value.length<=0){BX.style(this.nodes.inputBox,"display","none");BX.style(this.nodes.button,"display","inline-block");this.nodes.input.value=""}},closeSearch:function(){if(this.nodes.input.value.length>0){BX.style(this.nodes.inputBox,"display","none");BX.style(this.nodes.button,"display","inline-block");this.nodes.input.value=""}},searchBefore:function(e){if(e.keyCode==8&&this.nodes.input.value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(this.id)}return true},search:function(e){if(e.keyCode==16||e.keyCode==17||e.keyCode==18||e.keyCode==20||e.keyCode==244||e.keyCode==224||e.keyCode==91)return false;if(e.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(this.id);return true}if(e.keyCode==27){this.nodes.input.value="";BX.style(this.nodes.button,"display","inline")}else{BX.SocNetLogDestination.search(this.nodes.input.value,true,this.id)}if(!BX.SocNetLogDestination.isOpenDialog()&&this.nodes.input.value.length<=0){BX.SocNetLogDestination.openDialog(this.id)}else if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}if(e.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return true}};e.BX.OpenLinesConfigEdit={popupTooltip:{},initDestination:function(e,n,s){if(i===null)i=new t(s);i.setInput(BX(e),n)},addEventForTooltip:function(){var e=BX.findChildrenByClassName(BX("tel-set-main-wrap"),"tel-context-help");for(var t=0;t<e.length;t++){if(e[t].getAttribute("context-help")=="y")continue;e[t].setAttribute("data-id",t);e[t].setAttribute("context-help","y");BX.bind(e[t],"mouseover",function(){var e=this.getAttribute("data-id");var t=this.getAttribute("data-text");BX.OpenLinesConfigEdit.showTooltip(e,this,t)});BX.bind(e[t],"mouseout",function(){var e=this.getAttribute("data-id");BX.OpenLinesConfigEdit.hideTooltip(e)})}},showTooltip:function(e,t,i){if(this.popupTooltip[e])this.popupTooltip[e].close();this.popupTooltip[e]=new BX.PopupWindow("bx-imopenlines-tooltip",t,{lightShadow:true,autoHide:false,darkMode:true,offsetLeft:0,offsetTop:2,bindOptions:{position:"top"},zIndex:200,events:{onPopupClose:function(){this.destroy()}},content:BX.create("div",{attrs:{style:"padding-right: 5px; width: 250px;"},html:i})});this.popupTooltip[e].setAngle({offset:13,position:"bottom"});this.popupTooltip[e].show();return true},hideTooltip:function(e){this.popupTooltip[e].close();this.popupTooltip[e]=null},toggleSelectFormText:function(e,t,i,n){if(e.options[e.selectedIndex].value=="form"){t.style.height="47px";i.style.height="29px";n.style.height="100px"}else if(e.options[e.selectedIndex].value=="text"){t.style.height="0";i.style.height="0";n.style.height="100px"}else{t.style.height="0";i.style.height="0";n.style.height="0"}},toggleSelectFormOrText:function(e,t,i){if(e.options[e.selectedIndex].value=="form"){t.style.height="47px";i.style.height="0"}else if(e.options[e.selectedIndex].value=="text"||e.options[e.selectedIndex].value=="quality"){t.style.height="0";i.style.height="100px"}else{t.style.height="0";i.style.height="0"}},toggleCheckboxText:function(e,t){if(e.checked){t.style.height="100px"}else{t.style.height="0"}},toggleCheckboxVote:function(e,t){if(e.checked){t.style.height="670px"}else{t.style.height="0"}},toggleCheckboxAgreement:function(e,t){if(e.checked){t.style.height="210px"}else{t.style.height="0"}}};BX.ready(function(){BX.OpenLinesConfigEdit.addEventForTooltip()})})(window);
//# sourceMappingURL=script.map.js