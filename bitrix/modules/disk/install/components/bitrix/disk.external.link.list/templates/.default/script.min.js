BX.namespace("BX.Disk");BX.Disk.ExternalLinkListClass=function(){var e=function(e){this.grid=e.grid;this.gridGroupActionButton=BX(e.gridGroupActionButton);this.gridShowTreeButton=BX(e.gridShowTreeButton);this.rootObject=e.rootObject||{};this.checkboxes={};this.resetCheckboxes();this.ajaxUrl="/bitrix/components/bitrix/disk.external.link.list/ajax.php";this.grid.SetActionName("delete");this.setEvents()};e.prototype.resetCheckboxes=function(){var e=BX.findChildren(this.grid.tableNode,{tagName:"input",attr:{type:"checkbox"}},true);for(var t in e){if(!e.hasOwnProperty(t)){continue}var i=e[t];if(i.getAttribute("name")==="ID[]"){i.checked=false}}};e.prototype.setEvents=function(){BX.bind(BX("delete_button_"+this.grid.table_id),"click",BX.proxy(this.onClickDeleteGroup,this));BX.addCustomEvent("onSelectRow",BX.proxy(this.onSelectRow,this));BX.addCustomEvent("onUnSelectRow",BX.proxy(this.onUnSelectRow,this))};e.prototype.removeRow=function(e,t){this.grid.removeRow(e,t)};e.prototype.getRow=function(e){return this.grid.getRow(e)};e.prototype.getRowByCheckBox=function(e){return this.grid.getRowByCheckBox(e)};e.prototype.getCheckbox=function(e){return this.grid.getCheckbox(e)};e.prototype.disableExternalLink=function(e,t){BX.Disk.modalWindowLoader(BX.Disk.addToLinkParam(this.ajaxUrl,"action","disableExternalLink"),{id:"status-action",responseType:"json",postData:{externalId:e,objectId:t},afterSuccessLoad:BX.delegate(function(t){if(!t||t.status!="success"){BX.Disk.showModalWithStatusAction(t);return}this.removeRow(e,function(){BX.Disk.showModalWithStatusAction(t)})},this)});return false};e.prototype.onClickDeleteGroup=function(e){if(!this.grid.IsActionEnabled())return false;var t=document.getElementById("actallrows_"+this.grid.table_id);this.openConfirmDeleteGroup({attemptDeleteAll:t&&t.checked});BX.PreventDefault(e);return false};e.prototype.openConfirmDeleteGroup=function(e){var t=BX.message("DISK_EXTERNAL_LINK_LIST_DELETE_GROUP_CONFIRM");var i=[new BX.PopupWindowButton({text:BX.message("DISK_EXTERNAL_LINK_LIST_DELETE_BUTTON"),className:"popup-window-button-accept",events:{click:BX.delegate(function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);this.grid.ActionDelete();return false},this)}}),new BX.PopupWindowButton({text:BX.message("DISK_EXTERNAL_LINK_LIST_CANCEL_DELETE_BUTTON"),events:{click:function(e){BX.PopupWindowManager.getCurrentPopup().destroy();BX.PreventDefault(e);return false}}})];BX.Disk.modalWindow({modalId:"bx-link-unlink-confirm",title:BX.message("DISK_EXTERNAL_LINK_LIST_DELETE_TITLE"),contentClassName:"tac",contentStyle:{paddingTop:"70px",paddingBottom:"70px"},content:t,buttons:i})};e.prototype.showInfoPanelManyObject=function(e){var t="bx-file-icon-container-small bx-disk-file-icon";var i=[];i.push(BX.create("a",{text:BX.message("DISK_EXTERNAL_LINK_LIST_DELETE_BUTTON"),style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-lightgray"},events:{click:BX.delegate(function(e){BX.fireEvent(BX("delete_button_"+this.grid.table_id),"click")},this)}}));this.showInfoPanel({buttons:i,isFolder:false,icon:{className:t},title:{text:BX.Disk.getNumericCase(e.length,BX.message("DISK_EXTERNAL_LINK_LIST_SELECTED_OBJECT_1"),BX.message("DISK_EXTERNAL_LINK_LIST_SELECTED_OBJECT_21"),BX.message("DISK_EXTERNAL_LINK_LIST_SELECTED_OBJECT_2_4"),BX.message("DISK_EXTERNAL_LINK_LIST_SELECTED_OBJECT_5_20")).replace("#COUNT#",e.length)}})};e.prototype.showInfoPanelSingleObject=function(e){this.currentObjectIdInInfoPanel=e;var t=[];var i="";var n=this.getRow(e);var o=BX.findChild(n,{tagName:"a",className:"bx-disk-folder-title"},true);var s="bx-file-icon-container-small bx-disk-file-icon";var a=BX.findChild(n,function(e){return BX.type.isElementNode(e)&&(BX.hasClass(e,"bx-disk-file-icon")||BX.hasClass(e,"bx-disk-folder-icon"))},true);if(a){s=a.className}if(!o){return}if(!n.oncontextmenu){return}var r=n.oncontextmenu();for(var c in r){if(!r.hasOwnProperty(c)){continue}var l=r[c];if(l&&l["PSEUDO_NAME"]){switch(l["PSEUDO_NAME"].toLowerCase()){case"download":if(t.length>0){t.push(BX.create("SPAN",{html:"&nbsp;"}))}t.push(BX.create("a",{attrs:{onclick:l["ONCLICK"]},text:l["TEXT"],style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-green"}}));break;case"disable_external_link":if(t.length>0){t.push(BX.create("SPAN",{html:"&nbsp;"}))}t.push(BX.create("a",{attrs:{onclick:l["ONCLICK"]},text:l["SHORT_TEXT"],style:{width:"145px"},props:{className:"bx-disk-btn bx-disk-btn-medium bx-disk-btn-lightgray"}}));break}}}this.showInfoPanel({buttons:t,isFolder:BX.hasClass(a,"bx-disk-folder-icon"),icon:{className:s},objectId:e,title:{text:o.text,href:o.getAttribute("href"),date:o.getAttribute("data-bx-dateModify")}})};e.prototype.showInfoPanel=function(e){var t=e.title||{};var i=e.icon||{};var n=e.buttons||[];var o=e.internalLink||"";var s=e.isFolder;var a=e.objectId||null;if(!t){return}var r=BX("disk_info_panel");var c=BX("bx_disk_empty_select_section");if(c)BX.hide(c);BX.cleanNode(r);this.containerWithExtAndIntLinks=null;var l=BX.create("div");r.appendChild(l);l.appendChild(BX.create("div",{props:{className:"bx-disk-info-panel"},children:[BX.create("div",{props:{className:"bx-disk-info-panel-relative"},children:[BX.create("div",{props:{className:"bx-disk-info-panel-icon"},children:[BX.create("div",{props:{className:i.className}})]}),BX.create("div",{props:{className:"bx-disk-info-panel-element-name-container"},children:[BX.create("div",{props:{id:"disk_info_panel_name",className:"bx-disk-info-panel-name"},children:[BX.create("a",{text:t.text,props:{title:t.text,href:t.href||"javascript:void(0);"}})]}),BX.create("div",{text:t.date,props:{className:"bx-disk-info-panel-date"}})]}),BX.create("div",{props:{className:"bx-disk-info-panel-context"}})]}),BX.create("div",{props:{className:"tal"},children:n})]}));new BX.easing({duration:300,start:{opacity:0,height:0},finish:{opacity:100,height:l.offsetHeight},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){r.style.height=e.height+"px";r.style.opacity=e.opacity/100},complete:BX.delegate(function(){r.style.cssText=""},this)}).animate()};e.prototype.addCheckbox=function(e){var t=e.value;if(!this.checkboxes[t]){this.checkboxes[t]=true}};e.prototype.deleteCheckbox=function(e){var t=e.value;if(this.checkboxes[t]){this.checkboxes[t]=false}};e.prototype.onSelectRow=function(e,t,i){this.addCheckbox(i);if(t==1){this.showInfoPanelSingleObject(i.value)}else{var n=this.grid.GetCheckedCheckboxes();var o=[];for(var s in n){if(!n.hasOwnProperty(s)||n[s].name!="ID[]"){continue}o.push(n[s].value)}this.showInfoPanelManyObject(o)}};e.prototype.onUnSelectRow=function(e,t,i){this.deleteCheckbox(i);if(t==0){var n=i.value;var o=BX("disk_info_panel");var s=BX.firstChild(o);new BX.easing({duration:300,start:{opacity:100,height:s.offsetHeight},finish:{opacity:0,height:0},transition:BX.easing.makeEaseOut(BX.easing.transitions.quad),step:function(e){o.style.height=e.height+"px";o.style.opacity=e.opacity/10},complete:BX.delegate(function(){var e=BX("bx_disk_empty_select_section");if(e)BX.show(e,"block")},this)}).animate()}else{this.onSelectRow(e,t,this.getFirstSelectedCheckbox())}};e.prototype.getFirstSelectedCheckbox=function(){var e;for(e in this.checkboxes){if(this.checkboxes.hasOwnProperty(e)&&typeof e!=="function"&&this.checkboxes[e]==true){break}}return this.getCheckbox(e)};return e}();
//# sourceMappingURL=script.map.js