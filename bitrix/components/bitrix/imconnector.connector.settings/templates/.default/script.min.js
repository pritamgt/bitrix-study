(function(t){var e=function(t,e,i){this.node=e;this.id=t;this.inputName=i;this.node.appendChild(BX.create("SPAN",{props:{className:"bx-destination-wrap"},html:['<span id="',this.id,'-container"><span class="bx-destination-wrap-item"></span></span>','<span class="bx-destination-input-box" id="',this.id,'-input-box">','<input type="text" value="" class="bx-destination-input" id="',this.id,'-input">',"</span>",'<a href="#" class="bx-destination-add" id="',this.id,'-add-button"></a>'].join("")}));BX.defer_proxy(this.bind,this)()};e.prototype={bind:function(){this.nodes={inputBox:BX(this.id+"-input-box"),input:BX(this.id+"-input"),container:BX(this.id+"-container"),button:BX(this.id+"-add-button")};BX.bind(this.nodes.input,"keyup",BX.proxy(this.search,this));BX.bind(this.nodes.input,"keydown",BX.proxy(this.searchBefore,this));BX.bind(this.nodes.button,"click",BX.proxy(function(t){BX.SocNetLogDestination.openDialog(this.id);BX.PreventDefault(t)},this));BX.bind(this.nodes.container,"click",BX.proxy(function(t){BX.SocNetLogDestination.openDialog(this.id);BX.PreventDefault(t)},this));this.onChangeDestination();BX.addCustomEvent(this.node,"select",BX.proxy(this.select,this));BX.addCustomEvent(this.node,"unSelect",BX.proxy(this.unSelect,this));BX.addCustomEvent(this.node,"delete",BX.proxy(this.delete,this));BX.addCustomEvent(this.node,"openDialog",BX.proxy(this.openDialog,this));BX.addCustomEvent(this.node,"closeDialog",BX.proxy(this.closeDialog,this));BX.addCustomEvent(this.node,"closeSearch",BX.proxy(this.closeSearch,this))},select:function(t,e,i){if(BX.message("LM_BUSINESS_USERS_ON")=="Y"&&BX.message("LM_BUSINESS_USERS").split(",").indexOf(t.id)==-1){BX.SocNetLogDestination.closeDialog(this.id);imolOpenTrialPopup("imol_queue");return false}if(!BX.findChild(this.nodes.container,{attr:{"data-id":t.id}},false,false)){e.appendChild(BX.create("INPUT",{props:{type:"hidden",name:"CONFIG["+this.inputName+"]"+"["+i+"][]",value:t.id}}));this.nodes.container.appendChild(e)}this.onChangeDestination()},unSelect:function(t){var e=BX.findChildren(this.nodes.container,{attribute:{"data-id":""+t.id+""}},true);if(e!==null){for(var i=0;i<e.length;i++)BX.remove(e[i])}this.onChangeDestination()},onChangeDestination:function(){this.nodes.input.innerHTML="";this.nodes.button.innerHTML=BX.SocNetLogDestination.getSelectedCount(this.id)<=0?BX.message("LM_ADD1"):BX.message("LM_ADD2")},openDialog:function(){BX.style(this.nodes.inputBox,"display","inline-block");BX.style(this.nodes.button,"display","none");BX.focus(this.nodes.input)},closeDialog:function(){if(this.nodes.input.value.length<=0){BX.style(this.nodes.inputBox,"display","none");BX.style(this.nodes.button,"display","inline-block");this.nodes.input.value=""}},closeSearch:function(){if(this.nodes.input.value.length>0){BX.style(this.nodes.inputBox,"display","none");BX.style(this.nodes.button,"display","inline-block");this.nodes.input.value=""}},searchBefore:function(t){if(t.keyCode==8&&this.nodes.input.value.length<=0){BX.SocNetLogDestination.sendEvent=false;BX.SocNetLogDestination.deleteLastItem(this.id)}return true},search:function(t){if(t.keyCode==16||t.keyCode==17||t.keyCode==18||t.keyCode==20||t.keyCode==244||t.keyCode==224||t.keyCode==91)return false;if(t.keyCode==13){BX.SocNetLogDestination.selectFirstSearchItem(this.id);return true}if(t.keyCode==27){this.nodes.input.value="";BX.style(this.nodes.button,"display","inline")}else{BX.SocNetLogDestination.search(this.nodes.input.value,true,this.id)}if(!BX.SocNetLogDestination.isOpenDialog()&&this.nodes.input.value.length<=0){BX.SocNetLogDestination.openDialog(this.id)}else if(BX.SocNetLogDestination.sendEvent&&BX.SocNetLogDestination.isOpenDialog()){BX.SocNetLogDestination.closeDialog()}if(t.keyCode==8){BX.SocNetLogDestination.sendEvent=true}return true}};t.BX.OpenLinesConfigEdit={popupTooltip:{},addEventForTooltip:function(){var t=BX.findChildrenByClassName(BX("imconnector-new"),"tel-context-help");for(var e=0;e<t.length;e++){if(t[e].getAttribute("context-help")=="y")continue;t[e].setAttribute("data-id",e);t[e].setAttribute("context-help","y");BX.bind(t[e],"mouseover",function(){var t=this.getAttribute("data-id");var e=this.getAttribute("data-text");BX.OpenLinesConfigEdit.showTooltip(t,this,e)});BX.bind(t[e],"mouseout",function(){var t=this.getAttribute("data-id");BX.OpenLinesConfigEdit.hideTooltip(t)})}},showTooltip:function(t,e,i){if(this.popupTooltip[t])this.popupTooltip[t].close();this.popupTooltip[t]=new BX.PopupWindow("bx-imopenlines-tooltip",e,{lightShadow:true,autoHide:false,darkMode:true,offsetLeft:0,offsetTop:2,bindOptions:{position:"top"},zIndex:200,events:{onPopupClose:function(){this.destroy()}},content:BX.create("div",{attrs:{style:"padding-right: 5px; width: 250px;"},html:i})});this.popupTooltip[t].setAngle({offset:13,position:"bottom"});this.popupTooltip[t].show();return true},hideTooltip:function(t){this.popupTooltip[t].close();this.popupTooltip[t]=null}};BX.ready(function(){BX.OpenLinesConfigEdit.addEventForTooltip()});BX.ImConnectorConnectorSettings=function(t){this.ajaxUrl="/bitrix/components/bitrix/imopenlines.lines/ajax.php";return this};BX.ImConnectorConnectorSettings.prototype={createLine:function(t){if(this.isActiveControlLocked){return}this.isActiveControlLocked=true;this.sendActionRequest("create",function(e){location.href=t.replace("#LINE#",e.config_id)},function(t){t=t||{error:true,text:""};this.isActiveControlLocked=false;if(t.limited){if(!B24||!B24["licenseInfoPopup"]){return}B24.licenseInfoPopup.show("crm_webform_activation",BX.message("IMCONNECTOR_COMPONENT_CONNECTOR_SETTINGS_POPUP_LIMITED_TITLE"),"<span>"+BX.message("IMCONNECTOR_COMPONENT_CONNECTOR_SETTINGS_POPUP_LIMITED_TEXT")+"</span>")}else{this.showErrorPopup(t)}})},sendActionRequest:function(t,e,i){e=e||null;i=i||BX.proxy(this.showErrorPopup,this);BX.ajax({url:this.ajaxUrl,method:"POST",data:{action:t,config_id:this.id,sessid:BX.bitrix_sessid()},timeout:30,dataType:"json",processData:true,onsuccess:BX.proxy(function(t){t=t||{};if(t.error){i.apply(this,[t])}else if(e){e.apply(this,[t])}},this),onfailure:BX.proxy(function(){var t={error:true,text:""};i.apply(this,[t])},this)})},showErrorPopup:function(t){t=t||{};var e=t.text||BX.message("IMCONNECTOR_COMPONENT_CONNECTOR_SETTINGS_ERROR_ACTION");var i=BX.PopupWindowManager.create("crm_webform_list_error",null,{autoHide:true,lightShadow:true,closeByEsc:true,overlay:{backgroundColor:"black",opacity:500}});i.setButtons([new BX.PopupWindowButton({text:BX.message("IMCONNECTOR_COMPONENT_CONNECTOR_SETTINGS_CLOSE"),events:{click:function(){this.popupWindow.close()}}})]);i.setContent('<span class="crm-webform-edit-warning-popup-alert">'+e+"</span>");i.show()}}})(window);
//# sourceMappingURL=script.map.js